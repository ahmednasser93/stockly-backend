<?xml version="1.0" encoding="UTF-8" ?>
<testsuites name="vitest tests" tests="705" failures="0" errors="0" time="58.68">
    <testsuite name="test/alerts-evaluate.spec.ts" timestamp="2025-12-20T12:24:18.146Z" hostname="sngvahmed" tests="6" failures="0" errors="0" skipped="0" time="0.432">
        <testcase classname="test/alerts-evaluate.spec.ts" name="evaluateAlerts &gt; notifies only when direction condition transitions from false to true" time="0.036">
        </testcase>
        <testcase classname="test/alerts-evaluate.spec.ts" name="evaluateAlerts &gt; resets state when price falls back below threshold" time="0.036">
        </testcase>
        <testcase classname="test/alerts-evaluate.spec.ts" name="evaluateAlerts &gt; skips alerts that lack a price" time="0.085">
        </testcase>
        <testcase classname="test/alerts-evaluate.spec.ts" name="evaluateAlerts &gt; notifies on significant price change after initial trigger (2% change)" time="0.035">
        </testcase>
        <testcase classname="test/alerts-evaluate.spec.ts" name="evaluateAlerts &gt; suppresses notifications during cooldown period" time="0.078">
        </testcase>
        <testcase classname="test/alerts-evaluate.spec.ts" name="evaluateAlerts &gt; handles &apos;below&apos; direction correctly" time="0.042">
        </testcase>
    </testsuite>
    <testsuite name="test/alerts-handler.spec.ts" timestamp="2025-12-20T12:24:18.151Z" hostname="sngvahmed" tests="5" failures="0" errors="0" skipped="0" time="0.326">
        <testcase classname="test/alerts-handler.spec.ts" name="alerts handler &gt; lists alerts" time="0.046">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.388Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Alerts request authenticated&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;isAdmin&quot;:false,&quot;requestUsername&quot;:&quot;testuser&quot;,&quot;method&quot;:&quot;GET&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.389Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Fetched alerts from D1&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;alertCount&quot;:1,&quot;alertIds&quot;:[&quot;1&quot;]}

            </system-out>
        </testcase>
        <testcase classname="test/alerts-handler.spec.ts" name="alerts handler &gt; creates an alert when payload is valid" time="0.043">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.436Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Alerts request authenticated&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;isAdmin&quot;:false,&quot;requestUsername&quot;:&quot;testuser&quot;,&quot;method&quot;:&quot;POST&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.436Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Creating alert&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;symbol&quot;:&quot;AAPL&quot;,&quot;direction&quot;:&quot;above&quot;,&quot;threshold&quot;:200}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.437Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Created alert successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertId&quot;:&quot;2&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;alertUsername&quot;:&quot;testuser&quot;,&quot;isAdmin&quot;:false}

            </system-out>
        </testcase>
        <testcase classname="test/alerts-handler.spec.ts" name="alerts handler &gt; returns 404 when an alert is missing" time="0.073">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.506Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Alerts request authenticated&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;isAdmin&quot;:false,&quot;requestUsername&quot;:&quot;testuser&quot;,&quot;method&quot;:&quot;GET&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/alerts-handler.spec.ts" name="alerts handler &gt; updates alerts via PUT" time="0.039">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.551Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Alerts request authenticated&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;isAdmin&quot;:false,&quot;requestUsername&quot;:&quot;testuser&quot;,&quot;method&quot;:&quot;PUT&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.551Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Updated alert&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertId&quot;:&quot;3&quot;,&quot;username&quot;:&quot;testuser&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/alerts-handler.spec.ts" name="alerts handler &gt; deletes alerts and clears KV state" time="0.06">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.612Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Alerts request authenticated&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;isAdmin&quot;:false,&quot;requestUsername&quot;:&quot;testuser&quot;,&quot;method&quot;:&quot;DELETE&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.612Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Deleted alert&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertId&quot;:&quot;123&quot;,&quot;username&quot;:&quot;testuser&quot;}

            </system-out>
        </testcase>
    </testsuite>
    <testsuite name="test/alerts-storage.spec.ts" timestamp="2025-12-20T12:24:18.157Z" hostname="sngvahmed" tests="19" failures="0" errors="0" skipped="0" time="1.07">
        <testcase classname="test/alerts-storage.spec.ts" name="alerts storage queries &gt; lists alerts" time="0.037">
        </testcase>
        <testcase classname="test/alerts-storage.spec.ts" name="alerts storage queries &gt; creates and returns an alert" time="0.044">
            <system-out>
Creating alert with username: testuser, symbol: AAPL

Alert created successfully: id=generated-id, username=testuser, symbol=AAPL

            </system-out>
        </testcase>
        <testcase classname="test/alerts-storage.spec.ts" name="alerts storage queries &gt; throws validation error for invalid data" time="0.105">
            <system-out>
Creating alert with username: u, symbol: BAD

            </system-out>
        </testcase>
        <testcase classname="test/alerts-storage.spec.ts" name="alerts storage queries &gt; throws missing data error" time="0.085">
            <system-out>
Creating alert with username: u, symbol: 

            </system-out>
        </testcase>
        <testcase classname="test/alerts-storage.spec.ts" name="alerts storage queries &gt; throws if alert creation cannot be verified" time="0.031">
            <system-out>
Creating alert with username: u, symbol: A

            </system-out>
        </testcase>
        <testcase classname="test/alerts-storage.spec.ts" name="alerts storage queries &gt; throws if created alert has mismatched username" time="0.076">
            <system-out>
Creating alert with username: me, symbol: A

            </system-out>
        </testcase>
        <testcase classname="test/alerts-storage.spec.ts" name="alerts storage queries &gt; updates alerts with provided fields" time="0.036">
        </testcase>
        <testcase classname="test/alerts-storage.spec.ts" name="alerts storage queries &gt; deletes alerts" time="0.063">
        </testcase>
        <testcase classname="test/alerts-storage.spec.ts" name="alerts storage queries &gt; lists active alerts" time="0.025">
        </testcase>
        <testcase classname="test/alerts-storage.spec.ts" name="alerts storage queries &gt; lists all alerts for admin (null username)" time="0.067">
        </testcase>
        <testcase classname="test/alerts-storage.spec.ts" name="alerts storage queries &gt; throws specific error on unique constraint violation" time="0.026">
            <system-out>
Creating alert with username: testuser, symbol: AAPL

            </system-out>
        </testcase>
        <testcase classname="test/alerts-storage.spec.ts" name="alerts storage queries &gt; lists active alerts for specific user" time="0.024">
        </testcase>
        <testcase classname="test/alerts-storage.spec.ts" name="alerts storage queries &gt; admin updates alert (null username)" time="0.06">
        </testcase>
        <testcase classname="test/alerts-storage.spec.ts" name="alerts storage queries &gt; admin deletes alert (null username)" time="0.026">
        </testcase>
        <testcase classname="test/alerts-storage.spec.ts" name="alerts storage queries &gt; updates all alert fields" time="0.036">
        </testcase>
        <testcase classname="test/alerts-storage.spec.ts" name="alerts state KV &gt; reads and writes state snapshots" time="0.03">
            <system-out>
[KV Cache] Queued state update for alert 1 (1 pending writes)

            </system-out>
        </testcase>
        <testcase classname="test/alerts-storage.spec.ts" name="alerts state KV &gt; reads state from KV when cache misses" time="0.074">
        </testcase>
        <testcase classname="test/alerts-storage.spec.ts" name="alerts state KV &gt; deletes state" time="0.032">
            <system-out>
[KV Cache] Queued state update for alert 1 (1 pending writes)

            </system-out>
        </testcase>
        <testcase classname="test/alerts-storage.spec.ts" name="alerts state KV &gt; handles JSON parse errors in state gracefully" time="0.066">
        </testcase>
    </testsuite>
    <testsuite name="test/alerts-validation.spec.ts" timestamp="2025-12-20T12:24:18.160Z" hostname="sngvahmed" tests="10" failures="0" errors="0" skipped="0" time="0.666">
        <testcase classname="test/alerts-validation.spec.ts" name="alert validation &gt; validates creation payloads" time="0.036">
        </testcase>
        <testcase classname="test/alerts-validation.spec.ts" name="alert validation &gt; validation handles minimal valid payload" time="0.034">
        </testcase>
        <testcase classname="test/alerts-validation.spec.ts" name="alert validation &gt; rejects invalid creation payloads" time="0.085">
        </testcase>
        <testcase classname="test/alerts-validation.spec.ts" name="alert validation &gt; rejects invalid enum values for creation" time="0.033">
        </testcase>
        <testcase classname="test/alerts-validation.spec.ts" name="alert validation &gt; validates updates" time="0.075">
        </testcase>
        <testcase classname="test/alerts-validation.spec.ts" name="alert validation &gt; validates full update success" time="0.041">
        </testcase>
        <testcase classname="test/alerts-validation.spec.ts" name="alert validation &gt; validates partial updates" time="0.089">
        </testcase>
        <testcase classname="test/alerts-validation.spec.ts" name="alert validation &gt; validates clearing notes" time="0.093">
        </testcase>
        <testcase classname="test/alerts-validation.spec.ts" name="alert validation &gt; rejects invalid update values" time="0.028">
        </testcase>
        <testcase classname="test/alerts-validation.spec.ts" name="alert validation &gt; requires at least one field on update" time="0.082">
        </testcase>
    </testsuite>
    <testsuite name="test/api-comprehensive.spec.ts" timestamp="2025-12-20T12:24:18.161Z" hostname="sngvahmed" tests="38" failures="0" errors="0" skipped="0" time="1.426">
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Health Check &gt; GET /v1/api/health returns OK status" time="0.017">
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Get Single Stock &gt; GET /v1/api/get-stock returns stock data with all required fields" time="0.756">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.179Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No cache for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;cacheStatus&quot;:&quot;MISS&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.180Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /quote&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/quote&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;latencyMs&quot;:1}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.180Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /profile&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/profile&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;statusCode&quot;:404,&quot;latencyMs&quot;:0}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.718Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /profile&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/profile&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;statusCode&quot;:404,&quot;latencyMs&quot;:537}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.831Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /profile&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/profile&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;statusCode&quot;:404,&quot;latencyMs&quot;:113}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.927Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /profile&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/profile&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;statusCode&quot;:403,&quot;latencyMs&quot;:95}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.928Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Final description resolved&quot;,&quot;type&quot;:&quot;general&quot;,&quot;hasDescription&quot;:true,&quot;descriptionLength&quot;:38,&quot;source&quot;:&quot;quote&quot;}

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.180Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Failed to fetch profile&quot;,&quot;type&quot;:&quot;general&quot;,&quot;endpoint&quot;:&quot;https://financialmodelingprep.com/stable/profile?symbol=AAPL&amp;apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM&quot;,&quot;error&quot;:&quot;profileRes.text is not a function&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.718Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Profile API returned non-ok status&quot;,&quot;type&quot;:&quot;general&quot;,&quot;endpoint&quot;:&quot;https://financialmodelingprep.com/stable/profile/AAPL?apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM&quot;,&quot;statusCode&quot;:404,&quot;errorText&quot;:&quot;[]&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.832Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Profile API returned non-ok status&quot;,&quot;type&quot;:&quot;general&quot;,&quot;endpoint&quot;:&quot;https://financialmodelingprep.com/stable/company/profile/AAPL?apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM&quot;,&quot;statusCode&quot;:404,&quot;errorText&quot;:&quot;[]&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.928Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Profile API returned non-ok status&quot;,&quot;type&quot;:&quot;general&quot;,&quot;endpoint&quot;:&quot;https://financialmodelingprep.com/api/v3/profile/AAPL?apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM&quot;,&quot;statusCode&quot;:403,&quot;errorText&quot;:&quot;{\n  \&quot;Error Message\&quot;: \&quot;Legacy Endpoint : Due to Legacy endpoints being no longer supported - This endpoint is only available for legacy users who have valid subscriptions prior August 31, 2025. Please &quot;}

            </system-err>
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Get Single Stock &gt; GET /v1/api/get-stock returns 400 when symbol is missing" time="0.003">
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Get Multiple Stocks &gt; GET /v1/api/get-stocks returns array of stocks with all fields" time="0.005">
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Get Multiple Stocks &gt; GET /v1/api/get-stocks returns 400 when symbols parameter is missing" time="0.002">
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Search Stocks &gt; GET /v1/api/search-stock returns matching stocks" time="0.003">
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Search Stocks &gt; GET /v1/api/search-stock returns empty array when query is missing" time="0.003">
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Get Historical &gt; GET /v1/api/get-historical returns historical data" time="0.506">
            <system-out>
[getHistoricalPricesByDateRange] Querying database for AAPL from 2025-06-23 to 2025-12-20

[getHistoricalPricesByDateRange] Found 2 records for AAPL in date range 2025-06-23 to 2025-12-20

[get-historical] Query result for AAPL (2025-06-23 to 2025-12-20): 2 records found in database
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.954Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No historical data in database for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;dateRange&quot;:&quot;2025-06-23 to 2025-12-20&quot;,&quot;action&quot;:&quot;fetching from FMP API&quot;}
[fetchAndSaveHistoricalPrice] Starting fetch for AAPL from FMP API
[fetchAndSaveHistoricalPrice] Fetching from: https://financialmodelingprep.com/stable/historical-chart/30min?symbol=AAPL&amp;apikey=***&amp;from=2025-06-23&amp;to=2025-12-20

[fetchAndSaveHistoricalPrice] Received 2 1-hour OHLC records from FMP API
[fetchAndSaveHistoricalPrice] FMP API returned 2 records for AAPL
[fetchAndSaveHistoricalPrice] Sample record structure: {
  date: undefined,
  hasOpen: false,
  hasHigh: false,
  hasLow: false,
  hasClose: false,
  hasPrice: false,
  keys: [ &apos;symbol&apos;, &apos;name&apos;, &apos;currency&apos;, &apos;stockExchange&apos; ]
}
Saved 0 daily candles (aggregated from 2 1-hour records) for AAPL with OHLC data

[getHistoricalPricesByDateRange] Querying database for AAPL from 2025-06-23 to 2025-12-20

[getHistoricalPricesByDateRange] Found 2 records for AAPL in date range 2025-06-23 to 2025-12-20

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.456Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;After FMP fetch, query result for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;dateRange&quot;:&quot;2025-06-23 to 2025-12-20&quot;,&quot;recordCount&quot;:2}
[get-historical] Successfully fetched 2 historical records for AAPL from FMP API

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.954Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Found 2 records with missing OHLC data&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbol&quot;:&quot;AAPL&quot;,&quot;recordsWithMissingOHLC&quot;:2,&quot;totalRecords&quot;:2}

[fetchAndSaveHistoricalPrice] Failed to parse date from timestamp undefined, skipping record
[fetchAndSaveHistoricalPrice] Failed to parse date from timestamp undefined, skipping record

            </system-err>
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Get Historical &gt; GET /v1/api/get-historical returns 400 when symbol is missing" time="0.003">
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Alerts &gt; GET /v1/api/alerts lists all alerts" time="0.003">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.465Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Alerts request authenticated&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;isAdmin&quot;:false,&quot;requestUsername&quot;:&quot;testuser&quot;,&quot;method&quot;:&quot;GET&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.465Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Fetched alerts from D1&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;alertCount&quot;:1,&quot;alertIds&quot;:[&quot;alert-123&quot;]}

            </system-out>
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Alerts &gt; POST /v1/api/alerts creates a new alert" time="0.003">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.468Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Alerts request authenticated&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;isAdmin&quot;:false,&quot;requestUsername&quot;:&quot;testuser&quot;,&quot;method&quot;:&quot;POST&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.468Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Creating alert&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;symbol&quot;:&quot;AAPL&quot;,&quot;direction&quot;:&quot;above&quot;,&quot;threshold&quot;:200}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.469Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Created alert successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertId&quot;:&quot;alert-123&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;alertUsername&quot;:&quot;testuser&quot;,&quot;isAdmin&quot;:false}

            </system-out>
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Alerts &gt; GET /v1/api/alerts/:id gets a specific alert" time="0.003">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.471Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Alerts request authenticated&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;isAdmin&quot;:false,&quot;requestUsername&quot;:&quot;testuser&quot;,&quot;method&quot;:&quot;GET&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Alerts &gt; PUT /v1/api/alerts/:id updates an alert" time="0.003">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.474Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Alerts request authenticated&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;isAdmin&quot;:false,&quot;requestUsername&quot;:&quot;testuser&quot;,&quot;method&quot;:&quot;PUT&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.475Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Updated alert&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertId&quot;:&quot;alert-123&quot;,&quot;username&quot;:&quot;testuser&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Alerts &gt; DELETE /v1/api/alerts/:id deletes an alert" time="0.003">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.477Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Alerts request authenticated&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;isAdmin&quot;:false,&quot;requestUsername&quot;:&quot;testuser&quot;,&quot;method&quot;:&quot;DELETE&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.477Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Deleted alert&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertId&quot;:&quot;alert-123&quot;,&quot;username&quot;:&quot;testuser&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Push Token &gt; POST /v1/api/push-token registers a new push token" time="0.004">
            <system-out>
✅ FCM token validation passed: length=30, format valid

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.482Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;user-123&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Registering new push token&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;deviceType&quot;:&quot;ios&quot;,&quot;tokenPreview&quot;:&quot;fcm-token-1234567890...&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.482Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;user-123&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Push token registered successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;deviceType&quot;:&quot;ios&quot;,&quot;deviceId&quot;:&quot;fcm-token-1234567890...&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Push Token &gt; POST /v1/api/push-token updates existing push token" time="0.004">
            <system-out>
✅ FCM token validation passed: length=30, format valid

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.485Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;user-123&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Updating existing push token&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;deviceType&quot;:&quot;ios&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.486Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;user-123&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Push token updated successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;deviceType&quot;:&quot;ios&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Push Token &gt; POST /v1/api/push-token returns 400 for invalid token format" time="0.002">
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Push Token &gt; GET /v1/api/push-token gets a user&apos;s push token" time="0.003">
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Push Token &gt; GET /v1/api/push-token returns 404 when token not found" time="0.002">
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Push Token &gt; GET /v1/api/push-token?check=true&amp;token=XXX returns registered status for specific token" time="0.002">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.496Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;user-123&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Device registration check&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;pushToken&quot;:&quot;fcm-token-1234567890...&quot;,&quot;registered&quot;:true}

            </system-out>
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Push Token &gt; GET /v1/api/push-token?check=true&amp;token=XXX returns registered=false when token not found" time="0.003">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.499Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;user-123&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Device registration check&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;pushToken&quot;:&quot;fcm-token-unregister...&quot;,&quot;registered&quot;:false}

            </system-out>
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Push Token &gt; GET /v1/api/push-token?check=true returns 400 when token parameter missing" time="0.002">
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Preferences &gt; GET /v1/api/preferences gets user preferences" time="0.003">
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Preferences &gt; GET /v1/api/preferences returns default preferences when not found" time="0.003">
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Preferences &gt; PUT /v1/api/preferences updates user preferences" time="0.003">
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Settings &gt; GET /v1/api/settings gets user settings" time="0.003">
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Settings &gt; GET /v1/api/settings returns default settings when not found" time="0.001">
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Settings &gt; PUT /v1/api/settings updates user settings" time="0.005">
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Notifications &gt; GET /v1/api/notifications/recent returns recent notifications" time="0.002">
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Notifications &gt; GET /v1/api/notifications/failed returns failed notifications" time="0.003">
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Notifications &gt; POST /v1/api/notifications/retry/:logId retries a failed notification" time="0.003">
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Devices &gt; GET /v1/api/devices returns all devices" time="0.004">
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.534Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Found devices with null username&quot;,&quot;type&quot;:&quot;general&quot;,&quot;count&quot;:1,&quot;deviceIds&quot;:[&quot;fcm-token-123...&quot;]}

            </system-err>
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Devices &gt; DELETE /v1/api/devices deletes a device" time="0.004">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.538Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Device deleted successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;deletedPushToken&quot;:&quot;fcm-token-1234567890...&quot;,&quot;deletedUserId&quot;:&quot;user-123&quot;,&quot;deletedBy&quot;:&quot;testuser&quot;,&quot;isAdmin&quot;:true}

            </system-out>
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Admin Config &gt; GET /config/get returns admin configuration" time="0.002">
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Admin Config &gt; POST /config/update updates admin configuration" time="0.002">
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Admin Config &gt; POST /v1/api/simulate-provider-failure enables simulation mode" time="0.003">
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - Admin Config &gt; POST /v1/api/disable-provider-failure disables simulation mode" time="0.002">
        </testcase>
        <testcase classname="test/api-comprehensive.spec.ts" name="API - OpenAPI &gt; GET /openapi.json returns OpenAPI specification" time="0.004">
        </testcase>
    </testsuite>
    <testsuite name="test/api-integration.spec.ts" timestamp="2025-12-20T12:24:18.168Z" hostname="sngvahmed" tests="17" failures="0" errors="0" skipped="0" time="1.36">
        <testcase classname="test/api-integration.spec.ts" name="API Integration - Health Check &gt; health endpoint returns OK status" time="0.026">
        </testcase>
        <testcase classname="test/api-integration.spec.ts" name="API Integration - Get Stock &gt; successfully fetches and returns stock data with all required fields" time="0.025">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.992Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No cache for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;cacheStatus&quot;:&quot;MISS&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.993Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /quote&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/quote&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;latencyMs&quot;:0}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.994Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /profile&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/profile&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;latencyMs&quot;:0}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.994Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Profile API response&quot;,&quot;type&quot;:&quot;general&quot;,&quot;endpoint&quot;:&quot;https://financialmodelingprep.com/stable/profile?symbol=AAPL&amp;apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM&quot;,&quot;responseType&quot;:&quot;array&quot;,&quot;responseLength&quot;:1}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.994Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Found description from profile&quot;,&quot;type&quot;:&quot;general&quot;,&quot;descriptionLength&quot;:38}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.994Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Final description resolved&quot;,&quot;type&quot;:&quot;general&quot;,&quot;hasDescription&quot;:true,&quot;descriptionLength&quot;:38,&quot;source&quot;:&quot;profile&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/api-integration.spec.ts" name="API Integration - Get Stock &gt; returns error when symbol is missing" time="0.021">
        </testcase>
        <testcase classname="test/api-integration.spec.ts" name="API Integration - Get Stock &gt; uses cache when available" time="0.024">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.042Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Cache hit for MSFT&quot;,&quot;type&quot;:&quot;general&quot;,&quot;ageSeconds&quot;:0,&quot;pollingIntervalSec&quot;:30,&quot;cacheStatus&quot;:&quot;HIT&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/api-integration.spec.ts" name="API Integration - Get Stocks &gt; successfully fetches multiple stocks with all required fields" time="0.021">
        </testcase>
        <testcase classname="test/api-integration.spec.ts" name="API Integration - Get Stocks &gt; returns error when symbols parameter is missing" time="0.018">
        </testcase>
        <testcase classname="test/api-integration.spec.ts" name="API Integration - Get Stocks &gt; handles empty symbols list" time="0.017">
        </testcase>
        <testcase classname="test/api-integration.spec.ts" name="API Integration - Search Stock &gt; successfully searches and returns matching stocks" time="0.021">
        </testcase>
        <testcase classname="test/api-integration.spec.ts" name="API Integration - Search Stock &gt; returns empty array when query parameter is missing" time="0.012">
        </testcase>
        <testcase classname="test/api-integration.spec.ts" name="API Integration - Get Historical &gt; successfully fetches historical price data" time="1.069">
            <system-out>
[getHistoricalPricesByDateRange] Querying database for AAPL from 2025-06-23 to 2025-12-20

[getHistoricalPricesByDateRange] Found 3 records for AAPL in date range 2025-06-23 to 2025-12-20

[get-historical] Query result for AAPL (2025-06-23 to 2025-12-20): 3 records found in database
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.189Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No historical data in database for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;dateRange&quot;:&quot;2025-06-23 to 2025-12-20&quot;,&quot;action&quot;:&quot;fetching from FMP API&quot;}
[fetchAndSaveHistoricalPrice] Starting fetch for AAPL from FMP API
[fetchAndSaveHistoricalPrice] Fetching from: https://financialmodelingprep.com/stable/historical-chart/30min?symbol=AAPL&amp;apikey=***&amp;from=2025-06-23&amp;to=2025-12-20

[fetchAndSaveHistoricalPrice] Received 254 1-hour OHLC records from FMP API
[fetchAndSaveHistoricalPrice] FMP API returned 254 records for AAPL
[fetchAndSaveHistoricalPrice] Sample record structure: {
  date: &apos;2025-12-19 15:30:00&apos;,
  hasOpen: true,
  hasHigh: true,
  hasLow: true,
  hasClose: true,
  hasPrice: false,
  keys: [ &apos;date&apos;, &apos;open&apos;, &apos;low&apos;, &apos;high&apos;, &apos;close&apos;, &apos;volume&apos; ]
}
Saved 20 daily candles (aggregated from 254 1-hour records) for AAPL with OHLC data

[getHistoricalPricesByDateRange] Querying database for AAPL from 2025-06-23 to 2025-12-20

[getHistoricalPricesByDateRange] Found 3 records for AAPL in date range 2025-06-23 to 2025-12-20

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.252Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;After FMP fetch, query result for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;dateRange&quot;:&quot;2025-06-23 to 2025-12-20&quot;,&quot;recordCount&quot;:3}
[get-historical] Successfully fetched 3 historical records for AAPL from FMP API

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.188Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Found 3 records with missing OHLC data&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbol&quot;:&quot;AAPL&quot;,&quot;recordsWithMissingOHLC&quot;:3,&quot;totalRecords&quot;:3}

[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-11-21, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-11-21: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-11-24, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-11-24: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-11-25, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-11-25: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-11-26, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-11-26: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-11-28, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-11-28: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-12-01, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-12-01: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-12-02, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-12-02: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-12-03, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-12-03: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-12-04, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-12-04: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-12-05, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-12-05: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-12-08, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-12-08: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-12-09, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-12-09: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-12-10, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-12-10: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-12-11, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-12-11: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-12-12, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-12-12: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-12-15, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-12-15: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-12-16, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-12-16: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-12-17, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-12-17: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-12-18, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-12-18: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-12-19, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-12-19: env.stockly.prepare(...).bind(...).run is not a function

            </system-err>
        </testcase>
        <testcase classname="test/api-integration.spec.ts" name="API Integration - Get Historical &gt; returns error when symbol is missing" time="0.004">
        </testcase>
        <testcase classname="test/api-integration.spec.ts" name="API Integration - Get Historical &gt; validates days parameter" time="0.003">
        </testcase>
        <testcase classname="test/api-integration.spec.ts" name="API Integration - Alerts &gt; successfully lists all alerts" time="0.003">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.264Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Alerts request authenticated&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;isAdmin&quot;:false,&quot;requestUsername&quot;:&quot;testuser&quot;,&quot;method&quot;:&quot;GET&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.264Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Fetched alerts from D1&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;alertCount&quot;:1,&quot;alertIds&quot;:[&quot;123e4567-e89b-12d3-a456-426614174000&quot;]}

            </system-out>
        </testcase>
        <testcase classname="test/api-integration.spec.ts" name="API Integration - Alerts &gt; successfully creates an alert" time="0.002">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.266Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Alerts request authenticated&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;isAdmin&quot;:false,&quot;requestUsername&quot;:&quot;testuser&quot;,&quot;method&quot;:&quot;POST&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.267Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Creating alert&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;symbol&quot;:&quot;AAPL&quot;,&quot;direction&quot;:&quot;above&quot;,&quot;threshold&quot;:200}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.267Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Created alert successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertId&quot;:&quot;123e4567-e89b-12d3-a456-426614174000&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;isAdmin&quot;:false}

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.267Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Alert created with mismatched username&quot;,&quot;type&quot;:&quot;general&quot;,&quot;error&quot;:&quot;[object Object]&quot;}

            </system-err>
        </testcase>
        <testcase classname="test/api-integration.spec.ts" name="API Integration - Alerts &gt; successfully updates an alert" time="0.003">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.269Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Alerts request authenticated&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;isAdmin&quot;:false,&quot;requestUsername&quot;:&quot;testuser&quot;,&quot;method&quot;:&quot;PUT&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.270Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Updated alert&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertId&quot;:&quot;123e4567-e89b-12d3-a456-426614174000&quot;,&quot;username&quot;:&quot;testuser&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/api-integration.spec.ts" name="API Integration - Alerts &gt; successfully deletes an alert" time="0.003">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.272Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Alerts request authenticated&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;isAdmin&quot;:false,&quot;requestUsername&quot;:&quot;testuser&quot;,&quot;method&quot;:&quot;DELETE&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.273Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Deleted alert&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertId&quot;:&quot;123e4567-e89b-12d3-a456-426614174000&quot;,&quot;username&quot;:&quot;testuser&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/api-integration.spec.ts" name="API Integration - Alerts &gt; returns 404 when alert not found" time="0.003">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.275Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Alerts request authenticated&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;isAdmin&quot;:false,&quot;requestUsername&quot;:&quot;testuser&quot;,&quot;method&quot;:&quot;GET&quot;}

            </system-out>
        </testcase>
    </testsuite>
    <testsuite name="test/api-schema-validation.spec.ts" timestamp="2025-12-20T12:24:18.173Z" hostname="sngvahmed" tests="16" failures="0" errors="0" skipped="0" time="1.317">
        <testcase classname="test/api-schema-validation.spec.ts" name="API Schema Validation - Health Check &gt; health endpoint returns valid HealthCheckResponse schema" time="0.027">
        </testcase>
        <testcase classname="test/api-schema-validation.spec.ts" name="API Schema Validation - Get Stock &gt; getStock returns valid StockQuoteResponse schema on success" time="0.028">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.001Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No cache for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;cacheStatus&quot;:&quot;MISS&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.002Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /quote&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/quote&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;latencyMs&quot;:0}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.003Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /profile&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/profile&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;latencyMs&quot;:0}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.003Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Profile API response&quot;,&quot;type&quot;:&quot;general&quot;,&quot;endpoint&quot;:&quot;https://financialmodelingprep.com/stable/profile?symbol=AAPL&amp;apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM&quot;,&quot;responseType&quot;:&quot;array&quot;,&quot;responseLength&quot;:1}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.003Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Found description from profile&quot;,&quot;type&quot;:&quot;general&quot;,&quot;descriptionLength&quot;:38}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.003Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Final description resolved&quot;,&quot;type&quot;:&quot;general&quot;,&quot;hasDescription&quot;:true,&quot;descriptionLength&quot;:38,&quot;source&quot;:&quot;profile&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/api-schema-validation.spec.ts" name="API Schema Validation - Get Stock &gt; getStock returns valid ErrorResponse schema on error" time="0.018">
        </testcase>
        <testcase classname="test/api-schema-validation.spec.ts" name="API Schema Validation - Get Stocks &gt; getStocks returns valid StockQuotesResponse schema on success" time="0.019">
        </testcase>
        <testcase classname="test/api-schema-validation.spec.ts" name="API Schema Validation - Get Stocks &gt; getStocks returns valid ErrorResponse schema on error" time="0.018">
        </testcase>
        <testcase classname="test/api-schema-validation.spec.ts" name="API Schema Validation - Search Stock &gt; searchStock returns valid SearchStockResponse schema" time="0.016">
        </testcase>
        <testcase classname="test/api-schema-validation.spec.ts" name="API Schema Validation - Get Historical &gt; getHistorical returns valid HistoricalPricesResponse schema" time="1.065">
            <system-out>
[getHistoricalPricesByDateRange] Querying database for AAPL from 2025-06-23 to 2025-12-20

[getHistoricalPricesByDateRange] Found 2 records for AAPL in date range 2025-06-23 to 2025-12-20

[get-historical] Query result for AAPL (2025-06-23 to 2025-12-20): 2 records found in database
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.160Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No historical data in database for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;dateRange&quot;:&quot;2025-06-23 to 2025-12-20&quot;,&quot;action&quot;:&quot;fetching from FMP API&quot;}
[fetchAndSaveHistoricalPrice] Starting fetch for AAPL from FMP API
[fetchAndSaveHistoricalPrice] Fetching from: https://financialmodelingprep.com/stable/historical-chart/30min?symbol=AAPL&amp;apikey=***&amp;from=2025-06-23&amp;to=2025-12-20

[fetchAndSaveHistoricalPrice] Received 254 1-hour OHLC records from FMP API
[fetchAndSaveHistoricalPrice] FMP API returned 254 records for AAPL
[fetchAndSaveHistoricalPrice] Sample record structure: {
  date: &apos;2025-12-19 15:30:00&apos;,
  hasOpen: true,
  hasHigh: true,
  hasLow: true,
  hasClose: true,
  hasPrice: false,
  keys: [ &apos;date&apos;, &apos;open&apos;, &apos;low&apos;, &apos;high&apos;, &apos;close&apos;, &apos;volume&apos; ]
}
Saved 20 daily candles (aggregated from 254 1-hour records) for AAPL with OHLC data

[getHistoricalPricesByDateRange] Querying database for AAPL from 2025-06-23 to 2025-12-20

[getHistoricalPricesByDateRange] Found 2 records for AAPL in date range 2025-06-23 to 2025-12-20

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.209Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;After FMP fetch, query result for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;dateRange&quot;:&quot;2025-06-23 to 2025-12-20&quot;,&quot;recordCount&quot;:2}
[get-historical] Successfully fetched 2 historical records for AAPL from FMP API

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.160Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Found 2 records with missing OHLC data&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbol&quot;:&quot;AAPL&quot;,&quot;recordsWithMissingOHLC&quot;:2,&quot;totalRecords&quot;:2}

[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-11-21, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-11-21: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-11-24, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-11-24: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-11-25, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-11-25: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-11-26, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-11-26: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-11-28, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-11-28: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-12-01, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-12-01: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-12-02, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-12-02: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-12-03, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-12-03: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-12-04, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-12-04: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-12-05, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-12-05: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-12-08, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-12-08: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-12-09, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-12-09: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-12-10, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-12-10: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-12-11, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-12-11: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-12-12, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-12-12: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-12-15, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-12-15: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-12-16, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-12-16: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-12-17, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-12-17: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-12-18, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-12-18: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Insert with OHLC failed for AAPL on 2025-12-19, trying fallback without OHLC: env.stockly.prepare(...).bind(...).run is not a function
[fetchAndSaveHistoricalPrice] Failed to insert historical record for AAPL on 2025-12-19: env.stockly.prepare(...).bind(...).run is not a function

            </system-err>
        </testcase>
        <testcase classname="test/api-schema-validation.spec.ts" name="API Schema Validation - Get Historical &gt; getHistorical returns valid ErrorResponse schema on error" time="0.003">
        </testcase>
        <testcase classname="test/api-schema-validation.spec.ts" name="API Schema Validation - Alerts &gt; listAlerts returns valid AlertsListResponse schema" time="0.004">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.223Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Alerts request authenticated&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;isAdmin&quot;:false,&quot;requestUsername&quot;:&quot;testuser&quot;,&quot;method&quot;:&quot;GET&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.223Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Fetched alerts from D1&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;alertCount&quot;:1,&quot;alertIds&quot;:[&quot;123e4567-e89b-12d3-a456-426614174000&quot;]}

            </system-out>
        </testcase>
        <testcase classname="test/api-schema-validation.spec.ts" name="API Schema Validation - Alerts &gt; createAlert accepts valid CreateAlertRequest schema" time="0.004">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.226Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Alerts request authenticated&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;isAdmin&quot;:false,&quot;requestUsername&quot;:&quot;testuser&quot;,&quot;method&quot;:&quot;POST&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.227Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Creating alert&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;symbol&quot;:&quot;AAPL&quot;,&quot;direction&quot;:&quot;above&quot;,&quot;threshold&quot;:200}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.227Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Created alert successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertId&quot;:&quot;123e4567-e89b-12d3-a456-426614174000&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;isAdmin&quot;:false}

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.227Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Alert created with mismatched username&quot;,&quot;type&quot;:&quot;general&quot;,&quot;error&quot;:&quot;[object Object]&quot;}

            </system-err>
        </testcase>
        <testcase classname="test/api-schema-validation.spec.ts" name="API Schema Validation - Alerts &gt; updateAlert accepts valid UpdateAlertRequest schema" time="0.004">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.231Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Alerts request authenticated&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;isAdmin&quot;:false,&quot;requestUsername&quot;:&quot;testuser&quot;,&quot;method&quot;:&quot;PUT&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.231Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Updated alert&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertId&quot;:&quot;123&quot;,&quot;username&quot;:&quot;testuser&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/api-schema-validation.spec.ts" name="API Schema Validation - Alerts &gt; getAlert returns valid Alert schema" time="0.003">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.234Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Alerts request authenticated&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;isAdmin&quot;:false,&quot;requestUsername&quot;:&quot;testuser&quot;,&quot;method&quot;:&quot;GET&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/api-schema-validation.spec.ts" name="API Schema Validation - Input Validation &gt; rejects invalid CreateAlertRequest" time="0.003">
        </testcase>
        <testcase classname="test/api-schema-validation.spec.ts" name="API Schema Validation - Input Validation &gt; accepts valid CreateAlertRequest with optional fields" time="0.001">
        </testcase>
        <testcase classname="test/api-schema-validation.spec.ts" name="API Schema Validation - Input Validation &gt; rejects invalid UpdateAlertRequest" time="0.002">
        </testcase>
        <testcase classname="test/api-schema-validation.spec.ts" name="API Schema Validation - Input Validation &gt; accepts partial UpdateAlertRequest" time="0.002">
        </testcase>
    </testsuite>
    <testsuite name="test/cache.spec.ts" timestamp="2025-12-20T12:24:18.179Z" hostname="sngvahmed" tests="2" failures="0" errors="0" skipped="0" time="0.192">
        <testcase classname="test/cache.spec.ts" name="cache helpers &gt; returns cached entries while TTL is valid" time="0.036">
        </testcase>
        <testcase classname="test/cache.spec.ts" name="cache helpers &gt; expires entries once TTL elapses" time="0.044">
        </testcase>
    </testsuite>
    <testsuite name="test/config.spec.ts" timestamp="2025-12-20T12:24:18.179Z" hostname="sngvahmed" tests="13" failures="0" errors="0" skipped="0" time="0.97">
        <testcase classname="test/config.spec.ts" name="Config System &gt; getConfig &gt; returns default config when KV is not available" time="0.038">
            <system-err>
alertsKv not available, using default config

            </system-err>
        </testcase>
        <testcase classname="test/config.spec.ts" name="Config System &gt; getConfig &gt; returns default config when no stored config exists" time="0.078">
        </testcase>
        <testcase classname="test/config.spec.ts" name="Config System &gt; getConfig &gt; returns stored config when available" time="0.04">
        </testcase>
        <testcase classname="test/config.spec.ts" name="Config System &gt; getConfig &gt; merges partial stored config with defaults" time="0.095">
        </testcase>
        <testcase classname="test/config.spec.ts" name="Config System &gt; updateConfig &gt; updates config with new values" time="0.074">
        </testcase>
        <testcase classname="test/config.spec.ts" name="Config System &gt; updateConfig &gt; merges nested objects correctly" time="0.041">
        </testcase>
        <testcase classname="test/config.spec.ts" name="Config System &gt; simulateProviderFailureEndpoint &gt; enables simulation mode" time="0.043">
        </testcase>
        <testcase classname="test/config.spec.ts" name="Config System &gt; simulateProviderFailureEndpoint &gt; persists the config change" time="0.056">
        </testcase>
        <testcase classname="test/config.spec.ts" name="Config System &gt; disableProviderFailureEndpoint &gt; disables simulation mode" time="0.037">
        </testcase>
        <testcase classname="test/config.spec.ts" name="Config System &gt; disableProviderFailureEndpoint &gt; persists the config change" time="0.046">
        </testcase>
        <testcase classname="test/config.spec.ts" name="Config System &gt; Error Handling &gt; getConfig catches errors and returns default" time="0.035">
        </testcase>
        <testcase classname="test/config.spec.ts" name="Config System &gt; Error Handling &gt; updateConfig throws on error" time="0.052">
        </testcase>
        <testcase classname="test/config.spec.ts" name="Config System &gt; Error Handling &gt; updateConfig warns when KV is missing" time="0.03">
        </testcase>
    </testsuite>
    <testsuite name="test/devices.spec.ts" timestamp="2025-12-20T12:24:18.181Z" hostname="sngvahmed" tests="9" failures="0" errors="0" skipped="0" time="0.528">
        <testcase classname="test/devices.spec.ts" name="Devices API &gt; getAllDevices &gt; should return list of devices" time="0.039">
        </testcase>
        <testcase classname="test/devices.spec.ts" name="Devices API &gt; getAllDevices &gt; should return empty array when no devices" time="0.068">
        </testcase>
        <testcase classname="test/devices.spec.ts" name="Devices API &gt; getAllDevices &gt; should handle database errors" time="0.039">
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.468Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Failed to get devices&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:null,&quot;error&quot;:{&quot;name&quot;:&quot;Error&quot;,&quot;message&quot;:&quot;Database error&quot;,&quot;stack&quot;:&quot;Error: Database error\n    at Object.&lt;anonymous&gt; (/home/sngvahmed/workspace/stockly/api/test/devices.spec.ts:141:42)\n    at Object.mockCall (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/spy/dist/index.js:96:15)\n    at Object.spy [as prepare] (home/sngvahmed/workspace/stockly/api/node_modules/tinyspy/dist/index.js:47:80)\n    at Module.getAllDevices (/home/sngvahmed/workspace/stockly/api/src/api/devices.ts:69:12)\n    at /home/sngvahmed/workspace/stockly/api/test/devices.spec.ts:146:24\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20&quot;}}

            </system-err>
        </testcase>
        <testcase classname="test/devices.spec.ts" name="Devices API &gt; sendTestNotification &gt; should send test notification successfully" time="0.054">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.568Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;user-1&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Test notification sent successfully&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/devices.spec.ts" name="Devices API &gt; sendTestNotification &gt; should use default message when no custom message provided" time="0.038">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.599Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;user-1&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Test notification sent successfully&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/devices.spec.ts" name="Devices API &gt; sendTestNotification &gt; should return 404 when device not found" time="0.033">
        </testcase>
        <testcase classname="test/devices.spec.ts" name="Devices API &gt; sendTestNotification &gt; should return 400 when userId is missing" time="0.033">
        </testcase>
        <testcase classname="test/devices.spec.ts" name="Devices API &gt; sendTestNotification &gt; should return 405 for non-POST methods" time="0.039">
        </testcase>
        <testcase classname="test/devices.spec.ts" name="Devices API &gt; sendTestNotification &gt; should handle FCM send failures" time="0.047">
            <system-err>
Failed to get Google access token: TypeError: response.text is not a function
    at getGoogleAccessTokenFromJWT (/home/sngvahmed/workspace/stockly/api/src/notifications/jwt-helper.ts:118:38)
    at getGoogleAccessToken (/home/sngvahmed/workspace/stockly/api/src/notifications/fcm-sender.ts:192:25)
    at sendFCMNotificationWithLogs (/home/sngvahmed/workspace/stockly/api/src/notifications/fcm-sender.ts:269:19)
    at sendFCMNotification (/home/sngvahmed/workspace/stockly/api/src/notifications/fcm-sender.ts:474:18)
    at Module.sendTestNotification (/home/sngvahmed/workspace/stockly/api/src/api/devices.ts:501:21)
    at /home/sngvahmed/workspace/stockly/api/test/devices.spec.ts:434:24
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20

            </system-err>
        </testcase>
    </testsuite>
    <testsuite name="test/get-historical.spec.ts" timestamp="2025-12-20T12:24:18.183Z" hostname="sngvahmed" tests="28" failures="0" errors="0" skipped="0" time="4.754">
        <testcase classname="test/get-historical.spec.ts" name="getHistorical handler &gt; Parameter validation &gt; requires a symbol parameter" time="0.043">
        </testcase>
        <testcase classname="test/get-historical.spec.ts" name="getHistorical handler &gt; Parameter validation &gt; accepts symbol parameter" time="0.534">
            <system-out>
[get-historical] Query result for AAPL (2025-06-23 to 2025-12-20): 0 records found in database
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.338Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No historical data in database for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;dateRange&quot;:&quot;2025-06-23 to 2025-12-20&quot;,&quot;action&quot;:&quot;fetching from FMP API&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.839Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;After FMP fetch, query result for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;dateRange&quot;:&quot;2025-06-23 to 2025-12-20&quot;,&quot;recordCount&quot;:0}

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.839Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Still no data after fetching from FMP API for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;dateRange&quot;:&quot;2025-06-23 to 2025-12-20&quot;,&quot;possibleReasons&quot;:[&quot;FMP API returned empty data&quot;,&quot;FMP API returned data outside the requested date range&quot;,&quot;Date range is in the future or has no trading days&quot;,&quot;Database schema missing OHLC columns (check migration 009)&quot;]}

            </system-err>
        </testcase>
        <testcase classname="test/get-historical.spec.ts" name="getHistorical handler &gt; Parameter validation &gt; normalizes symbol to uppercase" time="0.52">
            <system-out>
[get-historical] Query result for AAPL (2025-06-23 to 2025-12-20): 0 records found in database
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.872Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No historical data in database for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;dateRange&quot;:&quot;2025-06-23 to 2025-12-20&quot;,&quot;action&quot;:&quot;fetching from FMP API&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.374Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;After FMP fetch, query result for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;dateRange&quot;:&quot;2025-06-23 to 2025-12-20&quot;,&quot;recordCount&quot;:0}

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.374Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Still no data after fetching from FMP API for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;dateRange&quot;:&quot;2025-06-23 to 2025-12-20&quot;,&quot;possibleReasons&quot;:[&quot;FMP API returned empty data&quot;,&quot;FMP API returned data outside the requested date range&quot;,&quot;Date range is in the future or has no trading days&quot;,&quot;Database schema missing OHLC columns (check migration 009)&quot;]}

            </system-err>
        </testcase>
        <testcase classname="test/get-historical.spec.ts" name="getHistorical handler &gt; Date range parameters (from/to) &gt; accepts from and to parameters" time="0.003">
            <system-out>
[get-historical] Query result for AAPL (2025-01-01 to 2025-01-31): 3 records found in database

            </system-out>
        </testcase>
        <testcase classname="test/get-historical.spec.ts" name="getHistorical handler &gt; Date range parameters (from/to) &gt; validates from date format" time="0.002">
        </testcase>
        <testcase classname="test/get-historical.spec.ts" name="getHistorical handler &gt; Date range parameters (from/to) &gt; validates to date format" time="0.002">
        </testcase>
        <testcase classname="test/get-historical.spec.ts" name="getHistorical handler &gt; Date range parameters (from/to) &gt; validates that from date is before to date" time="0.002">
        </testcase>
        <testcase classname="test/get-historical.spec.ts" name="getHistorical handler &gt; Date range parameters (from/to) &gt; allows from and to to be the same date" time="0.002">
            <system-out>
[get-historical] Query result for AAPL (2025-01-01 to 2025-01-01): 1 records found in database

            </system-out>
        </testcase>
        <testcase classname="test/get-historical.spec.ts" name="getHistorical handler &gt; Date range parameters (from/to) &gt; defaults to today when only &apos;to&apos; is provided" time="0.505">
            <system-out>
[get-historical] Query result for AAPL (2024-08-03 to 2025-01-31): 0 records found in database
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.392Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No historical data in database for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;dateRange&quot;:&quot;2024-08-03 to 2025-01-31&quot;,&quot;action&quot;:&quot;fetching from FMP API&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.893Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;After FMP fetch, query result for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;dateRange&quot;:&quot;2024-08-03 to 2025-01-31&quot;,&quot;recordCount&quot;:0}

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.893Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Still no data after fetching from FMP API for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;dateRange&quot;:&quot;2024-08-03 to 2025-01-31&quot;,&quot;possibleReasons&quot;:[&quot;FMP API returned empty data&quot;,&quot;FMP API returned data outside the requested date range&quot;,&quot;Date range is in the future or has no trading days&quot;,&quot;Database schema missing OHLC columns (check migration 009)&quot;]}

            </system-err>
        </testcase>
        <testcase classname="test/get-historical.spec.ts" name="getHistorical handler &gt; Date range parameters (from/to) &gt; defaults to today when only &apos;from&apos; is provided" time="0.507">
            <system-out>
[get-historical] Query result for AAPL (2025-01-01 to 2025-12-20): 0 records found in database
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.898Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No historical data in database for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;dateRange&quot;:&quot;2025-01-01 to 2025-12-20&quot;,&quot;action&quot;:&quot;fetching from FMP API&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.399Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;After FMP fetch, query result for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;dateRange&quot;:&quot;2025-01-01 to 2025-12-20&quot;,&quot;recordCount&quot;:0}

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.399Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Still no data after fetching from FMP API for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;dateRange&quot;:&quot;2025-01-01 to 2025-12-20&quot;,&quot;possibleReasons&quot;:[&quot;FMP API returned empty data&quot;,&quot;FMP API returned data outside the requested date range&quot;,&quot;Date range is in the future or has no trading days&quot;,&quot;Database schema missing OHLC columns (check migration 009)&quot;]}

            </system-err>
        </testcase>
        <testcase classname="test/get-historical.spec.ts" name="getHistorical handler &gt; Days parameter (backward compatibility) &gt; accepts days parameter" time="0.004">
            <system-out>
[get-historical] Query result for AAPL (2025-11-20 to 2025-12-20): 2 records found in database

            </system-out>
        </testcase>
        <testcase classname="test/get-historical.spec.ts" name="getHistorical handler &gt; Days parameter (backward compatibility) &gt; defaults to 180 days when no parameters provided" time="0.505">
            <system-out>
[get-historical] Query result for AAPL (2025-06-23 to 2025-12-20): 0 records found in database
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.409Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No historical data in database for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;dateRange&quot;:&quot;2025-06-23 to 2025-12-20&quot;,&quot;action&quot;:&quot;fetching from FMP API&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.910Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;After FMP fetch, query result for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;dateRange&quot;:&quot;2025-06-23 to 2025-12-20&quot;,&quot;recordCount&quot;:0}

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.910Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Still no data after fetching from FMP API for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;dateRange&quot;:&quot;2025-06-23 to 2025-12-20&quot;,&quot;possibleReasons&quot;:[&quot;FMP API returned empty data&quot;,&quot;FMP API returned data outside the requested date range&quot;,&quot;Date range is in the future or has no trading days&quot;,&quot;Database schema missing OHLC columns (check migration 009)&quot;]}

            </system-err>
        </testcase>
        <testcase classname="test/get-historical.spec.ts" name="getHistorical handler &gt; Days parameter (backward compatibility) &gt; validates days parameter minimum value" time="0.003">
        </testcase>
        <testcase classname="test/get-historical.spec.ts" name="getHistorical handler &gt; Days parameter (backward compatibility) &gt; validates days parameter maximum value" time="0.001">
        </testcase>
        <testcase classname="test/get-historical.spec.ts" name="getHistorical handler &gt; Days parameter (backward compatibility) &gt; validates days parameter is a number" time="0.002">
        </testcase>
        <testcase classname="test/get-historical.spec.ts" name="getHistorical handler &gt; Parameter priority &gt; prioritizes from/to parameters over days parameter" time="0.002">
            <system-out>
[get-historical] Query result for AAPL (2025-01-01 to 2025-01-31): 1 records found in database

            </system-out>
        </testcase>
        <testcase classname="test/get-historical.spec.ts" name="getHistorical handler &gt; Database query &gt; queries database with correct date range" time="0.004">
            <system-out>
[get-historical] Query result for AAPL (2025-01-01 to 2025-01-31): 2 records found in database

            </system-out>
        </testcase>
        <testcase classname="test/get-historical.spec.ts" name="getHistorical handler &gt; Database query &gt; returns data from database when available" time="0.003">
            <system-out>
[get-historical] Query result for AAPL (2025-01-01 to 2025-01-31): 3 records found in database

            </system-out>
        </testcase>
        <testcase classname="test/get-historical.spec.ts" name="getHistorical handler &gt; Database query &gt; returns empty array when database has no data" time="0.506">
            <system-out>
[get-historical] Query result for AAPL (2025-01-01 to 2025-01-31): 0 records found in database
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.933Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No historical data in database for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;dateRange&quot;:&quot;2025-01-01 to 2025-01-31&quot;,&quot;action&quot;:&quot;fetching from FMP API&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:09.434Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;After FMP fetch, query result for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;dateRange&quot;:&quot;2025-01-01 to 2025-01-31&quot;,&quot;recordCount&quot;:0}

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:09.435Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Still no data after fetching from FMP API for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;dateRange&quot;:&quot;2025-01-01 to 2025-01-31&quot;,&quot;possibleReasons&quot;:[&quot;FMP API returned empty data&quot;,&quot;FMP API returned data outside the requested date range&quot;,&quot;Date range is in the future or has no trading days&quot;,&quot;Database schema missing OHLC columns (check migration 009)&quot;]}

            </system-err>
        </testcase>
        <testcase classname="test/get-historical.spec.ts" name="getHistorical handler &gt; FMP API fallback &gt; fetches from FMP API when database is empty and ctx is available" time="0.505">
            <system-out>
[get-historical] Query result for AAPL (2025-01-01 to 2025-01-31): 0 records found in database
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:09.442Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No historical data in database for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;dateRange&quot;:&quot;2025-01-01 to 2025-01-31&quot;,&quot;action&quot;:&quot;fetching from FMP API&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:09.942Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;After FMP fetch, query result for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;dateRange&quot;:&quot;2025-01-01 to 2025-01-31&quot;,&quot;recordCount&quot;:1}
[get-historical] Successfully fetched 1 historical records for AAPL from FMP API

            </system-out>
        </testcase>
        <testcase classname="test/get-historical.spec.ts" name="getHistorical handler &gt; FMP API fallback &gt; creates fallback ExecutionContext when ctx is not available and fetches from FMP API" time="0.505">
            <system-out>
[get-historical] Query result for AAPL (2025-01-01 to 2025-01-31): 0 records found in database
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:09.947Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No historical data in database for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;dateRange&quot;:&quot;2025-01-01 to 2025-01-31&quot;,&quot;action&quot;:&quot;fetching from FMP API&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:10.448Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;After FMP fetch, query result for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;dateRange&quot;:&quot;2025-01-01 to 2025-01-31&quot;,&quot;recordCount&quot;:1}
[get-historical] Successfully fetched 1 historical records for AAPL from FMP API

            </system-out>
        </testcase>
        <testcase classname="test/get-historical.spec.ts" name="getHistorical handler &gt; FMP API fallback &gt; handles FMP API fetch errors gracefully" time="0.003">
            <system-out>
[get-historical] Query result for AAPL (2025-01-01 to 2025-01-31): 0 records found in database
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:10.453Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No historical data in database for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;dateRange&quot;:&quot;2025-01-01 to 2025-01-31&quot;,&quot;action&quot;:&quot;fetching from FMP API&quot;}

            </system-out>
            <system-err>
[get-historical] Error fetching historical data from FMP API for AAPL: FMP API error

            </system-err>
        </testcase>
        <testcase classname="test/get-historical.spec.ts" name="getHistorical handler &gt; Response format &gt; returns correct response format with from/to parameters" time="0.003">
            <system-out>
[get-historical] Query result for AAPL (2025-01-01 to 2025-01-31): 1 records found in database

            </system-out>
        </testcase>
        <testcase classname="test/get-historical.spec.ts" name="getHistorical handler &gt; Response format &gt; returns correct response format with days parameter" time="0.002">
            <system-out>
[get-historical] Query result for AAPL (2025-11-20 to 2025-12-20): 1 records found in database

            </system-out>
        </testcase>
        <testcase classname="test/get-historical.spec.ts" name="getHistorical handler &gt; Response format &gt; includes all required fields in data items" time="0.003">
            <system-out>
[get-historical] Query result for AAPL (2025-01-01 to 2025-01-31): 1 records found in database

            </system-out>
        </testcase>
        <testcase classname="test/get-historical.spec.ts" name="getHistorical handler &gt; Missing OHLC data handling &gt; re-fetches from FMP API when OHLC data is missing (null)" time="0.506">
            <system-out>
[get-historical] Query result for AAPL (2025-01-01 to 2025-01-31): 1 records found in database
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:10.467Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No historical data in database for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;dateRange&quot;:&quot;2025-01-01 to 2025-01-31&quot;,&quot;action&quot;:&quot;fetching from FMP API&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:10.968Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;After FMP fetch, query result for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;dateRange&quot;:&quot;2025-01-01 to 2025-01-31&quot;,&quot;recordCount&quot;:1}
[get-historical] Successfully fetched 1 historical records for AAPL from FMP API

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:10.467Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Found 1 records with missing OHLC data&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbol&quot;:&quot;AAPL&quot;,&quot;recordsWithMissingOHLC&quot;:1,&quot;totalRecords&quot;:1}

            </system-err>
        </testcase>
        <testcase classname="test/get-historical.spec.ts" name="getHistorical handler &gt; Missing OHLC data handling &gt; does not re-fetch when OHLC data is present" time="0.003">
            <system-out>
[get-historical] Query result for AAPL (2025-01-01 to 2025-01-31): 1 records found in database

            </system-out>
        </testcase>
        <testcase classname="test/get-historical.spec.ts" name="getHistorical handler &gt; Error handling &gt; handles database query errors gracefully" time="0.008">
            <system-err>
ERROR in getHistorical for AAPL: Error: Database error
    at /home/sngvahmed/workspace/stockly/api/test/get-historical.spec.ts:816:67
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20
    at new Promise (&lt;anonymous&gt;)
    at runWithTimeout (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)
    at runTest (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)

            </system-err>
        </testcase>
    </testsuite>
    <testsuite name="test/get-news.spec.ts" timestamp="2025-12-20T12:24:18.191Z" hostname="sngvahmed" tests="11" failures="0" errors="0" skipped="0" time="0.496">
        <testcase classname="test/get-news.spec.ts" name="News API &gt; getGeneralNews &gt; should return general news from FMP API" time="0.04">
            <system-out>
[News Cache] Cleared all news cache

[News Cache] Queued news update for news:general (1 pending writes)
[News Cache] Flushing 1 pending writes to KV...

[News Cache] Flushed 1/1 writes to KV

            </system-out>
        </testcase>
        <testcase classname="test/get-news.spec.ts" name="News API &gt; getGeneralNews &gt; should handle API errors gracefully" time="0.043">
            <system-out>
[News Cache] Cleared all news cache

            </system-out>
            <system-err>
Failed to fetch general news from FMP API: Error: API error
    at /home/sngvahmed/workspace/stockly/api/test/get-news.spec.ts:75:45
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20
    at new Promise (&lt;anonymous&gt;)
    at runWithTimeout (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)
    at runTest (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.724Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Failed to fetch general news&quot;,&quot;type&quot;:&quot;general&quot;,&quot;error&quot;:{&quot;name&quot;:&quot;Error&quot;,&quot;message&quot;:&quot;API error&quot;,&quot;stack&quot;:&quot;Error: API error\n    at /home/sngvahmed/workspace/stockly/api/test/get-news.spec.ts:75:45\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (&lt;anonymous&gt;)\n    at runWithTimeout (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)&quot;}}

            </system-err>
        </testcase>
        <testcase classname="test/get-news.spec.ts" name="News API &gt; getFavoriteNews &gt; should return news for favorite symbols" time="0.027">
            <system-out>
[News Cache] Cleared all news cache

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.800Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Fetching favorite news&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.800Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Favorite symbols found&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;symbolCount&quot;:2,&quot;symbols&quot;:[&quot;AAPL&quot;,&quot;TSLA&quot;]}

News cache miss for AAPL,TSLA, fetching from API...

[News Cache] Queued news update for news:AAPL,TSLA (1 pending writes)
[News Cache] Flushing 1 pending writes to KV...

[News Cache] Flushed 1/1 writes to KV

            </system-out>
        </testcase>
        <testcase classname="test/get-news.spec.ts" name="News API &gt; getFavoriteNews &gt; should return empty list if no favorites" time="0.028">
            <system-out>
[News Cache] Cleared all news cache

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.829Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Fetching favorite news&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.829Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No favorite symbols selected&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/get-news.spec.ts" name="News API &gt; News Archive &gt; should toggle archived news" time="0.035">
            <system-out>
[News Cache] Cleared all news cache

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.890Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Article saved successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;articleId&quot;:&quot;test-article-id&quot;,&quot;symbol&quot;:&quot;&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/get-news.spec.ts" name="News API &gt; News Archive &gt; should retrieve archived news" time="0.027">
            <system-out>
[News Cache] Cleared all news cache

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.917Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;user-123&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Fetching archived news&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;page&quot;:0,&quot;limit&quot;:20}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.917Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;user-123&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Archived news fetched successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;page&quot;:0,&quot;limit&quot;:20,&quot;total&quot;:1,&quot;returned&quot;:1,&quot;hasMore&quot;:false}

            </system-out>
        </testcase>
        <testcase classname="test/get-news.spec.ts" name="News API &gt; User Preferences &gt; should update news favorite symbols" time="0.026">
            <system-out>
[News Cache] Cleared all news cache

            </system-out>
        </testcase>
        <testcase classname="test/get-news.spec.ts" name="News API &gt; getNews &gt; should return news for a specific symbol" time="0.023">
            <system-out>
[News Cache] Cleared all news cache

News cache miss for AAPL, fetching from API...

[News Cache] Queued news update for news:AAPL (1 pending writes)
[News Cache] Flushing 1 pending writes to KV...

[News Cache] Flushed 1/1 writes to KV

            </system-out>
        </testcase>
        <testcase classname="test/get-news.spec.ts" name="News API &gt; getNews &gt; should validate pagination parameters" time="0.018">
            <system-out>
[News Cache] Cleared all news cache

            </system-out>
        </testcase>
        <testcase classname="test/get-news.spec.ts" name="News API &gt; getNews &gt; should pass pagination parameters to API" time="0.02">
            <system-out>
[News Cache] Cleared all news cache

News cache miss for AAPL, fetching from API...

            </system-out>
        </testcase>
        <testcase classname="test/get-news.spec.ts" name="News API &gt; getNews &gt; should flush KV cache pending writes" time="0.021">
            <system-out>
[News Cache] Cleared all news cache

News cache miss for AAPL, fetching from API...

[News Cache] Queued news update for news:AAPL (1 pending writes)
[News Cache] Flushing 1 pending writes to KV...

[News Cache] Flushed 1/1 writes to KV

            </system-out>
        </testcase>
    </testsuite>
    <testsuite name="test/get-stock-details.spec.ts" timestamp="2025-12-20T12:24:18.196Z" hostname="sngvahmed" tests="8" failures="0" errors="0" skipped="0" time="12.243">
        <testcase classname="test/get-stock-details.spec.ts" name="getStockDetails service &gt; returns cached data when available and valid" time="0.05">
            <system-out>
Cache hit for stock details: AAPL

            </system-out>
        </testcase>
        <testcase classname="test/get-stock-details.spec.ts" name="getStockDetails service &gt; fetches all data from FMP API when cache misses" time="0.08">
            <system-out>
Cache miss for stock details: AAPL, fetching...

            </system-out>
        </testcase>
        <testcase classname="test/get-stock-details.spec.ts" name="getStockDetails service &gt; handles partial data failures gracefully" time="3.022">
            <system-out>
Cache miss for stock details: AAPL, fetching...

            </system-out>
            <system-err>
Failed to fetch historical for AAPL: Error: Endpoint failed
    at /home/sngvahmed/workspace/stockly/api/test/get-stock-details.spec.ts:139:31
    at mockCall (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/spy/dist/index.js:96:15)
    at spy (home/sngvahmed/workspace/stockly/api/node_modules/tinyspy/dist/index.js:47:80)
    at fetchWithRetry (/home/sngvahmed/workspace/stockly/api/src/services/get-stock-details.ts:61:25)
    at async Promise.allSettled (index 2)
    at getStockDetails (/home/sngvahmed/workspace/stockly/api/src/services/get-stock-details.ts:400:9)
    at /home/sngvahmed/workspace/stockly/api/test/get-stock-details.spec.ts:142:20
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20
Failed to fetch news for AAPL: Error: Endpoint failed
    at /home/sngvahmed/workspace/stockly/api/test/get-stock-details.spec.ts:139:31
    at mockCall (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/spy/dist/index.js:96:15)
    at spy (home/sngvahmed/workspace/stockly/api/node_modules/tinyspy/dist/index.js:47:80)
    at fetchWithRetry (/home/sngvahmed/workspace/stockly/api/src/services/get-stock-details.ts:61:25)
    at async Promise.allSettled (index 5)
    at getStockDetails (/home/sngvahmed/workspace/stockly/api/src/services/get-stock-details.ts:400:9)
    at /home/sngvahmed/workspace/stockly/api/test/get-stock-details.spec.ts:142:20
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20

            </system-err>
        </testcase>
        <testcase classname="test/get-stock-details.spec.ts" name="getStockDetails service &gt; returns error when all critical endpoints fail" time="9.009">
            <system-out>
Cache miss for stock details: AAPL, fetching...

            </system-out>
            <system-err>
Failed to fetch profile for AAPL: Error: All profile endpoints failed
    at fetchProfile (/home/sngvahmed/workspace/stockly/api/src/services/get-stock-details.ts:134:9)
    at async Promise.allSettled (index 0)
    at getStockDetails (/home/sngvahmed/workspace/stockly/api/src/services/get-stock-details.ts:400:9)
    at /home/sngvahmed/workspace/stockly/api/test/get-stock-details.spec.ts:162:20
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20
Failed to fetch quote for AAPL: Error: All endpoints failed
    at /home/sngvahmed/workspace/stockly/api/test/get-stock-details.spec.ts:159:31
    at mockCall (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/spy/dist/index.js:96:15)
    at spy (home/sngvahmed/workspace/stockly/api/node_modules/tinyspy/dist/index.js:47:80)
    at fetchWithRetry (/home/sngvahmed/workspace/stockly/api/src/services/get-stock-details.ts:61:25)
    at async Promise.allSettled (index 1)
    at getStockDetails (/home/sngvahmed/workspace/stockly/api/src/services/get-stock-details.ts:400:9)
    at /home/sngvahmed/workspace/stockly/api/test/get-stock-details.spec.ts:162:20
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20
Failed to fetch historical for AAPL: Error: All endpoints failed
    at /home/sngvahmed/workspace/stockly/api/test/get-stock-details.spec.ts:159:31
    at mockCall (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/spy/dist/index.js:96:15)
    at spy (home/sngvahmed/workspace/stockly/api/node_modules/tinyspy/dist/index.js:47:80)
    at fetchWithRetry (/home/sngvahmed/workspace/stockly/api/src/services/get-stock-details.ts:61:25)
    at async Promise.allSettled (index 2)
    at getStockDetails (/home/sngvahmed/workspace/stockly/api/src/services/get-stock-details.ts:400:9)
    at /home/sngvahmed/workspace/stockly/api/test/get-stock-details.spec.ts:162:20
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20
Failed to fetch news for AAPL: Error: All endpoints failed
    at /home/sngvahmed/workspace/stockly/api/test/get-stock-details.spec.ts:159:31
    at mockCall (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/spy/dist/index.js:96:15)
    at spy (home/sngvahmed/workspace/stockly/api/node_modules/tinyspy/dist/index.js:47:80)
    at fetchWithRetry (/home/sngvahmed/workspace/stockly/api/src/services/get-stock-details.ts:61:25)
    at async Promise.allSettled (index 5)
    at getStockDetails (/home/sngvahmed/workspace/stockly/api/src/services/get-stock-details.ts:400:9)
    at /home/sngvahmed/workspace/stockly/api/test/get-stock-details.spec.ts:162:20
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20

            </system-err>
        </testcase>
        <testcase classname="test/get-stock-details.spec.ts" name="getStockDetails service &gt; normalizes chart data correctly by time periods" time="0.004">
            <system-out>
Cache miss for stock details: AAPL, fetching...

            </system-out>
        </testcase>
        <testcase classname="test/get-stock-details.spec.ts" name="getStockDetails service &gt; normalizes financial data correctly" time="0.002">
            <system-out>
Cache miss for stock details: AAPL, fetching...

            </system-out>
        </testcase>
        <testcase classname="test/get-stock-details.spec.ts" name="getStockDetails service &gt; handles malformed or empty API responses gracefully" time="0.003">
            <system-out>
Cache miss for stock details: BAD_DATA, fetching...

            </system-out>
            <system-err>
Failed to fetch profile for BAD_DATA: Error: All profile endpoints failed
    at fetchProfile (/home/sngvahmed/workspace/stockly/api/src/services/get-stock-details.ts:134:9)
    at async Promise.allSettled (index 0)
    at getStockDetails (/home/sngvahmed/workspace/stockly/api/src/services/get-stock-details.ts:400:9)
    at /home/sngvahmed/workspace/stockly/api/test/get-stock-details.spec.ts:263:20
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20

            </system-err>
        </testcase>
        <testcase classname="test/get-stock-details.spec.ts" name="getStockDetails service &gt; respects cache TTL and refetches" time="0.005">
            <system-out>
Cache miss for stock details: EXPIRED, fetching...

            </system-out>
            <system-err>
Failed to fetch profile for EXPIRED: Error: All profile endpoints failed
    at fetchProfile (/home/sngvahmed/workspace/stockly/api/src/services/get-stock-details.ts:134:9)
    at async Promise.allSettled (index 0)
    at getStockDetails (/home/sngvahmed/workspace/stockly/api/src/services/get-stock-details.ts:400:9)
    at /home/sngvahmed/workspace/stockly/api/test/get-stock-details.spec.ts:304:5
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20

            </system-err>
        </testcase>
    </testsuite>
    <testsuite name="test/get-stock-news.spec.ts" timestamp="2025-12-20T12:24:18.198Z" hostname="sngvahmed" tests="8" failures="0" errors="0" skipped="0" time="0.428">
        <testcase classname="test/get-stock-news.spec.ts" name="getStockNews handler &gt; requires a symbol" time="0.046">
        </testcase>
        <testcase classname="test/get-stock-news.spec.ts" name="getStockNews handler &gt; returns cached data without calling the upstream API" time="0.034">
            <system-out>
Cache hit for news AAPL: age=0s &lt; interval=30s

            </system-out>
        </testcase>
        <testcase classname="test/get-stock-news.spec.ts" name="getStockNews handler &gt; fetches news from FMP API when cache misses" time="0.067">
            <system-out>
No cache for news AAPL, fetching fresh data

            </system-out>
        </testcase>
        <testcase classname="test/get-stock-news.spec.ts" name="getStockNews handler &gt; returns empty array when FMP API returns empty array" time="0.031">
            <system-out>
No cache for news XYZ, fetching fresh data

            </system-out>
        </testcase>
        <testcase classname="test/get-stock-news.spec.ts" name="getStockNews handler &gt; handles API errors gracefully" time="0.061">
            <system-out>
No cache for news AAPL, fetching fresh data

            </system-out>
            <system-err>
Provider API failed for news AAPL: HTTP 500

            </system-err>
        </testcase>
        <testcase classname="test/get-stock-news.spec.ts" name="getStockNews handler &gt; handles network errors gracefully" time="0.036">
            <system-out>
No cache for news AAPL, fetching fresh data

            </system-out>
            <system-err>
Error fetching news for AAPL: Error: Failed to fetch
    at /home/sngvahmed/workspace/stockly/api/test/get-stock-news.spec.ts:185:60
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20
    at new Promise (&lt;anonymous&gt;)
    at runWithTimeout (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)
    at runTest (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)
    at runFiles (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1787:3)
Provider network error for news AAPL: Failed to fetch

            </system-err>
        </testcase>
        <testcase classname="test/get-stock-news.spec.ts" name="getStockNews handler &gt; handles simulation mode" time="0.054">
            <system-out>
No cache for news AAPL, fetching fresh data

            </system-out>
        </testcase>
        <testcase classname="test/get-stock-news.spec.ts" name="getStockNews handler &gt; normalizes news data correctly" time="0.033">
            <system-out>
No cache for news AAPL, fetching fresh data

            </system-out>
        </testcase>
    </testsuite>
    <testsuite name="test/get-stock.spec.ts" timestamp="2025-12-20T12:24:18.200Z" hostname="sngvahmed" tests="13" failures="0" errors="0" skipped="0" time="0.705">
        <testcase classname="test/get-stock.spec.ts" name="getStock handler &gt; requires a symbol" time="0.044">
        </testcase>
        <testcase classname="test/get-stock.spec.ts" name="getStock handler &gt; returns cached data without calling the upstream API" time="0.035">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.475Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Cache hit for MSFT&quot;,&quot;type&quot;:&quot;general&quot;,&quot;ageSeconds&quot;:0,&quot;pollingIntervalSec&quot;:30,&quot;cacheStatus&quot;:&quot;HIT&quot;}

            </system-out>
            <system-err>
alertsKv not available, using default config

            </system-err>
        </testcase>
        <testcase classname="test/get-stock.spec.ts" name="getStock handler &gt; fetches the quote and caches the parsed response" time="0.073">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.539Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No cache for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;cacheStatus&quot;:&quot;MISS&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.540Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /quote&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/quote&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;latencyMs&quot;:1}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.540Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /profile&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/profile&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;latencyMs&quot;:0}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.540Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Profile API response&quot;,&quot;type&quot;:&quot;general&quot;,&quot;endpoint&quot;:&quot;https://financialmodelingprep.com/stable/profile?symbol=AAPL&amp;apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM&quot;,&quot;responseType&quot;:&quot;array&quot;,&quot;responseLength&quot;:0}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.540Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Profile API returned empty array&quot;,&quot;type&quot;:&quot;general&quot;,&quot;endpoint&quot;:&quot;https://financialmodelingprep.com/stable/profile?symbol=AAPL&amp;apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.540Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /profile&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/profile&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;latencyMs&quot;:0}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.540Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Profile API response&quot;,&quot;type&quot;:&quot;general&quot;,&quot;endpoint&quot;:&quot;https://financialmodelingprep.com/stable/profile/AAPL?apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM&quot;,&quot;responseType&quot;:&quot;array&quot;,&quot;responseLength&quot;:0}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.540Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Profile API returned empty array&quot;,&quot;type&quot;:&quot;general&quot;,&quot;endpoint&quot;:&quot;https://financialmodelingprep.com/stable/profile/AAPL?apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.541Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /profile&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/profile&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;latencyMs&quot;:1}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.541Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Profile API response&quot;,&quot;type&quot;:&quot;general&quot;,&quot;endpoint&quot;:&quot;https://financialmodelingprep.com/stable/company/profile/AAPL?apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM&quot;,&quot;responseType&quot;:&quot;array&quot;,&quot;responseLength&quot;:0}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.541Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Profile API returned empty array&quot;,&quot;type&quot;:&quot;general&quot;,&quot;endpoint&quot;:&quot;https://financialmodelingprep.com/stable/company/profile/AAPL?apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.541Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /profile&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/profile&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;latencyMs&quot;:0}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.541Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Profile API response&quot;,&quot;type&quot;:&quot;general&quot;,&quot;endpoint&quot;:&quot;https://financialmodelingprep.com/api/v3/profile/AAPL?apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM&quot;,&quot;responseType&quot;:&quot;array&quot;,&quot;responseLength&quot;:0}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.541Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Profile API returned empty array&quot;,&quot;type&quot;:&quot;general&quot;,&quot;endpoint&quot;:&quot;https://financialmodelingprep.com/api/v3/profile/AAPL?apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.541Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Final description resolved&quot;,&quot;type&quot;:&quot;general&quot;,&quot;hasDescription&quot;:false,&quot;descriptionLength&quot;:0,&quot;source&quot;:&quot;none&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/get-stock.spec.ts" name="getStock handler &gt; returns an error when the upstream API fails" time="0.035">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.580Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No cache for TSLA&quot;,&quot;type&quot;:&quot;general&quot;,&quot;cacheStatus&quot;:&quot;MISS&quot;}

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.580Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;ERROR in getStock&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbol&quot;:&quot;TSLA&quot;,&quot;error&quot;:{&quot;name&quot;:&quot;Error&quot;,&quot;message&quot;:&quot;fail&quot;,&quot;stack&quot;:&quot;Error: fail\n    at /home/sngvahmed/workspace/stockly/api/test/get-stock.spec.ts:136:60\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (&lt;anonymous&gt;)\n    at runWithTimeout (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runFiles (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1787:3)&quot;}}

            </system-err>
        </testcase>
        <testcase classname="test/get-stock.spec.ts" name="getStock handler &gt; returns stale data from DB when simulation mode is enabled" time="0.116">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.695Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No cache for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;cacheStatus&quot;:&quot;MISS&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/get-stock.spec.ts" name="getStock handler &gt; returns no_price_available when simulation is enabled but no DB data exists" time="0.038">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.738Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No cache for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;cacheStatus&quot;:&quot;MISS&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/get-stock.spec.ts" name="getStock handler &gt; calls provider normally when simulation is disabled" time="0.03">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.769Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No cache for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;cacheStatus&quot;:&quot;MISS&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.770Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /quote&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/quote&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;latencyMs&quot;:1}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.770Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /profile&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/profile&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;latencyMs&quot;:0}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.770Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Profile API response&quot;,&quot;type&quot;:&quot;general&quot;,&quot;endpoint&quot;:&quot;https://financialmodelingprep.com/stable/profile?symbol=AAPL&amp;apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM&quot;,&quot;responseType&quot;:&quot;array&quot;,&quot;responseLength&quot;:0}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.770Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Profile API returned empty array&quot;,&quot;type&quot;:&quot;general&quot;,&quot;endpoint&quot;:&quot;https://financialmodelingprep.com/stable/profile?symbol=AAPL&amp;apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.770Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /profile&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/profile&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;latencyMs&quot;:0}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.770Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Profile API response&quot;,&quot;type&quot;:&quot;general&quot;,&quot;endpoint&quot;:&quot;https://financialmodelingprep.com/stable/profile/AAPL?apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM&quot;,&quot;responseType&quot;:&quot;array&quot;,&quot;responseLength&quot;:0}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.770Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Profile API returned empty array&quot;,&quot;type&quot;:&quot;general&quot;,&quot;endpoint&quot;:&quot;https://financialmodelingprep.com/stable/profile/AAPL?apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.770Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /profile&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/profile&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;latencyMs&quot;:0}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.770Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Profile API response&quot;,&quot;type&quot;:&quot;general&quot;,&quot;endpoint&quot;:&quot;https://financialmodelingprep.com/stable/company/profile/AAPL?apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM&quot;,&quot;responseType&quot;:&quot;array&quot;,&quot;responseLength&quot;:0}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.770Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Profile API returned empty array&quot;,&quot;type&quot;:&quot;general&quot;,&quot;endpoint&quot;:&quot;https://financialmodelingprep.com/stable/company/profile/AAPL?apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.770Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /profile&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/profile&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;latencyMs&quot;:0}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.770Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Profile API response&quot;,&quot;type&quot;:&quot;general&quot;,&quot;endpoint&quot;:&quot;https://financialmodelingprep.com/api/v3/profile/AAPL?apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM&quot;,&quot;responseType&quot;:&quot;array&quot;,&quot;responseLength&quot;:0}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.770Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Profile API returned empty array&quot;,&quot;type&quot;:&quot;general&quot;,&quot;endpoint&quot;:&quot;https://financialmodelingprep.com/api/v3/profile/AAPL?apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.770Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Final description resolved&quot;,&quot;type&quot;:&quot;general&quot;,&quot;hasDescription&quot;:false,&quot;descriptionLength&quot;:0,&quot;source&quot;:&quot;none&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/get-stock.spec.ts" name="getStock handler &gt; falls back to DB and returns stale data when provider API fails" time="0.081">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.798Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No cache for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;cacheStatus&quot;:&quot;MISS&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.798Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /quote&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/quote&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;statusCode&quot;:500,&quot;latencyMs&quot;:0}

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.798Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Provider API failed for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;statusCode&quot;:500,&quot;apiProvider&quot;:&quot;FMP&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.851Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Failed to send provider failure notifications&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbol&quot;:&quot;AAPL&quot;,&quot;error&quot;:{&quot;name&quot;:&quot;TypeError&quot;,&quot;message&quot;:&quot;env.stockly.prepare(...).all is not a function&quot;,&quot;stack&quot;:&quot;TypeError: env.stockly.prepare(...).all is not a function\n    at notifyUsersOfProviderFailure (/home/sngvahmed/workspace/stockly/api/src/api/get-stock.ts:452:8)&quot;}}

            </system-err>
        </testcase>
        <testcase classname="test/get-stock.spec.ts" name="getStock handler &gt; falls back to DB when provider returns invalid data" time="0.053">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.880Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No cache for TSLA&quot;,&quot;type&quot;:&quot;general&quot;,&quot;cacheStatus&quot;:&quot;MISS&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.881Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /quote&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/quote&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;latencyMs&quot;:0}

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.881Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Provider API returned invalid data for TSLA&quot;,&quot;type&quot;:&quot;general&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.903Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Failed to send provider failure notifications&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbol&quot;:&quot;TSLA&quot;,&quot;error&quot;:{&quot;name&quot;:&quot;TypeError&quot;,&quot;message&quot;:&quot;env.stockly.prepare(...).all is not a function&quot;,&quot;stack&quot;:&quot;TypeError: env.stockly.prepare(...).all is not a function\n    at notifyUsersOfProviderFailure (/home/sngvahmed/workspace/stockly/api/src/api/get-stock.ts:452:8)&quot;}}

            </system-err>
        </testcase>
        <testcase classname="test/get-stock.spec.ts" name="getStock handler &gt; falls back to DB when provider network request fails" time="0.046">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.939Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No cache for MSFT&quot;,&quot;type&quot;:&quot;general&quot;,&quot;cacheStatus&quot;:&quot;MISS&quot;}

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.939Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;ERROR in getStock&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbol&quot;:&quot;MSFT&quot;,&quot;error&quot;:{&quot;name&quot;:&quot;Error&quot;,&quot;message&quot;:&quot;Failed to fetch&quot;,&quot;stack&quot;:&quot;Error: Failed to fetch\n    at /home/sngvahmed/workspace/stockly/api/test/get-stock.spec.ts:477:7\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (&lt;anonymous&gt;)\n    at runWithTimeout (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runFiles (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1787:3)&quot;}}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.939Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Provider fetch error for MSFT&quot;,&quot;type&quot;:&quot;general&quot;,&quot;error&quot;:&quot;Failed to fetch&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.954Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Failed to send provider failure notifications&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbol&quot;:&quot;MSFT&quot;,&quot;error&quot;:{&quot;name&quot;:&quot;TypeError&quot;,&quot;message&quot;:&quot;env.stockly.prepare(...).all is not a function&quot;,&quot;stack&quot;:&quot;TypeError: env.stockly.prepare(...).all is not a function\n    at notifyUsersOfProviderFailure (/home/sngvahmed/workspace/stockly/api/src/api/get-stock.ts:452:8)&quot;}}

            </system-err>
        </testcase>
        <testcase classname="test/get-stock.spec.ts" name="getStock handler &gt; tries alternative profile endpoints if first one fails" time="0.025">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.979Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No cache for NVDA&quot;,&quot;type&quot;:&quot;general&quot;,&quot;cacheStatus&quot;:&quot;MISS&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.979Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /quote&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/quote&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;latencyMs&quot;:0}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.979Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /profile&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/profile&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;statusCode&quot;:404,&quot;latencyMs&quot;:0}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.980Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /profile&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/profile&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;latencyMs&quot;:0}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.980Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Profile API response&quot;,&quot;type&quot;:&quot;general&quot;,&quot;endpoint&quot;:&quot;https://financialmodelingprep.com/stable/profile/NVDA?apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM&quot;,&quot;responseType&quot;:&quot;array&quot;,&quot;responseLength&quot;:1}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.980Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Found description from profile&quot;,&quot;type&quot;:&quot;general&quot;,&quot;descriptionLength&quot;:14}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.980Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Final description resolved&quot;,&quot;type&quot;:&quot;general&quot;,&quot;hasDescription&quot;:true,&quot;descriptionLength&quot;:14,&quot;source&quot;:&quot;profile&quot;}

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.980Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Failed to fetch profile&quot;,&quot;type&quot;:&quot;general&quot;,&quot;endpoint&quot;:&quot;https://financialmodelingprep.com/stable/profile?symbol=NVDA&amp;apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM&quot;,&quot;error&quot;:&quot;profileRes.text is not a function&quot;}

            </system-err>
        </testcase>
        <testcase classname="test/get-stock.spec.ts" name="getStock handler &gt; fetches description from Wikipedia if profile description is missing" time="0.024">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.003Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No cache for TSLA&quot;,&quot;type&quot;:&quot;general&quot;,&quot;cacheStatus&quot;:&quot;MISS&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.003Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /quote&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/quote&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;latencyMs&quot;:0}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.003Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /profile&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/profile&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;latencyMs&quot;:0}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.003Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Profile API response&quot;,&quot;type&quot;:&quot;general&quot;,&quot;endpoint&quot;:&quot;https://financialmodelingprep.com/stable/profile?symbol=TSLA&amp;apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM&quot;,&quot;responseType&quot;:&quot;array&quot;,&quot;responseLength&quot;:1}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.003Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Profile fetched but no description field&quot;,&quot;type&quot;:&quot;general&quot;,&quot;profileKeys&quot;:[&quot;symbol&quot;,&quot;image&quot;]}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.003Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Found description from Wikipedia&quot;,&quot;type&quot;:&quot;general&quot;,&quot;descriptionLength&quot;:30}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.003Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Final description resolved&quot;,&quot;type&quot;:&quot;general&quot;,&quot;hasDescription&quot;:true,&quot;descriptionLength&quot;:30,&quot;source&quot;:&quot;wikipedia&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/get-stock.spec.ts" name="getStock handler &gt; throttles provider failure notifications" time="0.049">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.027Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No cache for THROTTLE_TEST&quot;,&quot;type&quot;:&quot;general&quot;,&quot;cacheStatus&quot;:&quot;MISS&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.027Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /quote&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/quote&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;statusCode&quot;:503,&quot;latencyMs&quot;:0}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.028Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No cache for THROTTLE_TEST&quot;,&quot;type&quot;:&quot;general&quot;,&quot;cacheStatus&quot;:&quot;MISS&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.028Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /quote&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/quote&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;statusCode&quot;:503,&quot;latencyMs&quot;:0}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.044Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Sending provider failure notifications&quot;,&quot;type&quot;:&quot;general&quot;,&quot;userCount&quot;:1,&quot;symbol&quot;:&quot;THROTTLE_TEST&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.045Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;u1&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Provider failure notification sent&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbol&quot;:&quot;THROTTLE_TEST&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.045Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Completed sending provider failure notifications&quot;,&quot;type&quot;:&quot;general&quot;,&quot;userCount&quot;:1,&quot;symbol&quot;:&quot;THROTTLE_TEST&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.054Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Provider failure notification for THROTTLE_TEST throttled&quot;,&quot;type&quot;:&quot;general&quot;,&quot;throttleKey&quot;:&quot;provider_failure:THROTTLE_TEST:notification_sent&quot;}

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.027Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Provider API failed for THROTTLE_TEST&quot;,&quot;type&quot;:&quot;general&quot;,&quot;statusCode&quot;:503,&quot;apiProvider&quot;:&quot;FMP&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.028Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Provider API failed for THROTTLE_TEST&quot;,&quot;type&quot;:&quot;general&quot;,&quot;statusCode&quot;:503,&quot;apiProvider&quot;:&quot;FMP&quot;}

            </system-err>
        </testcase>
    </testsuite>
    <testsuite name="test/get-stocks.spec.ts" timestamp="2025-12-20T12:24:18.205Z" hostname="sngvahmed" tests="10" failures="0" errors="0" skipped="0" time="0.499">
        <testcase classname="test/get-stocks.spec.ts" name="getStocks handler &gt; requires symbols param" time="0.038">
        </testcase>
        <testcase classname="test/get-stocks.spec.ts" name="getStocks handler &gt; serves fresh entries from cache" time="0.046">
            <system-err>
alertsKv not available, using default config

            </system-err>
        </testcase>
        <testcase classname="test/get-stocks.spec.ts" name="getStocks handler &gt; refreshes from API when cache misses to get full data" time="0.058">
        </testcase>
        <testcase classname="test/get-stocks.spec.ts" name="getStocks handler &gt; fetches from API when cache and DB entries are stale" time="0.041">
        </testcase>
        <testcase classname="test/get-stocks.spec.ts" name="getStocks handler &gt; returns empty array when all API calls fail" time="0.051">
            <system-err>
Failed to fetch quote for MSFT: Error: boom
    at /home/sngvahmed/workspace/stockly/api/test/get-stocks.spec.ts:191:60
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20
    at new Promise (&lt;anonymous&gt;)
    at runWithTimeout (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)
    at runTest (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)
    at runFiles (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1787:3)

            </system-err>
        </testcase>
        <testcase classname="test/get-stocks.spec.ts" name="getStocks handler &gt; returns full data structure with all required fields for single stock" time="0.039">
        </testcase>
        <testcase classname="test/get-stocks.spec.ts" name="getStocks handler &gt; returns full data structure for multiple stocks" time="0.043">
        </testcase>
        <testcase classname="test/get-stocks.spec.ts" name="getStocks handler &gt; sets name from companyName if name is missing" time="0.031">
        </testcase>
        <testcase classname="test/get-stocks.spec.ts" name="getStocks handler &gt; always includes image even if profile fetch fails" time="0.038">
        </testcase>
        <testcase classname="test/get-stocks.spec.ts" name="getStocks handler &gt; handles partial failures gracefully with Promise.allSettled" time="0.037">
            <system-err>
Failed to fetch quote for INVALID: Error: Failed to fetch INVALID
    at fetchQuoteFromApi (/home/sngvahmed/workspace/stockly/api/src/api/get-stocks.ts:178:11)
    at async Promise.allSettled (index 1)
    at fetchQuotesBatchFromApi (/home/sngvahmed/workspace/stockly/api/src/api/get-stocks.ts:216:24)
    at getStocks (/home/sngvahmed/workspace/stockly/api/src/api/get-stocks.ts:304:25)
    at /home/sngvahmed/workspace/stockly/api/test/get-stocks.spec.ts:473:22
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20

            </system-err>
        </testcase>
    </testsuite>
    <testsuite name="test/index.spec.ts" timestamp="2025-12-20T12:24:18.206Z" hostname="sngvahmed" tests="52" failures="0" errors="0" skipped="1" time="0.394">
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /get-stock" time="0.026">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /get-stocks" time="0.022">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /get-stock-details" time="0.023">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /get-news" time="0.017">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /news/general" time="0.025">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /news/favorites" time="0.018">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /get-stock-news" time="0.019">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /search-stock" time="0.018">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /get-historical" time="0.016">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /get-historical-intraday" time="0.013">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /health" time="0.016">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /openapi.json" time="0.012">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /alerts prefix" time="0.01">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /push-token GET" time="0.007">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /push-token POST" time="0.005">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /preferences GET" time="0.008">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /preferences PUT" time="0.004">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /settings GET" time="0.005">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /settings PUT" time="0.004">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /users/preferences/update" time="0.004">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /news/archive GET" time="0.004">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /news/archive/:id POST" time="0.005">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /favorite-stocks GET" time="0.005">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /favorite-stocks POST" time="0.004">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /favorite-stocks ALL (moved to /v1/api/users/all)" time="0">
            <skipped/>
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /users/all" time="0.006">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /favorite-stocks/:symbol DELETE" time="0.004">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /notifications/recent" time="0.004">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /notifications/failed" time="0.004">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /notifications/retry/:id" time="0.003">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /devices GET" time="0.002">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /devices DELETE" time="0.003">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /devices/test POST" time="0.003">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /config/get" time="0.002">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /config/update" time="0.002">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /simulate-provider-failure" time="0.002">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /disable-provider-failure" time="0.003">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /auth/google" time="0.002">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /auth/username/check" time="0.003">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /auth/username" time="0.002">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /auth/refresh" time="0.003">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /auth/me" time="0.003">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; delegates /auth/logout" time="0.002">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; returns 404 for unknown routes" time="0.004">
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.297Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;2e2daec4-3029-4444-8ba9-676d6cfcc555&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/unknown&quot;,&quot;message&quot;:&quot;Route not found&quot;,&quot;type&quot;:&quot;general&quot;,&quot;pathname&quot;:&quot;/unknown&quot;,&quot;method&quot;:&quot;GET&quot;}

            </system-err>
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; handles CORS OPTIONS request" time="0.002">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; Scheduled events &gt; runs alerts cron on correct schedule" time="0.002">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; Scheduled events &gt; runs news alerts cron on correct schedule" time="0.002">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; Scheduled events &gt; handles unhandled errors" time="0.008">
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.308Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;784d15da-15e2-426b-bd64-7ae32eb07ede&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/v1/api/health&quot;,&quot;message&quot;:&quot;Unhandled error in fetch handler&quot;,&quot;type&quot;:&quot;general&quot;,&quot;pathname&quot;:&quot;/v1/api/health&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;error&quot;:{&quot;name&quot;:&quot;Error&quot;,&quot;message&quot;:&quot;Test error&quot;,&quot;stack&quot;:&quot;Error: Test error\n    at /home/sngvahmed/workspace/stockly/api/test/index.spec.ts:257:15\n    at mockCall (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/spy/dist/index.js:96:15)\n    at spy (home/sngvahmed/workspace/stockly/api/node_modules/tinyspy/dist/index.js:47:80)\n    at Object.fetch (/home/sngvahmed/workspace/stockly/api/src/index.ts:131:20)\n    at /home/sngvahmed/workspace/stockly/api/test/index.spec.ts:260:37\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (&lt;anonymous&gt;)\n    at runWithTimeout (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)&quot;}}

            </system-err>
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; Scheduled events &gt; ships logs if LOKI_URL is present" time="0.002">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; Scheduled events &gt; handles CORS requests with specific headers" time="0.003">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; Scheduled events &gt; ships logs on OPTIONS request if LOKI_URL is present" time="0.003">
        </testcase>
        <testcase classname="test/index.spec.ts" name="worker router &gt; Scheduled events &gt; returns 405 for invalid method on retry notification" time="0.003">
        </testcase>
    </testsuite>
    <testsuite name="test/search-stock.spec.ts" timestamp="2025-12-20T12:24:18.213Z" hostname="sngvahmed" tests="6" failures="0" errors="0" skipped="0" time="0.382">
        <testcase classname="test/search-stock.spec.ts" name="searchStock handler &gt; returns empty results when query is invalid" time="0.04">
        </testcase>
        <testcase classname="test/search-stock.spec.ts" name="searchStock handler &gt; serves cached responses from memory" time="0.041">
        </testcase>
        <testcase classname="test/search-stock.spec.ts" name="searchStock handler &gt; returns cached entries from D1 when still valid" time="0.073">
        </testcase>
        <testcase classname="test/search-stock.spec.ts" name="searchStock handler &gt; invokes the upstream API, normalizes payload, and stores cache" time="0.039">
        </testcase>
        <testcase classname="test/search-stock.spec.ts" name="searchStock handler &gt; ignores expired D1 cache entries and fetches fresh data" time="0.058">
        </testcase>
        <testcase classname="test/search-stock.spec.ts" name="searchStock handler &gt; returns empty array when upstream request fails gracefully" time="0.037">
        </testcase>
    </testsuite>
    <testsuite name="test/util.spec.ts" timestamp="2025-12-20T12:24:18.213Z" hostname="sngvahmed" tests="7" failures="0" errors="0" skipped="0" time="0.561">
        <testcase classname="test/util.spec.ts" name="json utility &gt; serializes payload into a JSON Response" time="0.044">
        </testcase>
        <testcase classname="test/util.spec.ts" name="json utility &gt; allows overriding the status code" time="0.038">
        </testcase>
        <testcase classname="test/util.spec.ts" name="CORS headers &gt; returns wildcard for unknown origin" time="0.035">
        </testcase>
        <testcase classname="test/util.spec.ts" name="CORS headers &gt; returns specific origin for allowed domain" time="0.08">
        </testcase>
        <testcase classname="test/util.spec.ts" name="CORS headers &gt; allows localhost" time="0.038">
        </testcase>
        <testcase classname="test/util.spec.ts" name="CORS headers &gt; allows localhost with random port" time="0.093">
        </testcase>
        <testcase classname="test/util.spec.ts" name="CORS headers &gt; falls back to * if origin not allowed" time="0.042">
        </testcase>
    </testsuite>
    <testsuite name="test/alerts/state-cache.spec.ts" timestamp="2025-12-20T12:24:18.214Z" hostname="sngvahmed" tests="19" failures="0" errors="0" skipped="0" time="1.572">
        <testcase classname="test/alerts/state-cache.spec.ts" name="Alert State Cache &gt; getCachedState &gt; should return null when state not cached" time="0.035">
        </testcase>
        <testcase classname="test/alerts/state-cache.spec.ts" name="Alert State Cache &gt; getCachedState &gt; should return cached state" time="0.085">
            <system-out>
[KV Cache] Queued state update for alert alert-1 (1 pending writes)

            </system-out>
        </testcase>
        <testcase classname="test/alerts/state-cache.spec.ts" name="Alert State Cache &gt; updateStateInCache &gt; should update state in cache" time="0.035">
            <system-out>
[KV Cache] Queued state update for alert alert-1 (1 pending writes)

            </system-out>
        </testcase>
        <testcase classname="test/alerts/state-cache.spec.ts" name="Alert State Cache &gt; updateStateInCache &gt; should queue state for KV write" time="0.034">
            <system-out>
[KV Cache] Queued state update for alert alert-1 (1 pending writes)

            </system-out>
        </testcase>
        <testcase classname="test/alerts/state-cache.spec.ts" name="Alert State Cache &gt; loadAllStatesFromKV &gt; should load states from KV" time="0.045">
            <system-out>
[KV Cache] Loading 2 alert states from KV...

[KV Cache] Loaded 2 states from KV

            </system-out>
        </testcase>
        <testcase classname="test/alerts/state-cache.spec.ts" name="Alert State Cache &gt; loadAllStatesFromKV &gt; should cache loaded states in memory" time="0.105">
            <system-out>
[KV Cache] Loading 1 alert states from KV...

[KV Cache] Loaded 1 states from KV

            </system-out>
        </testcase>
        <testcase classname="test/alerts/state-cache.spec.ts" name="Alert State Cache &gt; loadAllStatesFromKV &gt; should return cached data if cache is fresh" time="0.086">
            <system-out>
[KV Cache] Loading 1 alert states from KV...

[KV Cache] Loaded 1 states from KV

            </system-out>
        </testcase>
        <testcase classname="test/alerts/state-cache.spec.ts" name="Alert State Cache &gt; loadAllStatesFromKV &gt; should handle missing states" time="0.078">
            <system-out>
[KV Cache] Loading 2 alert states from KV...

[KV Cache] Loaded 1 states from KV

            </system-out>
        </testcase>
        <testcase classname="test/alerts/state-cache.spec.ts" name="Alert State Cache &gt; loadAllStatesFromKV &gt; should handle invalid JSON" time="0.044">
            <system-out>
[KV Cache] Loading 1 alert states from KV...

[KV Cache] Loaded 0 states from KV

            </system-out>
            <system-err>
[KV Cache] Failed to load state for alert alert-1: SyntaxError: Unexpected token &apos;i&apos;, &quot;invalid json&quot; is not valid JSON
    at JSON.parse (&lt;anonymous&gt;)
    at /home/sngvahmed/workspace/stockly/api/src/alerts/state-cache.ts:54:29
    at async Promise.all (index 0)
    at loadAllStatesFromKV (/home/sngvahmed/workspace/stockly/api/src/alerts/state-cache.ts:64:19)
    at /home/sngvahmed/workspace/stockly/api/test/alerts/state-cache.spec.ts:158:22
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20

            </system-err>
        </testcase>
        <testcase classname="test/alerts/state-cache.spec.ts" name="Alert State Cache &gt; loadAllStatesFromKV &gt; should handle KV read errors" time="0.085">
            <system-out>
[KV Cache] Loading 1 alert states from KV...

[KV Cache] Loaded 0 states from KV

            </system-out>
            <system-err>
[KV Cache] Failed to load state for alert alert-1: Error: KV error
    at /home/sngvahmed/workspace/stockly/api/test/alerts/state-cache.spec.ts:166:47
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20
    at new Promise (&lt;anonymous&gt;)
    at runWithTimeout (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)
    at runTest (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)

            </system-err>
        </testcase>
        <testcase classname="test/alerts/state-cache.spec.ts" name="Alert State Cache &gt; flushPendingWritesToKV &gt; should write pending states to KV" time="0.028">
            <system-out>
[KV Cache] Queued state update for alert alert-1 (1 pending writes)
[KV Cache] Flushing 1 pending writes to KV...

[KV Cache] Flushed 1/1 writes to KV

            </system-out>
        </testcase>
        <testcase classname="test/alerts/state-cache.spec.ts" name="Alert State Cache &gt; flushPendingWritesToKV &gt; should batch multiple writes" time="0.029">
            <system-out>
[KV Cache] Queued state update for alert alert-1 (1 pending writes)
[KV Cache] Queued state update for alert alert-2 (2 pending writes)
[KV Cache] Flushing 2 pending writes to KV...

[KV Cache] Flushed 2/2 writes to KV

            </system-out>
        </testcase>
        <testcase classname="test/alerts/state-cache.spec.ts" name="Alert State Cache &gt; flushPendingWritesToKV &gt; should not write if interval has not passed" time="0.055">
            <system-out>
[KV Cache] Queued state update for alert alert-1 (1 pending writes)
[KV Cache] Flushing 1 pending writes to KV...

[KV Cache] Flushed 1/1 writes to KV

[KV Cache] Queued state update for alert alert-2 (1 pending writes)
[KV Cache] Skipping KV write - only 0s since last write (interval: 3600s)

            </system-out>
        </testcase>
        <testcase classname="test/alerts/state-cache.spec.ts" name="Alert State Cache &gt; flushPendingWritesToKV &gt; should write if interval has passed" time="0.043">
            <system-out>
[KV Cache] Queued state update for alert alert-1 (1 pending writes)
[KV Cache] Flushing 1 pending writes to KV...

[KV Cache] Flushed 1/1 writes to KV

[KV Cache] Queued state update for alert alert-2 (1 pending writes)
[KV Cache] Flushing 1 pending writes to KV...

[KV Cache] Flushed 1/1 writes to KV

            </system-out>
        </testcase>
        <testcase classname="test/alerts/state-cache.spec.ts" name="Alert State Cache &gt; flushPendingWritesToKV &gt; should handle KV write errors gracefully" time="0.04">
            <system-out>
[KV Cache] Queued state update for alert alert-1 (1 pending writes)
[KV Cache] Flushing 1 pending writes to KV...

[KV Cache] Flushed 0/1 writes to KV

            </system-out>
            <system-err>
[KV Cache] Failed to write state for alert alert-1: Error: KV write failed
    at /home/sngvahmed/workspace/stockly/api/test/alerts/state-cache.spec.ts:264:47
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20
    at new Promise (&lt;anonymous&gt;)
    at runWithTimeout (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)
    at runTest (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)

            </system-err>
        </testcase>
        <testcase classname="test/alerts/state-cache.spec.ts" name="Alert State Cache &gt; flushPendingWritesToKV &gt; should return early if no pending writes" time="0.097">
        </testcase>
        <testcase classname="test/alerts/state-cache.spec.ts" name="Alert State Cache &gt; invalidateState &gt; should remove state from cache and pending writes" time="0.037">
            <system-out>
[KV Cache] Queued state update for alert alert-1 (1 pending writes)

            </system-out>
        </testcase>
        <testcase classname="test/alerts/state-cache.spec.ts" name="Alert State Cache &gt; clearCache &gt; should clear all cached states" time="0.039">
            <system-out>
[KV Cache] Queued state update for alert alert-1 (1 pending writes)
[KV Cache] Queued state update for alert alert-2 (2 pending writes)

            </system-out>
        </testcase>
        <testcase classname="test/alerts/state-cache.spec.ts" name="Alert State Cache &gt; getCacheStats &gt; should return cache statistics" time="0.034">
            <system-out>
[KV Cache] Queued state update for alert alert-1 (1 pending writes)
[KV Cache] Queued state update for alert alert-2 (2 pending writes)

            </system-out>
        </testcase>
    </testsuite>
    <testsuite name="test/api/admin.spec.ts" timestamp="2025-12-20T12:24:18.218Z" hostname="sngvahmed" tests="18" failures="0" errors="0" skipped="0" time="0.83">
        <testcase classname="test/api/admin.spec.ts" name="Admin API &gt; getRecentNotifications &gt; should return recent notifications" time="0.055">
        </testcase>
        <testcase classname="test/api/admin.spec.ts" name="Admin API &gt; getRecentNotifications &gt; should return empty array when no notifications" time="0.062">
        </testcase>
        <testcase classname="test/api/admin.spec.ts" name="Admin API &gt; getRecentNotifications &gt; should handle database errors" time="0.05">
            <system-err>
Failed to retrieve recent notifications: Error: Database error
    at /home/sngvahmed/workspace/stockly/api/test/api/admin.spec.ts:131:40
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20
    at new Promise (&lt;anonymous&gt;)
    at runWithTimeout (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)
    at runTest (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)

            </system-err>
        </testcase>
        <testcase classname="test/api/admin.spec.ts" name="Admin API &gt; getRecentNotifications &gt; should limit to 100 notifications" time="0.061">
        </testcase>
        <testcase classname="test/api/admin.spec.ts" name="Admin API &gt; getRecentNotifications &gt; should order by sent_at DESC" time="0.041">
        </testcase>
        <testcase classname="test/api/admin.spec.ts" name="Admin API &gt; getFailedNotifications &gt; should return only failed notifications" time="0.034">
        </testcase>
        <testcase classname="test/api/admin.spec.ts" name="Admin API &gt; getFailedNotifications &gt; should return empty array when no failed notifications" time="0.035">
        </testcase>
        <testcase classname="test/api/admin.spec.ts" name="Admin API &gt; getFailedNotifications &gt; should handle database errors" time="0.033">
            <system-err>
Failed to retrieve failed notifications: Error: Database error
    at /home/sngvahmed/workspace/stockly/api/test/api/admin.spec.ts:237:40
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20
    at new Promise (&lt;anonymous&gt;)
    at runWithTimeout (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)
    at runTest (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)

            </system-err>
        </testcase>
        <testcase classname="test/api/admin.spec.ts" name="Admin API &gt; getFilteredNotifications &gt; should return filtered notifications" time="0.044">
        </testcase>
        <testcase classname="test/api/admin.spec.ts" name="Admin API &gt; getFilteredNotifications &gt; should filter by date range" time="0.027">
        </testcase>
        <testcase classname="test/api/admin.spec.ts" name="Admin API &gt; getFilteredNotifications &gt; should fail if env not provided" time="0.024">
        </testcase>
        <testcase classname="test/api/admin.spec.ts" name="Admin API &gt; getFilteredNotifications &gt; should handle db errors" time="0.028">
            <system-err>
Failed to retrieve filtered notifications: Error: DB Error
    at Object.&lt;anonymous&gt; (/home/sngvahmed/workspace/stockly/api/test/api/admin.spec.ts:323:15)
    at Object.mockCall (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/spy/dist/index.js:96:15)
    at Object.spy [as prepare] (home/sngvahmed/workspace/stockly/api/node_modules/tinyspy/dist/index.js:47:80)
    at Module.getFilteredNotifications (/home/sngvahmed/workspace/stockly/api/src/api/admin.ts:242:30)
    at /home/sngvahmed/workspace/stockly/api/test/api/admin.spec.ts:327:24
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20

            </system-err>
        </testcase>
        <testcase classname="test/api/admin.spec.ts" name="Admin API &gt; retryNotification &gt; should retry failed notification successfully" time="0.026">
        </testcase>
        <testcase classname="test/api/admin.spec.ts" name="Admin API &gt; retryNotification &gt; should return 404 when log not found" time="0.025">
        </testcase>
        <testcase classname="test/api/admin.spec.ts" name="Admin API &gt; retryNotification &gt; should handle retry failure" time="0.024">
        </testcase>
        <testcase classname="test/api/admin.spec.ts" name="Admin API &gt; retryNotification &gt; should create new log entry with attempt count 1" time="0.022">
        </testcase>
        <testcase classname="test/api/admin.spec.ts" name="Admin API &gt; retryNotification &gt; should handle database errors during retry" time="0.021">
            <system-err>
Failed to retry notification: Error: Database error
    at /home/sngvahmed/workspace/stockly/api/test/api/admin.spec.ts:557:40
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20
    at new Promise (&lt;anonymous&gt;)
    at runWithTimeout (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)
    at runTest (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)

            </system-err>
        </testcase>
        <testcase classname="test/api/admin.spec.ts" name="Admin API &gt; retryNotification &gt; should handle FCM send errors" time="0.019">
        </testcase>
    </testsuite>
    <testsuite name="test/api/auth.spec.ts" timestamp="2025-12-20T12:24:18.221Z" hostname="sngvahmed" tests="26" failures="0" errors="0" skipped="0" time="0.496">
        <testcase classname="test/api/auth.spec.ts" name="Auth API &gt; handleGoogleAuth &gt; should return 405 for non-POST requests" time="0.03">
        </testcase>
        <testcase classname="test/api/auth.spec.ts" name="Auth API &gt; handleGoogleAuth &gt; should return error if idToken is missing" time="0.027">
        </testcase>
        <testcase classname="test/api/auth.spec.ts" name="Auth API &gt; handleGoogleAuth &gt; should authenticate existing user" time="0.028">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.850Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;google-user-123&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;User authenticated successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;email&quot;:&quot;test@example.com&quot;,&quot;requiresUsername&quot;:false}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.851Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;google-user-123&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Auth event: sign_in&quot;,&quot;type&quot;:&quot;sign_in&quot;,&quot;email&quot;:&quot;test@example.com&quot;,&quot;success&quot;:true}

            </system-out>
        </testcase>
        <testcase classname="test/api/auth.spec.ts" name="Auth API &gt; handleGoogleAuth &gt; should create new user if not found" time="0.034">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.886Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;google-user-123&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;New user created and authenticated&quot;,&quot;type&quot;:&quot;general&quot;,&quot;email&quot;:&quot;test@example.com&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.886Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;google-user-123&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Auth event: sign_in&quot;,&quot;type&quot;:&quot;sign_in&quot;,&quot;email&quot;:&quot;test@example.com&quot;,&quot;success&quot;:true}

            </system-out>
        </testcase>
        <testcase classname="test/api/auth.spec.ts" name="Auth API &gt; handleGoogleAuth &gt; should return 401 if Google token verification fails" time="0.029">
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.913Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Google token verification failed&quot;,&quot;type&quot;:&quot;general&quot;,&quot;idToken&quot;:&quot;bad.token.struct...&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.913Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Auth event failed: sign_in&quot;,&quot;type&quot;:&quot;sign_in&quot;,&quot;success&quot;:false,&quot;error&quot;:&quot;Google token verification failed&quot;}

            </system-err>
        </testcase>
        <testcase classname="test/api/auth.spec.ts" name="Auth API &gt; handleGoogleAuth &gt; should return 500 on DB error during user lookup" time="0.027">
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.942Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Google authentication failed&quot;,&quot;type&quot;:&quot;general&quot;,&quot;error&quot;:{&quot;name&quot;:&quot;Error&quot;,&quot;message&quot;:&quot;DB Error&quot;,&quot;stack&quot;:&quot;Error: DB Error\n    at /home/sngvahmed/workspace/stockly/api/test/api/auth.spec.ts:179:38\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (&lt;anonymous&gt;)\n    at runWithTimeout (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)&quot;}}

            </system-err>
        </testcase>
        <testcase classname="test/api/auth.spec.ts" name="Auth API &gt; checkUsernameAvailability &gt; should return available true if username not taken" time="0.021">
        </testcase>
        <testcase classname="test/api/auth.spec.ts" name="Auth API &gt; checkUsernameAvailability &gt; should return available false if username taken" time="0.022">
        </testcase>
        <testcase classname="test/api/auth.spec.ts" name="Auth API &gt; checkUsernameAvailability &gt; should return error for invalid format" time="0.018">
        </testcase>
        <testcase classname="test/api/auth.spec.ts" name="Auth API &gt; checkUsernameAvailability &gt; should return 500 on DB error" time="0.02">
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.051Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Username availability check failed&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;newuser&quot;,&quot;error&quot;:{&quot;name&quot;:&quot;Error&quot;,&quot;message&quot;:&quot;DB Error&quot;,&quot;stack&quot;:&quot;Error: DB Error\n    at /home/sngvahmed/workspace/stockly/api/test/api/auth.spec.ts:214:38\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (&lt;anonymous&gt;)\n    at runWithTimeout (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)&quot;}}

            </system-err>
        </testcase>
        <testcase classname="test/api/auth.spec.ts" name="Auth API &gt; setUsername &gt; should set username using idToken flow (new user)" time="0.027">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.098Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;google-user-123&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Username set successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;finaluser&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.099Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;google-user-123&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Auth event: username_set&quot;,&quot;type&quot;:&quot;username_set&quot;,&quot;success&quot;:true}

            </system-out>
        </testcase>
        <testcase classname="test/api/auth.spec.ts" name="Auth API &gt; setUsername &gt; should handle UNIQUE constraint violation" time="0.017">
        </testcase>
        <testcase classname="test/api/auth.spec.ts" name="Auth API &gt; setUsername &gt; should handle race condition (changes=0)" time="0.014">
        </testcase>
        <testcase classname="test/api/auth.spec.ts" name="Auth API &gt; setUsername &gt; should return 500 if updated user cannot be fetched" time="0.015">
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.148Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;User not found after username update&quot;,&quot;type&quot;:&quot;general&quot;,&quot;error&quot;:&quot;[object Object]&quot;}

            </system-err>
        </testcase>
        <testcase classname="test/api/auth.spec.ts" name="Auth API &gt; setUsername &gt; should return 400 if user already has username" time="0.014">
        </testcase>
        <testcase classname="test/api/auth.spec.ts" name="Auth API &gt; refreshToken &gt; should return 405 for non-POST requests" time="0.007">
        </testcase>
        <testcase classname="test/api/auth.spec.ts" name="Auth API &gt; refreshToken &gt; should extract token from cookie" time="0.008">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.194Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Token refreshed successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.194Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Auth event: token_refresh&quot;,&quot;type&quot;:&quot;token_refresh&quot;,&quot;success&quot;:true}

            </system-out>
        </testcase>
        <testcase classname="test/api/auth.spec.ts" name="Auth API &gt; refreshToken &gt; should extract token from body (mobile)" time="0.006">
        </testcase>
        <testcase classname="test/api/auth.spec.ts" name="Auth API &gt; refreshToken &gt; should return 400 if token missing" time="0.004">
        </testcase>
        <testcase classname="test/api/auth.spec.ts" name="Auth API &gt; refreshToken &gt; should return 401 if token invalid" time="0.003">
        </testcase>
        <testcase classname="test/api/auth.spec.ts" name="Auth API &gt; getCurrentUser &gt; should return 405 for non-GET requests" time="0.003">
        </testcase>
        <testcase classname="test/api/auth.spec.ts" name="Auth API &gt; getCurrentUser &gt; should return 401 if not authenticated" time="0.006">
        </testcase>
        <testcase classname="test/api/auth.spec.ts" name="Auth API &gt; getCurrentUser &gt; should return user info if authenticated" time="0.004">
        </testcase>
        <testcase classname="test/api/auth.spec.ts" name="Auth API &gt; getCurrentUser &gt; should return 404 if user not found in DB" time="0.004">
        </testcase>
        <testcase classname="test/api/auth.spec.ts" name="Auth API &gt; logout &gt; should return 405 for non-POST requests" time="0.004">
        </testcase>
        <testcase classname="test/api/auth.spec.ts" name="Auth API &gt; logout &gt; should clear cookies and log event" time="0.006">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.243Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;User logged out&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.244Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Auth event: sign_out&quot;,&quot;type&quot;:&quot;sign_out&quot;,&quot;success&quot;:true}

            </system-out>
        </testcase>
    </testsuite>
    <testsuite name="test/api/devices.spec.ts" timestamp="2025-12-20T12:24:18.224Z" hostname="sngvahmed" tests="25" failures="0" errors="0" skipped="0" time="0.503">
        <testcase classname="test/api/devices.spec.ts" name="Devices API &gt; getAllDevices &gt; should return devices for regular user" time="0.034">
        </testcase>
        <testcase classname="test/api/devices.spec.ts" name="Devices API &gt; getAllDevices &gt; should return all devices for admin user" time="0.027">
        </testcase>
        <testcase classname="test/api/devices.spec.ts" name="Devices API &gt; getAllDevices &gt; should handle missing device_type column gracefully" time="0.027">
        </testcase>
        <testcase classname="test/api/devices.spec.ts" name="Devices API &gt; getAllDevices &gt; should handle missing username column gracefully" time="0.034">
        </testcase>
        <testcase classname="test/api/devices.spec.ts" name="Devices API &gt; getAllDevices &gt; should return empty array when no devices found" time="0.026">
        </testcase>
        <testcase classname="test/api/devices.spec.ts" name="Devices API &gt; getAllDevices &gt; should return 401 when authentication fails" time="0.028">
        </testcase>
        <testcase classname="test/api/devices.spec.ts" name="Devices API &gt; getAllDevices &gt; should handle database errors gracefully" time="0.025">
        </testcase>
        <testcase classname="test/api/devices.spec.ts" name="Devices API &gt; getAllDevices &gt; should log warning when devices have null username" time="0.026">
        </testcase>
        <testcase classname="test/api/devices.spec.ts" name="Devices API &gt; deleteDevice &gt; should delete device for regular user" time="0.024">
        </testcase>
        <testcase classname="test/api/devices.spec.ts" name="Devices API &gt; deleteDevice &gt; should allow admin to delete any device" time="0.018">
        </testcase>
        <testcase classname="test/api/devices.spec.ts" name="Devices API &gt; deleteDevice &gt; should return 403 when user tries to delete another user&apos;s device" time="0.024">
        </testcase>
        <testcase classname="test/api/devices.spec.ts" name="Devices API &gt; deleteDevice &gt; should return 400 when pushToken is missing" time="0.02">
        </testcase>
        <testcase classname="test/api/devices.spec.ts" name="Devices API &gt; deleteDevice &gt; should return 404 when device not found" time="0.019">
        </testcase>
        <testcase classname="test/api/devices.spec.ts" name="Devices API &gt; deleteDevice &gt; should return 401 when authentication fails" time="0.017">
        </testcase>
        <testcase classname="test/api/devices.spec.ts" name="Devices API &gt; deleteDevice &gt; should handle database errors gracefully" time="0.014">
        </testcase>
        <testcase classname="test/api/devices.spec.ts" name="Devices API &gt; sendTestNotification &gt; should send test notification successfully" time="0.018">
        </testcase>
        <testcase classname="test/api/devices.spec.ts" name="Devices API &gt; sendTestNotification &gt; should use default message when not provided" time="0.01">
        </testcase>
        <testcase classname="test/api/devices.spec.ts" name="Devices API &gt; sendTestNotification &gt; should return 405 for non-POST requests" time="0.006">
        </testcase>
        <testcase classname="test/api/devices.spec.ts" name="Devices API &gt; sendTestNotification &gt; should return 400 when pushToken is missing" time="0.004">
        </testcase>
        <testcase classname="test/api/devices.spec.ts" name="Devices API &gt; sendTestNotification &gt; should return 404 when user not found" time="0.007">
        </testcase>
        <testcase classname="test/api/devices.spec.ts" name="Devices API &gt; sendTestNotification &gt; should return 404 when device not found" time="0.004">
        </testcase>
        <testcase classname="test/api/devices.spec.ts" name="Devices API &gt; sendTestNotification &gt; should return 500 when FCM notification fails" time="0.005">
        </testcase>
        <testcase classname="test/api/devices.spec.ts" name="Devices API &gt; sendTestNotification &gt; should return 401 when authentication fails" time="0.003">
        </testcase>
        <testcase classname="test/api/devices.spec.ts" name="Devices API &gt; sendTestNotification &gt; should handle invalid JSON body gracefully" time="0.003">
        </testcase>
        <testcase classname="test/api/devices.spec.ts" name="Devices API &gt; sendTestNotification &gt; should handle database errors gracefully" time="0.005">
        </testcase>
    </testsuite>
    <testsuite name="test/api/edge-cases.spec.ts" timestamp="2025-12-20T12:24:18.227Z" hostname="sngvahmed" tests="19" failures="0" errors="0" skipped="0" time="1.07">
        <testcase classname="test/api/edge-cases.spec.ts" name="Edge Cases and Error Scenarios &gt; Invalid Input Handling &gt; should handle empty symbol in getStock" time="0.041">
        </testcase>
        <testcase classname="test/api/edge-cases.spec.ts" name="Edge Cases and Error Scenarios &gt; Invalid Input Handling &gt; should handle invalid symbol format" time="0.929">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.758Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No cache for !!!&quot;,&quot;type&quot;:&quot;general&quot;,&quot;cacheStatus&quot;:&quot;MISS&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.136Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /quote&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/quote&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;statusCode&quot;:200,&quot;latencyMs&quot;:377}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.234Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /profile&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/profile&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;statusCode&quot;:200,&quot;latencyMs&quot;:98}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.234Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Profile API response&quot;,&quot;type&quot;:&quot;general&quot;,&quot;endpoint&quot;:&quot;https://financialmodelingprep.com/stable/profile?symbol=!!!&amp;apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM&quot;,&quot;responseType&quot;:&quot;array&quot;,&quot;responseLength&quot;:0}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.234Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Profile API returned empty array&quot;,&quot;type&quot;:&quot;general&quot;,&quot;endpoint&quot;:&quot;https://financialmodelingprep.com/stable/profile?symbol=!!!&amp;apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.332Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /profile&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/profile&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;statusCode&quot;:404,&quot;latencyMs&quot;:98}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.429Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /profile&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/profile&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;statusCode&quot;:404,&quot;latencyMs&quot;:96}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.523Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /profile&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/profile&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;statusCode&quot;:403,&quot;latencyMs&quot;:93}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.673Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Final description resolved&quot;,&quot;type&quot;:&quot;general&quot;,&quot;hasDescription&quot;:false,&quot;descriptionLength&quot;:0,&quot;source&quot;:&quot;none&quot;}

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.333Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Profile API returned non-ok status&quot;,&quot;type&quot;:&quot;general&quot;,&quot;endpoint&quot;:&quot;https://financialmodelingprep.com/stable/profile/!!!?apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM&quot;,&quot;statusCode&quot;:404,&quot;errorText&quot;:&quot;[]&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.429Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Profile API returned non-ok status&quot;,&quot;type&quot;:&quot;general&quot;,&quot;endpoint&quot;:&quot;https://financialmodelingprep.com/stable/company/profile/!!!?apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM&quot;,&quot;statusCode&quot;:404,&quot;errorText&quot;:&quot;[]&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.524Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Profile API returned non-ok status&quot;,&quot;type&quot;:&quot;general&quot;,&quot;endpoint&quot;:&quot;https://financialmodelingprep.com/api/v3/profile/!!!?apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM&quot;,&quot;statusCode&quot;:403,&quot;errorText&quot;:&quot;{\n  \&quot;Error Message\&quot;: \&quot;Legacy Endpoint : Due to Legacy endpoints being no longer supported - This endpoint is only available for legacy users who have valid subscriptions prior August 31, 2025. Please &quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.674Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;ERROR in getStock&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbol&quot;:&quot;!!!&quot;,&quot;error&quot;:{&quot;name&quot;:&quot;TypeError&quot;,&quot;message&quot;:&quot;Cannot read properties of undefined (reading &apos;bind&apos;)&quot;,&quot;stack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &apos;bind&apos;)\n    at Module.getStock (/home/sngvahmed/workspace/stockly/api/src/api/get-stock.ts:309:7)\n    at /home/sngvahmed/workspace/stockly/api/test/api/edge-cases.spec.ts:42:24\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20&quot;}}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.677Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Failed to fetch from DB during provider failure&quot;,&quot;type&quot;:&quot;general&quot;,&quot;error&quot;:{&quot;name&quot;:&quot;TypeError&quot;,&quot;message&quot;:&quot;Cannot read properties of undefined (reading &apos;bind&apos;)&quot;,&quot;stack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &apos;bind&apos;)\n    at handleProviderFailure (/home/sngvahmed/workspace/stockly/api/src/api/get-stock.ts:373:7)\n    at Module.getStock (/home/sngvahmed/workspace/stockly/api/src/api/get-stock.ts:345:20)\n    at /home/sngvahmed/workspace/stockly/api/test/api/edge-cases.spec.ts:42:24\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20&quot;}}

            </system-err>
        </testcase>
        <testcase classname="test/api/edge-cases.spec.ts" name="Edge Cases and Error Scenarios &gt; Invalid Input Handling &gt; should handle empty symbols array in getStocks" time="0.003">
        </testcase>
        <testcase classname="test/api/edge-cases.spec.ts" name="Edge Cases and Error Scenarios &gt; Invalid Input Handling &gt; should handle very long symbol list in getStocks" time="0.007">
            <system-err>
Failed to fetch profile from https://financialmodelingprep.com/stable/profile?symbol=AAPL&amp;apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM: TypeError: Body has already been used. It can only be used once. Use tee() first if you need to read it twice.
    at fetchProfileFromApi (/home/sngvahmed/workspace/stockly/api/src/api/get-stocks.ts:101:46)
    at fetchQuoteFromApi (/home/sngvahmed/workspace/stockly/api/src/api/get-stocks.ts:187:36)
    at async Promise.allSettled (index 0)
    at fetchQuotesBatchFromApi (/home/sngvahmed/workspace/stockly/api/src/api/get-stocks.ts:216:24)
    at Module.getStocks (/home/sngvahmed/workspace/stockly/api/src/api/get-stocks.ts:304:25)
    at /home/sngvahmed/workspace/stockly/api/test/api/edge-cases.spec.ts:79:24
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20

Failed to fetch profile from https://financialmodelingprep.com/stable/profile/AAPL?apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM: TypeError: Body has already been used. It can only be used once. Use tee() first if you need to read it twice.
    at fetchProfileFromApi (/home/sngvahmed/workspace/stockly/api/src/api/get-stocks.ts:101:46)
    at fetchQuoteFromApi (/home/sngvahmed/workspace/stockly/api/src/api/get-stocks.ts:187:36)
    at async Promise.allSettled (index 0)
    at fetchQuotesBatchFromApi (/home/sngvahmed/workspace/stockly/api/src/api/get-stocks.ts:216:24)
    at Module.getStocks (/home/sngvahmed/workspace/stockly/api/src/api/get-stocks.ts:304:25)
    at /home/sngvahmed/workspace/stockly/api/test/api/edge-cases.spec.ts:79:24
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20

Failed to fetch profile from https://financialmodelingprep.com/stable/company/profile/AAPL?apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM: TypeError: Body has already been used. It can only be used once. Use tee() first if you need to read it twice.
    at fetchProfileFromApi (/home/sngvahmed/workspace/stockly/api/src/api/get-stocks.ts:101:46)
    at fetchQuoteFromApi (/home/sngvahmed/workspace/stockly/api/src/api/get-stocks.ts:187:36)
    at async Promise.allSettled (index 0)
    at fetchQuotesBatchFromApi (/home/sngvahmed/workspace/stockly/api/src/api/get-stocks.ts:216:24)
    at Module.getStocks (/home/sngvahmed/workspace/stockly/api/src/api/get-stocks.ts:304:25)
    at /home/sngvahmed/workspace/stockly/api/test/api/edge-cases.spec.ts:79:24
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20

Failed to fetch profile from https://financialmodelingprep.com/api/v3/profile/AAPL?apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM: TypeError: Body has already been used. It can only be used once. Use tee() first if you need to read it twice.
    at fetchProfileFromApi (/home/sngvahmed/workspace/stockly/api/src/api/get-stocks.ts:101:46)
    at fetchQuoteFromApi (/home/sngvahmed/workspace/stockly/api/src/api/get-stocks.ts:187:36)
    at async Promise.allSettled (index 0)
    at fetchQuotesBatchFromApi (/home/sngvahmed/workspace/stockly/api/src/api/get-stocks.ts:216:24)
    at Module.getStocks (/home/sngvahmed/workspace/stockly/api/src/api/get-stocks.ts:304:25)
    at /home/sngvahmed/workspace/stockly/api/test/api/edge-cases.spec.ts:79:24
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20

Failed to fetch from Wikipedia: TypeError: Body has already been used. It can only be used once. Use tee() first if you need to read it twice.
    at fetchProfileFromApi (/home/sngvahmed/workspace/stockly/api/src/api/get-stocks.ts:155:40)
    at fetchQuoteFromApi (/home/sngvahmed/workspace/stockly/api/src/api/get-stocks.ts:187:36)
    at async Promise.allSettled (index 0)
    at fetchQuotesBatchFromApi (/home/sngvahmed/workspace/stockly/api/src/api/get-stocks.ts:216:24)
    at Module.getStocks (/home/sngvahmed/workspace/stockly/api/src/api/get-stocks.ts:304:25)
    at /home/sngvahmed/workspace/stockly/api/test/api/edge-cases.spec.ts:79:24
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20

            </system-err>
        </testcase>
        <testcase classname="test/api/edge-cases.spec.ts" name="Edge Cases and Error Scenarios &gt; Invalid Input Handling &gt; should handle empty search query" time="0.004">
        </testcase>
        <testcase classname="test/api/edge-cases.spec.ts" name="Edge Cases and Error Scenarios &gt; Invalid Input Handling &gt; should handle SQL injection attempts in search" time="0.004">
            <system-err>
Failed to read search cache TypeError: Cannot read properties of undefined (reading &apos;bind&apos;)
    at getDbCachedResults (/home/sngvahmed/workspace/stockly/api/src/api/search-stock.ts:24:7)
    at Module.searchStock (/home/sngvahmed/workspace/stockly/api/src/api/search-stock.ts:129:26)
    at /home/sngvahmed/workspace/stockly/api/test/api/edge-cases.spec.ts:100:30
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20
    at new Promise (&lt;anonymous&gt;)
    at runWithTimeout (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)
    at runTest (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)

Failed to parse /search-name response: TypeError: Body has already been used. It can only be used once. Use tee() first if you need to read it twice.
    at Module.searchStock (/home/sngvahmed/workspace/stockly/api/src/api/search-stock.ts:158:40)
    at /home/sngvahmed/workspace/stockly/api/test/api/edge-cases.spec.ts:100:24
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20

Failed to parse /search-symbol response: TypeError: Body has already been used. It can only be used once. Use tee() first if you need to read it twice.
    at Module.searchStock (/home/sngvahmed/workspace/stockly/api/src/api/search-stock.ts:170:44)
    at /home/sngvahmed/workspace/stockly/api/test/api/edge-cases.spec.ts:100:24
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20

            </system-err>
        </testcase>
        <testcase classname="test/api/edge-cases.spec.ts" name="Edge Cases and Error Scenarios &gt; Database Error Handling &gt; should handle database connection errors gracefully" time="0.003">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.701Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Cache hit for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;ageSeconds&quot;:0,&quot;pollingIntervalSec&quot;:30,&quot;cacheStatus&quot;:&quot;HIT&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/api/edge-cases.spec.ts" name="Edge Cases and Error Scenarios &gt; Database Error Handling &gt; should handle database timeout errors" time="0.002">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.704Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Cache hit for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;ageSeconds&quot;:0,&quot;pollingIntervalSec&quot;:30,&quot;cacheStatus&quot;:&quot;HIT&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/api/edge-cases.spec.ts" name="Edge Cases and Error Scenarios &gt; External API Error Handling &gt; should handle external API rate limiting" time="0.002">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.708Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Cache hit for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;ageSeconds&quot;:0,&quot;pollingIntervalSec&quot;:30,&quot;cacheStatus&quot;:&quot;HIT&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/api/edge-cases.spec.ts" name="Edge Cases and Error Scenarios &gt; External API Error Handling &gt; should handle external API timeout" time="0.003">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.710Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Cache hit for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;ageSeconds&quot;:0,&quot;pollingIntervalSec&quot;:30,&quot;cacheStatus&quot;:&quot;HIT&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/api/edge-cases.spec.ts" name="Edge Cases and Error Scenarios &gt; External API Error Handling &gt; should handle external API returning invalid JSON" time="0.002">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.713Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Cache hit for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;ageSeconds&quot;:0,&quot;pollingIntervalSec&quot;:30,&quot;cacheStatus&quot;:&quot;HIT&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/api/edge-cases.spec.ts" name="Edge Cases and Error Scenarios &gt; Authentication Edge Cases &gt; should handle expired access token" time="0.004">
        </testcase>
        <testcase classname="test/api/edge-cases.spec.ts" name="Edge Cases and Error Scenarios &gt; Authentication Edge Cases &gt; should handle malformed authorization header" time="0.003">
        </testcase>
        <testcase classname="test/api/edge-cases.spec.ts" name="Edge Cases and Error Scenarios &gt; Alert Edge Cases &gt; should handle negative threshold values" time="0.003">
        </testcase>
        <testcase classname="test/api/edge-cases.spec.ts" name="Edge Cases and Error Scenarios &gt; Alert Edge Cases &gt; should handle extremely large threshold values" time="0.001">
        </testcase>
        <testcase classname="test/api/edge-cases.spec.ts" name="Edge Cases and Error Scenarios &gt; Alert Edge Cases &gt; should handle missing required fields in alert creation" time="0.002">
        </testcase>
        <testcase classname="test/api/edge-cases.spec.ts" name="Edge Cases and Error Scenarios &gt; Boundary Conditions &gt; should handle maximum number of symbols in batch request" time="0.003">
        </testcase>
        <testcase classname="test/api/edge-cases.spec.ts" name="Edge Cases and Error Scenarios &gt; Boundary Conditions &gt; should handle very long search query" time="0.003">
            <system-err>
Failed to read search cache TypeError: Cannot read properties of undefined (reading &apos;bind&apos;)
    at getDbCachedResults (/home/sngvahmed/workspace/stockly/api/src/api/search-stock.ts:24:7)
    at Module.searchStock (/home/sngvahmed/workspace/stockly/api/src/api/search-stock.ts:129:26)
    at /home/sngvahmed/workspace/stockly/api/test/api/edge-cases.spec.ts:304:30
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20
    at new Promise (&lt;anonymous&gt;)
    at runWithTimeout (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)
    at runTest (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)

Failed to parse /search-name response: Error: Invalid JSON
    at Object.json (/home/sngvahmed/workspace/stockly/api/test/api/edge-cases.spec.ts:198:17)
    at Module.searchStock (/home/sngvahmed/workspace/stockly/api/src/api/search-stock.ts:158:40)
    at /home/sngvahmed/workspace/stockly/api/test/api/edge-cases.spec.ts:304:24
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20

Failed to parse /search-symbol response: Error: Invalid JSON
    at Object.json (/home/sngvahmed/workspace/stockly/api/test/api/edge-cases.spec.ts:198:17)
    at Module.searchStock (/home/sngvahmed/workspace/stockly/api/src/api/search-stock.ts:170:44)
    at /home/sngvahmed/workspace/stockly/api/test/api/edge-cases.spec.ts:304:24
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20

            </system-err>
        </testcase>
        <testcase classname="test/api/edge-cases.spec.ts" name="Edge Cases and Error Scenarios &gt; Concurrent Request Handling &gt; should handle multiple simultaneous requests for same symbol" time="0.004">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.741Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Cache hit for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;ageSeconds&quot;:0,&quot;pollingIntervalSec&quot;:30,&quot;cacheStatus&quot;:&quot;HIT&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.741Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Cache hit for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;ageSeconds&quot;:0,&quot;pollingIntervalSec&quot;:30,&quot;cacheStatus&quot;:&quot;HIT&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.742Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Cache hit for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;ageSeconds&quot;:0,&quot;pollingIntervalSec&quot;:30,&quot;cacheStatus&quot;:&quot;HIT&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.742Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Cache hit for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;ageSeconds&quot;:0,&quot;pollingIntervalSec&quot;:30,&quot;cacheStatus&quot;:&quot;HIT&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.742Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Cache hit for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;ageSeconds&quot;:0,&quot;pollingIntervalSec&quot;:30,&quot;cacheStatus&quot;:&quot;HIT&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.742Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Cache hit for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;ageSeconds&quot;:0,&quot;pollingIntervalSec&quot;:30,&quot;cacheStatus&quot;:&quot;HIT&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.742Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Cache hit for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;ageSeconds&quot;:0,&quot;pollingIntervalSec&quot;:30,&quot;cacheStatus&quot;:&quot;HIT&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.742Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Cache hit for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;ageSeconds&quot;:0,&quot;pollingIntervalSec&quot;:30,&quot;cacheStatus&quot;:&quot;HIT&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.742Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Cache hit for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;ageSeconds&quot;:0,&quot;pollingIntervalSec&quot;:30,&quot;cacheStatus&quot;:&quot;HIT&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.742Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Cache hit for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;ageSeconds&quot;:0,&quot;pollingIntervalSec&quot;:30,&quot;cacheStatus&quot;:&quot;HIT&quot;}

            </system-out>
        </testcase>
    </testsuite>
    <testsuite name="test/api/favorite-stocks.spec.ts" timestamp="2025-12-20T12:24:18.231Z" hostname="sngvahmed" tests="7" failures="0" errors="0" skipped="1" time="0.545">
        <testcase classname="test/api/favorite-stocks.spec.ts" name="Favorite Stocks API &gt; getFavoriteStocks &gt; should return favorite stocks for authenticated user" time="0.046">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.287Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Fetched favorite stocks&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;count&quot;:2}

            </system-out>
        </testcase>
        <testcase classname="test/api/favorite-stocks.spec.ts" name="Favorite Stocks API &gt; getFavoriteStocks &gt; should return 401 for unauthenticated request" time="0.065">
        </testcase>
        <testcase classname="test/api/favorite-stocks.spec.ts" name="Favorite Stocks API &gt; updateFavoriteStocks &gt; should update favorite stocks for authenticated user" time="0.059">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.440Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;user-123&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Received favorite stocks update request&quot;,&quot;type&quot;:&quot;general&quot;,&quot;bodyType&quot;:&quot;object&quot;,&quot;bodyStringified&quot;:&quot;{\&quot;symbols\&quot;:[\&quot;AAPL\&quot;,\&quot;GOOGL\&quot;]}&quot;,&quot;hasSymbols&quot;:true,&quot;bodyKeys&quot;:[&quot;symbols&quot;]}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.440Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;user-123&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Processing symbols array&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbolsArrayLength&quot;:2,&quot;symbolsArray&quot;:&quot;[\&quot;AAPL\&quot;,\&quot;GOOGL\&quot;]&quot;,&quot;symbolsArrayTypes&quot;:[&quot;string&quot;,&quot;string&quot;]}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.440Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;user-123&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Normalized symbols&quot;,&quot;type&quot;:&quot;general&quot;,&quot;originalCount&quot;:2,&quot;normalizedCount&quot;:2,&quot;uniqueCount&quot;:2,&quot;uniqueSymbols&quot;:[&quot;AAPL&quot;,&quot;GOOGL&quot;]}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.440Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;user-123&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Updated favorite stocks&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;count&quot;:2,&quot;symbols&quot;:[&quot;AAPL&quot;,&quot;GOOGL&quot;]}

            </system-out>
        </testcase>
        <testcase classname="test/api/favorite-stocks.spec.ts" name="Favorite Stocks API &gt; updateFavoriteStocks &gt; should validate symbols array" time="0.045">
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.500Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Cannot read properties of undefined (reading &apos;bind&apos;)&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;name&quot;:&quot;TypeError&quot;,&quot;stack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &apos;bind&apos;)\n    at Module.updateFavoriteStocks (/home/sngvahmed/workspace/stockly/api/src/api/favorite-stocks.ts:111:57)\n    at /home/sngvahmed/workspace/stockly/api/test/api/favorite-stocks.spec.ts:135:24\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20&quot;,&quot;error&quot;:{&quot;name&quot;:&quot;TypeError&quot;,&quot;message&quot;:&quot;Cannot read properties of undefined (reading &apos;bind&apos;)&quot;,&quot;stack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &apos;bind&apos;)\n    at Module.updateFavoriteStocks (/home/sngvahmed/workspace/stockly/api/src/api/favorite-stocks.ts:111:57)\n    at /home/sngvahmed/workspace/stockly/api/test/api/favorite-stocks.spec.ts:135:24\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20&quot;}}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.500Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Unexpected error in updateFavoriteStocks&quot;,&quot;type&quot;:&quot;general&quot;,&quot;error&quot;:&quot;[object Object]&quot;}

            </system-err>
        </testcase>
        <testcase classname="test/api/favorite-stocks.spec.ts" name="Favorite Stocks API &gt; deleteFavoriteStock &gt; should delete favorite stock for authenticated user" time="0.062">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.605Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Deleted favorite stock&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;symbol&quot;:&quot;AAPL&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/api/favorite-stocks.spec.ts" name="Favorite Stocks API &gt; getAllUsersFavoriteStocks &gt; should return all favorite stocks for admin" time="0">
            <skipped/>
        </testcase>
        <testcase classname="test/api/favorite-stocks.spec.ts" name="Favorite Stocks API &gt; getAllUsersFavoriteStocks &gt; should deny non-admin access" time="0.056">
        </testcase>
    </testsuite>
    <testsuite name="test/api/get-historical-intraday.spec.ts" timestamp="2025-12-20T12:24:18.232Z" hostname="sngvahmed" tests="19" failures="0" errors="0" skipped="0" time="0.987">
        <testcase classname="test/api/get-historical-intraday.spec.ts" name="getHistoricalIntraday handler &gt; Parameter validation &gt; requires a symbol parameter" time="0.034">
        </testcase>
        <testcase classname="test/api/get-historical-intraday.spec.ts" name="getHistoricalIntraday handler &gt; Parameter validation &gt; validates days parameter - must be between 1 and 30" time="0.054">
            <system-out>
[getHistoricalIntraday] Fetching 4h data for AAPL (2025-12-19 to 2025-12-20)
[fetch30MinuteData] Fetching 30-min data for AAPL from 2025-12-19 to 2025-12-20

[fetch30MinuteData] Received 0 30-minute candles

[getHistoricalIntraday] Fetching 4h data for AAPL (2025-12-05 to 2025-12-20)
[fetch30MinuteData] Fetching 30-min data for AAPL from 2025-12-05 to 2025-12-20

[fetch30MinuteData] Received 0 30-minute candles

[getHistoricalIntraday] Fetching 4h data for AAPL (2025-11-20 to 2025-12-20)
[fetch30MinuteData] Fetching 30-min data for AAPL from 2025-11-20 to 2025-12-20

[fetch30MinuteData] Received 0 30-minute candles

            </system-out>
            <system-err>
[getHistoricalIntraday] No 30-minute data available for AAPL

[getHistoricalIntraday] No 30-minute data available for AAPL

[getHistoricalIntraday] No 30-minute data available for AAPL

            </system-err>
        </testcase>
        <testcase classname="test/api/get-historical-intraday.spec.ts" name="getHistoricalIntraday handler &gt; Parameter validation &gt; validates interval format" time="0.17">
            <system-out>
[getHistoricalIntraday] Fetching 4h data for AAPL (2025-12-17 to 2025-12-20)
[fetch30MinuteData] Fetching 30-min data for AAPL from 2025-12-17 to 2025-12-20

[fetch30MinuteData] Received 0 30-minute candles

[getHistoricalIntraday] Fetching 1h data for AAPL (2025-12-17 to 2025-12-20)
[fetch30MinuteData] Fetching 30-min data for AAPL from 2025-12-17 to 2025-12-20

[fetch30MinuteData] Received 0 30-minute candles

[getHistoricalIntraday] Fetching 4h data for AAPL (2025-12-17 to 2025-12-20)
[fetch30MinuteData] Fetching 30-min data for AAPL from 2025-12-17 to 2025-12-20

[fetch30MinuteData] Received 0 30-minute candles

[getHistoricalIntraday] Fetching 30m data for AAPL (2025-12-17 to 2025-12-20)
[fetch30MinuteData] Fetching 30-min data for AAPL from 2025-12-17 to 2025-12-20

[fetch30MinuteData] Received 0 30-minute candles

[getHistoricalIntraday] Fetching 15m data for AAPL (2025-12-17 to 2025-12-20)
[fetch30MinuteData] Fetching 30-min data for AAPL from 2025-12-17 to 2025-12-20

[fetch30MinuteData] Received 0 30-minute candles

[getHistoricalIntraday] Fetching 2h data for AAPL (2025-12-17 to 2025-12-20)
[fetch30MinuteData] Fetching 30-min data for AAPL from 2025-12-17 to 2025-12-20

[fetch30MinuteData] Received 0 30-minute candles

            </system-out>
            <system-err>
[getHistoricalIntraday] No 30-minute data available for AAPL

[getHistoricalIntraday] No 30-minute data available for AAPL

[getHistoricalIntraday] No 30-minute data available for AAPL

[getHistoricalIntraday] No 30-minute data available for AAPL

[getHistoricalIntraday] No 30-minute data available for AAPL

[getHistoricalIntraday] No 30-minute data available for AAPL

            </system-err>
        </testcase>
        <testcase classname="test/api/get-historical-intraday.spec.ts" name="getHistoricalIntraday handler &gt; Parameter validation &gt; uses default interval (4h) when not provided" time="0.041">
            <system-out>
[getHistoricalIntraday] Fetching 4h data for AAPL (2025-12-17 to 2025-12-20)
[fetch30MinuteData] Fetching 30-min data for AAPL from 2025-12-17 to 2025-12-20

[fetch30MinuteData] Received 0 30-minute candles

            </system-out>
            <system-err>
[getHistoricalIntraday] No 30-minute data available for AAPL

            </system-err>
        </testcase>
        <testcase classname="test/api/get-historical-intraday.spec.ts" name="getHistoricalIntraday handler &gt; Parameter validation &gt; uses default days (3) when not provided" time="0.185">
            <system-out>
[getHistoricalIntraday] Fetching 4h data for AAPL (2025-12-17 to 2025-12-20)
[fetch30MinuteData] Fetching 30-min data for AAPL from 2025-12-17 to 2025-12-20

[fetch30MinuteData] Received 0 30-minute candles

            </system-out>
            <system-err>
[getHistoricalIntraday] No 30-minute data available for AAPL

            </system-err>
        </testcase>
        <testcase classname="test/api/get-historical-intraday.spec.ts" name="getHistoricalIntraday handler &gt; Parameter validation &gt; normalizes symbol to uppercase" time="0.043">
            <system-out>
[getHistoricalIntraday] Fetching 4h data for AAPL (2025-12-17 to 2025-12-20)
[fetch30MinuteData] Fetching 30-min data for AAPL from 2025-12-17 to 2025-12-20

[fetch30MinuteData] Received 0 30-minute candles

            </system-out>
            <system-err>
[getHistoricalIntraday] No 30-minute data available for AAPL

            </system-err>
        </testcase>
        <testcase classname="test/api/get-historical-intraday.spec.ts" name="getHistoricalIntraday handler &gt; Date range calculation &gt; calculates correct date range based on days parameter" time="0.029">
            <system-out>
[getHistoricalIntraday] Fetching 4h data for AAPL (2025-12-15 to 2025-12-20)
[fetch30MinuteData] Fetching 30-min data for AAPL from 2025-12-15 to 2025-12-20

[fetch30MinuteData] Received 10 30-minute candles

[getHistoricalIntraday] Aggregated 10 30-min candles into 2 4h candles

            </system-out>
        </testcase>
        <testcase classname="test/api/get-historical-intraday.spec.ts" name="getHistoricalIntraday handler &gt; FMP API integration &gt; calls FMP API with correct parameters" time="0.039">
            <system-out>
[getHistoricalIntraday] Fetching 4h data for AAPL (2025-12-17 to 2025-12-20)
[fetch30MinuteData] Fetching 30-min data for AAPL from 2025-12-17 to 2025-12-20

[fetch30MinuteData] Received 10 30-minute candles

[getHistoricalIntraday] Aggregated 10 30-min candles into 2 4h candles

            </system-out>
        </testcase>
        <testcase classname="test/api/get-historical-intraday.spec.ts" name="getHistoricalIntraday handler &gt; FMP API integration &gt; handles FMP API errors gracefully" time="0.032">
            <system-out>
[getHistoricalIntraday] Fetching 4h data for INVALID (2025-12-17 to 2025-12-20)
[fetch30MinuteData] Fetching 30-min data for INVALID from 2025-12-17 to 2025-12-20

            </system-out>
            <system-err>
[fetch30MinuteData] FMP API error: Invalid symbol

[getHistoricalIntraday] Error: FMP API error: Invalid symbol Error: FMP API error: Invalid symbol
    at fetch30MinuteData (/home/sngvahmed/workspace/stockly/api/src/api/get-historical-intraday.ts:182:19)
    at getHistoricalIntraday (/home/sngvahmed/workspace/stockly/api/src/api/get-historical-intraday.ts:252:31)
    at /home/sngvahmed/workspace/stockly/api/test/api/get-historical-intraday.spec.ts:281:24
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20

            </system-err>
        </testcase>
        <testcase classname="test/api/get-historical-intraday.spec.ts" name="getHistoricalIntraday handler &gt; FMP API integration &gt; handles HTTP errors from FMP API" time="0.025">
            <system-out>
[getHistoricalIntraday] Fetching 4h data for AAPL (2025-12-17 to 2025-12-20)
[fetch30MinuteData] Fetching 30-min data for AAPL from 2025-12-17 to 2025-12-20

            </system-out>
            <system-err>
[fetch30MinuteData] HTTP 500: Internal Server Error

[getHistoricalIntraday] Error: Failed to fetch 30-minute data: HTTP 500 Error: Failed to fetch 30-minute data: HTTP 500
    at fetch30MinuteData (/home/sngvahmed/workspace/stockly/api/src/api/get-historical-intraday.ts:171:15)
    at getHistoricalIntraday (/home/sngvahmed/workspace/stockly/api/src/api/get-historical-intraday.ts:252:31)
    at /home/sngvahmed/workspace/stockly/api/test/api/get-historical-intraday.spec.ts:300:24
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20

            </system-err>
        </testcase>
        <testcase classname="test/api/get-historical-intraday.spec.ts" name="getHistoricalIntraday handler &gt; FMP API integration &gt; handles empty data response" time="0.031">
            <system-out>
[getHistoricalIntraday] Fetching 4h data for AAPL (2025-12-17 to 2025-12-20)
[fetch30MinuteData] Fetching 30-min data for AAPL from 2025-12-17 to 2025-12-20

[fetch30MinuteData] Received 0 30-minute candles

            </system-out>
            <system-err>
[getHistoricalIntraday] No 30-minute data available for AAPL

            </system-err>
        </testcase>
        <testcase classname="test/api/get-historical-intraday.spec.ts" name="getHistoricalIntraday handler &gt; FMP API integration &gt; filters out invalid records from API response" time="0.022">
            <system-out>
[getHistoricalIntraday] Fetching 1h data for AAPL (2025-12-17 to 2025-12-20)
[fetch30MinuteData] Fetching 30-min data for AAPL from 2025-12-17 to 2025-12-20

[fetch30MinuteData] Received 4 30-minute candles

[getHistoricalIntraday] Aggregated 2 30-min candles into 2 1h candles

            </system-out>
        </testcase>
        <testcase classname="test/api/get-historical-intraday.spec.ts" name="getHistoricalIntraday handler &gt; OHLC aggregation &gt; aggregates 30-minute data to 1-hour intervals" time="0.017">
            <system-out>
[getHistoricalIntraday] Fetching 1h data for AAPL (2025-12-19 to 2025-12-20)
[fetch30MinuteData] Fetching 30-min data for AAPL from 2025-12-19 to 2025-12-20

[fetch30MinuteData] Received 4 30-minute candles

[getHistoricalIntraday] Aggregated 4 30-min candles into 2 1h candles

            </system-out>
        </testcase>
        <testcase classname="test/api/get-historical-intraday.spec.ts" name="getHistoricalIntraday handler &gt; OHLC aggregation &gt; aggregates 30-minute data to 4-hour intervals" time="0.022">
            <system-out>
[getHistoricalIntraday] Fetching 4h data for AAPL (2025-12-19 to 2025-12-20)
[fetch30MinuteData] Fetching 30-min data for AAPL from 2025-12-19 to 2025-12-20

[fetch30MinuteData] Received 8 30-minute candles

[getHistoricalIntraday] Aggregated 8 30-min candles into 1 4h candles

            </system-out>
        </testcase>
        <testcase classname="test/api/get-historical-intraday.spec.ts" name="getHistoricalIntraday handler &gt; OHLC aggregation &gt; correctly calculates OHLC values during aggregation" time="0.025">
            <system-out>
[getHistoricalIntraday] Fetching 1h data for AAPL (2025-12-19 to 2025-12-20)
[fetch30MinuteData] Fetching 30-min data for AAPL from 2025-12-19 to 2025-12-20

[fetch30MinuteData] Received 4 30-minute candles

[getHistoricalIntraday] Aggregated 4 30-min candles into 2 1h candles

            </system-out>
        </testcase>
        <testcase classname="test/api/get-historical-intraday.spec.ts" name="getHistoricalIntraday handler &gt; Response format &gt; returns correct JSON structure on success" time="0.016">
            <system-out>
[getHistoricalIntraday] Fetching 4h data for AAPL (2025-12-17 to 2025-12-20)
[fetch30MinuteData] Fetching 30-min data for AAPL from 2025-12-17 to 2025-12-20

[fetch30MinuteData] Received 10 30-minute candles

[getHistoricalIntraday] Aggregated 10 30-min candles into 2 4h candles

            </system-out>
        </testcase>
        <testcase classname="test/api/get-historical-intraday.spec.ts" name="getHistoricalIntraday handler &gt; Response format &gt; returns correct structure on empty data" time="0.014">
            <system-out>
[getHistoricalIntraday] Fetching 4h data for AAPL (2025-12-17 to 2025-12-20)
[fetch30MinuteData] Fetching 30-min data for AAPL from 2025-12-17 to 2025-12-20

[fetch30MinuteData] Received 0 30-minute candles

            </system-out>
            <system-err>
[getHistoricalIntraday] No 30-minute data available for AAPL

            </system-err>
        </testcase>
        <testcase classname="test/api/get-historical-intraday.spec.ts" name="getHistoricalIntraday handler &gt; Error handling &gt; handles network errors" time="0.014">
            <system-out>
[getHistoricalIntraday] Fetching 4h data for AAPL (2025-12-17 to 2025-12-20)
[fetch30MinuteData] Fetching 30-min data for AAPL from 2025-12-17 to 2025-12-20

            </system-out>
            <system-err>
[getHistoricalIntraday] Error: Network error Error: Network error
    at /home/sngvahmed/workspace/stockly/api/test/api/get-historical-intraday.spec.ts:525:9
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20
    at new Promise (&lt;anonymous&gt;)
    at runWithTimeout (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)
    at runTest (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)

            </system-err>
        </testcase>
        <testcase classname="test/api/get-historical-intraday.spec.ts" name="getHistoricalIntraday handler &gt; Error handling &gt; handles invalid JSON response" time="0.013">
            <system-out>
[getHistoricalIntraday] Fetching 4h data for AAPL (2025-12-17 to 2025-12-20)
[fetch30MinuteData] Fetching 30-min data for AAPL from 2025-12-17 to 2025-12-20

            </system-out>
            <system-err>
[getHistoricalIntraday] Error: Unexpected token &apos;I&apos;, &quot;Invalid JSON&quot; is not valid JSON SyntaxError: Unexpected token &apos;I&apos;, &quot;Invalid JSON&quot; is not valid JSON
    at fetch30MinuteData (/home/sngvahmed/workspace/stockly/api/src/api/get-historical-intraday.ts:174:18)
    at getHistoricalIntraday (/home/sngvahmed/workspace/stockly/api/src/api/get-historical-intraday.ts:252:31)
    at /home/sngvahmed/workspace/stockly/api/test/api/get-historical-intraday.spec.ts:549:24
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20

            </system-err>
        </testcase>
    </testsuite>
    <testsuite name="test/api/get-news.spec.ts" timestamp="2025-12-20T12:24:18.239Z" hostname="sngvahmed" tests="4" failures="0" errors="0" skipped="0" time="0.334">
        <testcase classname="test/api/get-news.spec.ts" name="Get News API &gt; getNews &gt; should return news articles" time="0.041">
            <system-out>
News cache miss for AAPL, fetching from API...

            </system-out>
        </testcase>
        <testcase classname="test/api/get-news.spec.ts" name="Get News API &gt; getNews &gt; should handle pagination correctly" time="0.035">
            <system-out>
News cache miss for AAPL, fetching from API...

            </system-out>
        </testcase>
        <testcase classname="test/api/get-news.spec.ts" name="Get News API &gt; getNews &gt; should handle external API errors gracefully" time="0.065">
            <system-out>
News cache miss for AAPL, fetching from API...

            </system-out>
            <system-err>
Failed to fetch news from FMP API for symbols AAPL: Error: FMP API failed: HTTP 500
    at fetchNewsFromApi (/home/sngvahmed/workspace/stockly/api/src/api/get-news.ts:68:13)
    at Module.getNews (/home/sngvahmed/workspace/stockly/api/src/api/get-news.ts:293:22)
    at /home/sngvahmed/workspace/stockly/api/test/api/get-news.spec.ts:86:24
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20

Error fetching news for AAPL: Error: FMP API failed: HTTP 500
    at fetchNewsFromApi (/home/sngvahmed/workspace/stockly/api/src/api/get-news.ts:68:13)
    at Module.getNews (/home/sngvahmed/workspace/stockly/api/src/api/get-news.ts:293:22)
    at /home/sngvahmed/workspace/stockly/api/test/api/get-news.spec.ts:86:24
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20

            </system-err>
        </testcase>
        <testcase classname="test/api/get-news.spec.ts" name="Get News API &gt; getFavoriteNews &gt; should return favorite news for authenticated user" time="0.056">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.623Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Fetching favorite news&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.624Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No favorite symbols selected&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;}

            </system-out>
        </testcase>
    </testsuite>
    <testsuite name="test/api/news-archive.spec.ts" timestamp="2025-12-20T12:24:18.240Z" hostname="sngvahmed" tests="4" failures="0" errors="0" skipped="0" time="0.365">
        <testcase classname="test/api/news-archive.spec.ts" name="News Archive API &gt; getArchivedNews &gt; should return archived news for authenticated user" time="0.038">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.272Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;user-123&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Fetching archived news&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;page&quot;:1,&quot;limit&quot;:10}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.274Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;user-123&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Archived news fetched successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;page&quot;:1,&quot;limit&quot;:10,&quot;total&quot;:10,&quot;returned&quot;:1,&quot;hasMore&quot;:false}

            </system-out>
        </testcase>
        <testcase classname="test/api/news-archive.spec.ts" name="News Archive API &gt; getArchivedNews &gt; should handle pagination correctly" time="0.047">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.310Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;user-123&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Fetching archived news&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;page&quot;:2,&quot;limit&quot;:10}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.310Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;user-123&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Archived news fetched successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;page&quot;:2,&quot;limit&quot;:10,&quot;total&quot;:25,&quot;returned&quot;:0,&quot;hasMore&quot;:true}

            </system-out>
        </testcase>
        <testcase classname="test/api/news-archive.spec.ts" name="News Archive API &gt; toggleArchivedNews &gt; should save article to archive" time="0.044">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.421Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Article saved successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;articleId&quot;:&quot;article-123&quot;,&quot;symbol&quot;:&quot;AAPL&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/api/news-archive.spec.ts" name="News Archive API &gt; toggleArchivedNews &gt; should remove article from archive if already saved" time="0.063">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.486Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Article unsaved successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;articleId&quot;:&quot;article-123&quot;}

            </system-out>
        </testcase>
    </testsuite>
    <testsuite name="test/api/preferences.spec.ts" timestamp="2025-12-20T12:24:18.241Z" hostname="sngvahmed" tests="12" failures="0" errors="0" skipped="0" time="0.642">
        <testcase classname="test/api/preferences.spec.ts" name="Preferences API &gt; getPreferences &gt; should return preferences for authenticated user" time="0.05">
        </testcase>
        <testcase classname="test/api/preferences.spec.ts" name="Preferences API &gt; getPreferences &gt; should return 404 if user not found (getPreferences)" time="0.064">
        </testcase>
        <testcase classname="test/api/preferences.spec.ts" name="Preferences API &gt; getPreferences &gt; should return default preferences if none exist" time="0.047">
        </testcase>
        <testcase classname="test/api/preferences.spec.ts" name="Preferences API &gt; updatePreferences &gt; should update preferences for authenticated user" time="0.044">
        </testcase>
        <testcase classname="test/api/preferences.spec.ts" name="Preferences API &gt; updatePreferences &gt; should create preferences if they don&apos;t exist" time="0.053">
        </testcase>
        <testcase classname="test/api/preferences.spec.ts" name="Preferences API &gt; updatePreferences &gt; should validate quiet hours format" time="0.036">
        </testcase>
        <testcase classname="test/api/preferences.spec.ts" name="Preferences API &gt; updatePreferences &gt; should return 400 for invalid quietStart type" time="0.036">
        </testcase>
        <testcase classname="test/api/preferences.spec.ts" name="Preferences API &gt; updatePreferences &gt; should return 400 for invalid quietEnd type" time="0.05">
        </testcase>
        <testcase classname="test/api/preferences.spec.ts" name="Preferences API &gt; updatePreferences &gt; should return 400 for invalid enabled type" time="0.034">
        </testcase>
        <testcase classname="test/api/preferences.spec.ts" name="Preferences API &gt; updatePreferences &gt; should return 400 for invalid maxDaily" time="0.031">
        </testcase>
        <testcase classname="test/api/preferences.spec.ts" name="Preferences API &gt; updatePreferences &gt; should return 400 for invalid allowedSymbols" time="0.026">
        </testcase>
        <testcase classname="test/api/preferences.spec.ts" name="Preferences API &gt; updatePreferences &gt; should return 500 on DB error" time="0.031">
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.826Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Failed to update preferences&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;t&quot;,&quot;error&quot;:{&quot;name&quot;:&quot;Error&quot;,&quot;message&quot;:&quot;DB Fail&quot;,&quot;stack&quot;:&quot;Error: DB Fail\n    at Object.&lt;anonymous&gt; (/home/sngvahmed/workspace/stockly/api/test/api/preferences.spec.ts:312:55)\n    at Object.mockCall (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/spy/dist/index.js:96:15)\n    at Object.spy [as prepare] (home/sngvahmed/workspace/stockly/api/node_modules/tinyspy/dist/index.js:47:80)\n    at Module.updatePreferences (/home/sngvahmed/workspace/stockly/api/src/api/preferences.ts:142:8)\n    at /home/sngvahmed/workspace/stockly/api/test/api/preferences.spec.ts:315:19\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20&quot;}}

            </system-err>
        </testcase>
    </testsuite>
    <testsuite name="test/api/push-token.spec.ts" timestamp="2025-12-20T12:24:18.243Z" hostname="sngvahmed" tests="18" failures="0" errors="0" skipped="0" time="0.789">
        <testcase classname="test/api/push-token.spec.ts" name="Push Token API &gt; registerPushToken &gt; should register new push token" time="0.051">
            <system-out>
✅ FCM token validation passed: length=30, format valid

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.309Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;user-123&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Registering new push token&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;deviceType&quot;:&quot;android&quot;,&quot;tokenPreview&quot;:&quot;fcm-token-1234567890...&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.309Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;user-123&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Push token registered successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;deviceType&quot;:&quot;android&quot;,&quot;deviceId&quot;:&quot;fcm-token-1234567890...&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/api/push-token.spec.ts" name="Push Token API &gt; registerPushToken &gt; should update existing push token" time="0.063">
            <system-out>
✅ FCM token validation passed: length=30, format valid

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.358Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;user-123&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Updating existing push token&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;deviceType&quot;:&quot;android&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.358Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;user-123&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Push token updated successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;deviceType&quot;:&quot;android&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/api/push-token.spec.ts" name="Push Token API &gt; registerPushToken &gt; should reassign token to new user if different user" time="0.045">
            <system-out>
✅ FCM token validation passed: length=30, format valid

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.423Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;user-123&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Reassigning push token to different user&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;previousUserId&quot;:&quot;user-456&quot;,&quot;deviceType&quot;:&quot;android&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.423Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;user-123&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Push token reassigned successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;deviceType&quot;:&quot;android&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/api/push-token.spec.ts" name="Push Token API &gt; registerPushToken &gt; should validate token format" time="0.061">
        </testcase>
        <testcase classname="test/api/push-token.spec.ts" name="Push Token API &gt; registerPushToken &gt; should reject Expo tokens" time="0.041">
        </testcase>
        <testcase classname="test/api/push-token.spec.ts" name="Push Token API &gt; registerPushToken &gt; should reject short FCM tokens" time="0.055">
        </testcase>
        <testcase classname="test/api/push-token.spec.ts" name="Push Token API &gt; registerPushToken &gt; should normalize deviceType from info" time="0.037">
            <system-out>
✅ FCM token validation passed: length=26, format valid

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.623Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;u&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Registering new push token&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;t&quot;,&quot;deviceType&quot;:&quot;ios&quot;,&quot;tokenPreview&quot;:&quot;valid-fcm-token-1234...&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.624Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;u&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Push token registered successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;t&quot;,&quot;deviceType&quot;:&quot;ios&quot;,&quot;deviceId&quot;:&quot;t...&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/api/push-token.spec.ts" name="Push Token API &gt; registerPushToken &gt; should return 500 on DB error" time="0.037">
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.659Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Failed to register push token&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;t&quot;,&quot;error&quot;:{&quot;name&quot;:&quot;Error&quot;,&quot;message&quot;:&quot;DB Fail&quot;,&quot;stack&quot;:&quot;Error: DB Fail\n    at Object.&lt;anonymous&gt; (/home/sngvahmed/workspace/stockly/api/test/api/push-token.spec.ts:291:55)\n    at Object.mockCall (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/spy/dist/index.js:96:15)\n    at Object.spy [as prepare] (home/sngvahmed/workspace/stockly/api/node_modules/tinyspy/dist/index.js:47:80)\n    at Module.registerPushToken (/home/sngvahmed/workspace/stockly/api/src/api/push-token.ts:60:8)\n    at /home/sngvahmed/workspace/stockly/api/test/api/push-token.spec.ts:294:19\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20&quot;}}

            </system-err>
        </testcase>
        <testcase classname="test/api/push-token.spec.ts" name="Push Token API &gt; registerPushToken &gt; should fallback to legacy insert if device_type column missing" time="0.038">
            <system-out>
✅ FCM token validation passed: length=22, format valid

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.696Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;u&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Registering new push token&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;t&quot;,&quot;deviceType&quot;:&quot;unknown&quot;,&quot;tokenPreview&quot;:&quot;valid-token-12345678...&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.697Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;u&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Push token registered successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;t&quot;,&quot;deviceType&quot;:&quot;unknown&quot;,&quot;deviceId&quot;:&quot;t...&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/api/push-token.spec.ts" name="Push Token API &gt; getPushToken &gt; should return push tokens for authenticated user" time="0.031">
        </testcase>
        <testcase classname="test/api/push-token.spec.ts" name="Push Token API &gt; getPushToken &gt; should return 404 if user not found" time="0.032">
        </testcase>
        <testcase classname="test/api/push-token.spec.ts" name="Push Token API &gt; getPushToken &gt; should return 404 if no tokens found" time="0.026">
        </testcase>
        <testcase classname="test/api/push-token.spec.ts" name="Push Token API &gt; getPushToken &gt; should return 500 on DB error" time="0.027">
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.854Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Failed to get push tokens&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;t&quot;,&quot;error&quot;:{&quot;name&quot;:&quot;Error&quot;,&quot;message&quot;:&quot;DB Fail&quot;,&quot;stack&quot;:&quot;Error: DB Fail\n    at Object.&lt;anonymous&gt; (/home/sngvahmed/workspace/stockly/api/test/api/push-token.spec.ts:402:55)\n    at Object.mockCall (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/spy/dist/index.js:96:15)\n    at Object.spy [as prepare] (home/sngvahmed/workspace/stockly/api/node_modules/tinyspy/dist/index.js:47:80)\n    at Module.getPushToken (/home/sngvahmed/workspace/stockly/api/src/api/push-token.ts:376:8)\n    at /home/sngvahmed/workspace/stockly/api/test/api/push-token.spec.ts:405:24\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20&quot;}}

            </system-err>
        </testcase>
        <testcase classname="test/api/push-token.spec.ts" name="Push Token API &gt; getPushToken &gt; should handle legacy schema (no device_type column)" time="0.026">
        </testcase>
        <testcase classname="test/api/push-token.spec.ts" name="Push Token API &gt; getPushToken &gt; should return registered=true when token is registered for user (check mode)" time="0.028">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.907Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;user-123&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Device registration check&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;pushToken&quot;:&quot;fcm-token-1234567890...&quot;,&quot;registered&quot;:true}

            </system-out>
        </testcase>
        <testcase classname="test/api/push-token.spec.ts" name="Push Token API &gt; getPushToken &gt; should return registered=false when token is not registered for user (check mode)" time="0.025">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.935Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;user-123&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Device registration check&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;pushToken&quot;:&quot;fcm-token-unregister...&quot;,&quot;registered&quot;:false}

            </system-out>
        </testcase>
        <testcase classname="test/api/push-token.spec.ts" name="Push Token API &gt; getPushToken &gt; should return 400 when check=true but token parameter is missing" time="0.024">
        </testcase>
        <testcase classname="test/api/push-token.spec.ts" name="Push Token API &gt; getPushToken &gt; should return registered=false when token belongs to different user (check mode)" time="0.022">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.985Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:&quot;user-123&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Device registration check&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;pushToken&quot;:&quot;fcm-token-other-user...&quot;,&quot;registered&quot;:false}

            </system-out>
        </testcase>
    </testsuite>
    <testsuite name="test/api/settings.spec.ts" timestamp="2025-12-20T12:24:18.246Z" hostname="sngvahmed" tests="6" failures="0" errors="0" skipped="0" time="0.419">
        <testcase classname="test/api/settings.spec.ts" name="Settings API &gt; getSettings &gt; should return settings for authenticated user" time="0.035">
        </testcase>
        <testcase classname="test/api/settings.spec.ts" name="Settings API &gt; getSettings &gt; should return default settings if none exist" time="0.046">
        </testcase>
        <testcase classname="test/api/settings.spec.ts" name="Settings API &gt; updateSettings &gt; should update settings for authenticated user" time="0.042">
        </testcase>
        <testcase classname="test/api/settings.spec.ts" name="Settings API &gt; updateSettings &gt; should create settings if they don&apos;t exist" time="0.054">
        </testcase>
        <testcase classname="test/api/settings.spec.ts" name="Settings API &gt; updateSettings &gt; should return 400 for invalid refreshIntervalMinutes" time="0.038">
        </testcase>
        <testcase classname="test/api/settings.spec.ts" name="Settings API &gt; updateSettings &gt; should return 500 on DB error during update" time="0.039">
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.640Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Failed to update settings&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;error&quot;:{&quot;name&quot;:&quot;Error&quot;,&quot;message&quot;:&quot;DB Fail&quot;,&quot;stack&quot;:&quot;Error: DB Fail\n    at Object.&lt;anonymous&gt; (/home/sngvahmed/workspace/stockly/api/test/api/settings.spec.ts:234:55)\n    at Object.mockCall (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/spy/dist/index.js:96:15)\n    at Object.spy [as prepare] (home/sngvahmed/workspace/stockly/api/node_modules/tinyspy/dist/index.js:47:80)\n    at Module.updateSettings (/home/sngvahmed/workspace/stockly/api/src/api/settings.ts:137:8)\n    at /home/sngvahmed/workspace/stockly/api/test/api/settings.spec.ts:241:24\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20&quot;}}

            </system-err>
        </testcase>
    </testsuite>
    <testsuite name="test/api/throttle-cache.spec.ts" timestamp="2025-12-20T12:24:18.247Z" hostname="sngvahmed" tests="21" failures="0" errors="0" skipped="0" time="1.466">
        <testcase classname="test/api/throttle-cache.spec.ts" name="Throttle Cache &gt; isThrottled &gt; should return false if key is not throttled" time="0.033">
        </testcase>
        <testcase classname="test/api/throttle-cache.spec.ts" name="Throttle Cache &gt; isThrottled &gt; should return true if key was recently throttled" time="0.031">
        </testcase>
        <testcase classname="test/api/throttle-cache.spec.ts" name="Throttle Cache &gt; isThrottled &gt; should return false if throttle window has expired" time="0.084">
        </testcase>
        <testcase classname="test/api/throttle-cache.spec.ts" name="Throttle Cache &gt; isThrottled &gt; should return true if within throttle window" time="0.037">
        </testcase>
        <testcase classname="test/api/throttle-cache.spec.ts" name="Throttle Cache &gt; isThrottled &gt; should handle multiple keys independently" time="0.074">
        </testcase>
        <testcase classname="test/api/throttle-cache.spec.ts" name="Throttle Cache &gt; markThrottled &gt; should mark a key as throttled" time="0.086">
        </testcase>
        <testcase classname="test/api/throttle-cache.spec.ts" name="Throttle Cache &gt; markThrottled &gt; should update throttle timestamp when called again" time="0.047">
        </testcase>
        <testcase classname="test/api/throttle-cache.spec.ts" name="Throttle Cache &gt; markThrottled &gt; should handle empty string key" time="0.062">
        </testcase>
        <testcase classname="test/api/throttle-cache.spec.ts" name="Throttle Cache &gt; markThrottled &gt; should handle special characters in key" time="0.078">
        </testcase>
        <testcase classname="test/api/throttle-cache.spec.ts" name="Throttle Cache &gt; clearThrottle &gt; should clear throttle for a key" time="0.078">
        </testcase>
        <testcase classname="test/api/throttle-cache.spec.ts" name="Throttle Cache &gt; clearThrottle &gt; should not throw if clearing non-existent key" time="0.031">
        </testcase>
        <testcase classname="test/api/throttle-cache.spec.ts" name="Throttle Cache &gt; clearThrottle &gt; should clear one key without affecting others" time="0.059">
        </testcase>
        <testcase classname="test/api/throttle-cache.spec.ts" name="Throttle Cache &gt; getThrottleCacheStats &gt; should return cache statistics" time="0.051">
        </testcase>
        <testcase classname="test/api/throttle-cache.spec.ts" name="Throttle Cache &gt; getThrottleCacheStats &gt; should reflect correct number of cached keys" time="0.026">
        </testcase>
        <testcase classname="test/api/throttle-cache.spec.ts" name="Throttle Cache &gt; getThrottleCacheStats &gt; should handle empty cache" time="0.035">
        </testcase>
        <testcase classname="test/api/throttle-cache.spec.ts" name="Throttle Cache &gt; getThrottleCacheStats &gt; should increase count when marking multiple unique keys" time="0.059">
        </testcase>
        <testcase classname="test/api/throttle-cache.spec.ts" name="Throttle Cache &gt; Throttle window (5 minutes) &gt; should throttle for approximately 5 minutes" time="0.064">
        </testcase>
        <testcase classname="test/api/throttle-cache.spec.ts" name="Throttle Cache &gt; Throttle window (5 minutes) &gt; should use seconds precision (not milliseconds)" time="0.048">
        </testcase>
        <testcase classname="test/api/throttle-cache.spec.ts" name="Throttle Cache &gt; Edge cases &gt; should handle very long keys" time="0.042">
        </testcase>
        <testcase classname="test/api/throttle-cache.spec.ts" name="Throttle Cache &gt; Edge cases &gt; should handle unicode keys" time="0.06">
        </testcase>
        <testcase classname="test/api/throttle-cache.spec.ts" name="Throttle Cache &gt; Edge cases &gt; should handle concurrent marks and clears" time="0.04">
        </testcase>
    </testsuite>
    <testsuite name="test/api/user-preferences.spec.ts" timestamp="2025-12-20T12:24:18.249Z" hostname="sngvahmed" tests="3" failures="0" errors="0" skipped="0" time="0.293">
        <testcase classname="test/api/user-preferences.spec.ts" name="User Preferences API &gt; updateUserPreferences &gt; should update news favorite symbols" time="0.049">
        </testcase>
        <testcase classname="test/api/user-preferences.spec.ts" name="User Preferences API &gt; updateUserPreferences &gt; should create settings if they don&apos;t exist" time="0.069">
        </testcase>
        <testcase classname="test/api/user-preferences.spec.ts" name="User Preferences API &gt; updateUserPreferences &gt; should validate symbols array" time="0.046">
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.433Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Failed to update user preferences&quot;,&quot;type&quot;:&quot;general&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;error&quot;:{&quot;name&quot;:&quot;TypeError&quot;,&quot;message&quot;:&quot;Cannot read properties of undefined (reading &apos;bind&apos;)&quot;,&quot;stack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &apos;bind&apos;)\n    at Module.updateUserPreferences (/home/sngvahmed/workspace/stockly/api/src/api/user-preferences.ts:36:63)\n    at /home/sngvahmed/workspace/stockly/api/test/api/user-preferences.spec.ts:136:24\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20&quot;}}

            </system-err>
        </testcase>
    </testsuite>
    <testsuite name="test/api/users.spec.ts" timestamp="2025-12-20T12:24:18.249Z" hostname="sngvahmed" tests="13" failures="0" errors="0" skipped="0" time="0.501">
        <testcase classname="test/api/users.spec.ts" name="Users API &gt; getAllUsers &gt; should return all users with activity status for admin" time="0.041">
        </testcase>
        <testcase classname="test/api/users.spec.ts" name="Users API &gt; getAllUsers &gt; should deny non-admin access" time="0.031">
        </testcase>
        <testcase classname="test/api/users.spec.ts" name="Users API &gt; getAllUsers &gt; should return empty array when no users exist" time="0.046">
        </testcase>
        <testcase classname="test/api/users.spec.ts" name="Users API &gt; getAllUsers &gt; should return users with no activity" time="0.029">
        </testcase>
        <testcase classname="test/api/users.spec.ts" name="Users API &gt; getUserByUsername &gt; should return user details for admin" time="0.038">
        </testcase>
        <testcase classname="test/api/users.spec.ts" name="Users API &gt; getUserByUsername &gt; should return 404 if user not found" time="0.029">
        </testcase>
        <testcase classname="test/api/users.spec.ts" name="Users API &gt; getUserByUsername &gt; should deny non-admin access" time="0.025">
        </testcase>
        <testcase classname="test/api/users.spec.ts" name="Users API &gt; getUserDevices &gt; should return devices for a user" time="0.029">
        </testcase>
        <testcase classname="test/api/users.spec.ts" name="Users API &gt; getUserDevices &gt; should return 404 if user not found" time="0.022">
        </testcase>
        <testcase classname="test/api/users.spec.ts" name="Users API &gt; getUserAlerts &gt; should return alerts for a user" time="0.021">
        </testcase>
        <testcase classname="test/api/users.spec.ts" name="Users API &gt; getUserAlerts &gt; should return 404 if user not found" time="0.019">
        </testcase>
        <testcase classname="test/api/users.spec.ts" name="Users API &gt; getUserFavoriteStocks &gt; should return favorite stocks for a user" time="0.019">
        </testcase>
        <testcase classname="test/api/users.spec.ts" name="Users API &gt; getUserFavoriteStocks &gt; should return 404 if user not found" time="0.015">
        </testcase>
    </testsuite>
    <testsuite name="test/auth/jwt.spec.ts" timestamp="2025-12-20T12:24:18.251Z" hostname="sngvahmed" tests="13" failures="0" errors="0" skipped="0" time="0.866">
        <testcase classname="test/auth/jwt.spec.ts" name="JWT Utilities &gt; generateAccessToken &gt; should generate a valid access token" time="0.038">
        </testcase>
        <testcase classname="test/auth/jwt.spec.ts" name="JWT Utilities &gt; generateAccessToken &gt; should set custom expiration" time="0.042">
        </testcase>
        <testcase classname="test/auth/jwt.spec.ts" name="JWT Utilities &gt; generateRefreshToken &gt; should generate a valid refresh token" time="0.03">
        </testcase>
        <testcase classname="test/auth/jwt.spec.ts" name="JWT Utilities &gt; verifyToken &gt; should return payload for valid access token" time="0.047">
        </testcase>
        <testcase classname="test/auth/jwt.spec.ts" name="JWT Utilities &gt; verifyToken &gt; should return payload for valid refresh token" time="0.027">
        </testcase>
        <testcase classname="test/auth/jwt.spec.ts" name="JWT Utilities &gt; verifyToken &gt; should return null for invalid signature" time="0.034">
        </testcase>
        <testcase classname="test/auth/jwt.spec.ts" name="JWT Utilities &gt; verifyToken &gt; should return null for malformed token" time="0.051">
        </testcase>
        <testcase classname="test/auth/jwt.spec.ts" name="JWT Utilities &gt; verifyToken &gt; should return null if token payload is missing required fields" time="0.029">
        </testcase>
        <testcase classname="test/auth/jwt.spec.ts" name="JWT Utilities &gt; verifyToken &gt; should return null if token type is invalid" time="0.038">
        </testcase>
        <testcase classname="test/auth/jwt.spec.ts" name="JWT Utilities &gt; extractUsernameFromToken &gt; should extract username from valid token string" time="0.042">
        </testcase>
        <testcase classname="test/auth/jwt.spec.ts" name="JWT Utilities &gt; extractUsernameFromToken &gt; should return null for malformed token" time="0.068">
        </testcase>
        <testcase classname="test/auth/jwt.spec.ts" name="JWT Utilities &gt; extractUsernameFromToken &gt; should return null if token cannot be decoded" time="0.038">
        </testcase>
        <testcase classname="test/auth/jwt.spec.ts" name="JWT Utilities &gt; extractUserIdFromToken &gt; should extract username (alias)" time="0.042">
        </testcase>
    </testsuite>
    <testsuite name="test/auth/middleware.spec.ts" timestamp="2025-12-20T12:24:18.252Z" hostname="sngvahmed" tests="12" failures="0" errors="0" skipped="0" time="0.82">
        <testcase classname="test/auth/middleware.spec.ts" name="Auth Middleware &gt; authenticateRequest &gt; should authenticate with valid Authorization header" time="0.042">
        </testcase>
        <testcase classname="test/auth/middleware.spec.ts" name="Auth Middleware &gt; authenticateRequest &gt; should authenticate with valid access token cookie" time="0.06">
        </testcase>
        <testcase classname="test/auth/middleware.spec.ts" name="Auth Middleware &gt; authenticateRequest &gt; should fallback to refresh token in header if access token fails and refresh secret provided" time="0.035">
        </testcase>
        <testcase classname="test/auth/middleware.spec.ts" name="Auth Middleware &gt; authenticateRequest &gt; should fallback to refresh token cookie if access token cookie missing" time="0.03">
        </testcase>
        <testcase classname="test/auth/middleware.spec.ts" name="Auth Middleware &gt; authenticateRequest &gt; should return null if no tokens provided" time="0.049">
        </testcase>
        <testcase classname="test/auth/middleware.spec.ts" name="Auth Middleware &gt; authenticateRequest &gt; should return null for invalid token" time="0.033">
        </testcase>
        <testcase classname="test/auth/middleware.spec.ts" name="Auth Middleware &gt; isAdmin &gt; should return true for admin username" time="0.035">
        </testcase>
        <testcase classname="test/auth/middleware.spec.ts" name="Auth Middleware &gt; isAdmin &gt; should return false for other usernames" time="0.038">
        </testcase>
        <testcase classname="test/auth/middleware.spec.ts" name="Auth Middleware &gt; authenticateRequestWithAdmin &gt; should return admin status true for admin user" time="0.042">
        </testcase>
        <testcase classname="test/auth/middleware.spec.ts" name="Auth Middleware &gt; authenticateRequestWithAdmin &gt; should return admin status false for normal user" time="0.06">
        </testcase>
        <testcase classname="test/auth/middleware.spec.ts" name="Auth Middleware &gt; Cookie Helpers &gt; setHttpOnlyCookie should add Set-Cookie header" time="0.065">
        </testcase>
        <testcase classname="test/auth/middleware.spec.ts" name="Auth Middleware &gt; Cookie Helpers &gt; clearHttpOnlyCookie should set immediate expiration" time="0.038">
        </testcase>
    </testsuite>
    <testsuite name="test/auth/username-validation.spec.ts" timestamp="2025-12-20T12:24:18.253Z" hostname="sngvahmed" tests="15" failures="0" errors="0" skipped="0" time="1.006">
        <testcase classname="test/auth/username-validation.spec.ts" name="Username Validation &gt; validateUsernameFormat &gt; accepts valid usernames" time="0.033">
        </testcase>
        <testcase classname="test/auth/username-validation.spec.ts" name="Username Validation &gt; validateUsernameFormat &gt; rejects too short usernames (&lt; 3)" time="0.032">
        </testcase>
        <testcase classname="test/auth/username-validation.spec.ts" name="Username Validation &gt; validateUsernameFormat &gt; rejects too long usernames (&gt; 20)" time="0.078">
        </testcase>
        <testcase classname="test/auth/username-validation.spec.ts" name="Username Validation &gt; validateUsernameFormat &gt; rejects usernames starting with special char" time="0.037">
        </testcase>
        <testcase classname="test/auth/username-validation.spec.ts" name="Username Validation &gt; validateUsernameFormat &gt; rejects usernames ending with special char" time="0.06">
        </testcase>
        <testcase classname="test/auth/username-validation.spec.ts" name="Username Validation &gt; validateUsernameFormat &gt; rejects consecutive underscores" time="0.033">
        </testcase>
        <testcase classname="test/auth/username-validation.spec.ts" name="Username Validation &gt; validateUsernameFormat &gt; rejects consecutive hyphens" time="0.081">
        </testcase>
        <testcase classname="test/auth/username-validation.spec.ts" name="Username Validation &gt; validateUsernameFormat &gt; rejects mixed consecutive special chars" time="0.044">
        </testcase>
        <testcase classname="test/auth/username-validation.spec.ts" name="Username Validation &gt; validateUsernameFormat &gt; rejects invalid characters" time="0.067">
        </testcase>
        <testcase classname="test/auth/username-validation.spec.ts" name="Username Validation &gt; isReservedWord &gt; identifies reserved words (case insensitive)" time="0.041">
        </testcase>
        <testcase classname="test/auth/username-validation.spec.ts" name="Username Validation &gt; isReservedWord &gt; allows non-reserved words" time="0.035">
        </testcase>
        <testcase classname="test/auth/username-validation.spec.ts" name="Username Validation &gt; normalizeUsername &gt; lowercases and trims" time="0.024">
        </testcase>
        <testcase classname="test/auth/username-validation.spec.ts" name="Username Validation &gt; validateUsername (Comprehensive) &gt; returns valid for good username" time="0.033">
        </testcase>
        <testcase classname="test/auth/username-validation.spec.ts" name="Username Validation &gt; validateUsername (Comprehensive) &gt; returns error for reserved word" time="0.047">
        </testcase>
        <testcase classname="test/auth/username-validation.spec.ts" name="Username Validation &gt; validateUsername (Comprehensive) &gt; returns error for invalid format" time="0.03">
        </testcase>
    </testsuite>
    <testsuite name="test/contract/openapi-validation.spec.ts" timestamp="2025-12-20T12:24:18.255Z" hostname="sngvahmed" tests="6" failures="0" errors="0" skipped="0" time="0.499">
        <testcase classname="test/contract/openapi-validation.spec.ts" name="OpenAPI Contract Validation &gt; Schema Validation &gt; should validate get-stock response matches OpenAPI schema" time="0.038">
        </testcase>
        <testcase classname="test/contract/openapi-validation.spec.ts" name="OpenAPI Contract Validation &gt; Schema Validation &gt; should validate get-stocks response matches OpenAPI schema" time="0.027">
        </testcase>
        <testcase classname="test/contract/openapi-validation.spec.ts" name="OpenAPI Contract Validation &gt; Schema Validation &gt; should validate error responses match OpenAPI schema" time="0.072">
        </testcase>
        <testcase classname="test/contract/openapi-validation.spec.ts" name="OpenAPI Contract Validation &gt; Endpoint Coverage &gt; should have all endpoints documented in OpenAPI spec" time="0.074">
        </testcase>
        <testcase classname="test/contract/openapi-validation.spec.ts" name="OpenAPI Contract Validation &gt; Request/Response Validation &gt; should validate request parameters match OpenAPI spec" time="0.068">
        </testcase>
        <testcase classname="test/contract/openapi-validation.spec.ts" name="OpenAPI Contract Validation &gt; Request/Response Validation &gt; should validate response structure matches OpenAPI spec" time="0.031">
        </testcase>
    </testsuite>
    <testsuite name="test/cron/alerts-cron.spec.ts" timestamp="2025-12-20T12:24:18.256Z" hostname="sngvahmed" tests="15" failures="0" errors="0" skipped="0" time="0.973">
        <testcase classname="test/cron/alerts-cron.spec.ts" name="Alert Cron Job &gt; runAlertCron &gt; should skip cron if alertsKv is not configured" time="0.029">
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.042Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;cron-1766233446042&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Alerts KV is not configured; skipping cron&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-err>
        </testcase>
        <testcase classname="test/cron/alerts-cron.spec.ts" name="Alert Cron Job &gt; runAlertCron &gt; should skip cron if no active alerts found" time="0.027">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.067Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446067&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Starting alert evaluation cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.067Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446067&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;No active alerts found&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/cron/alerts-cron.spec.ts" name="Alert Cron Job &gt; runAlertCron &gt; should process alerts and send notifications" time="0.066">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.127Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446127&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Starting alert evaluation cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.127Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446127&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Processing 1 active alerts&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.127Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;cron-1766233446127&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Fetching prices for 1 unique symbols&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbols&quot;:[&quot;AAPL&quot;]}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.127Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446127&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Successfully fetched prices for 1 symbols&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.127Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446127&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Evaluated 1 alerts, 1 triggered&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.127Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446127&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Alert triggered&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertId&quot;:&quot;alert-1&quot;,&quot;symbol&quot;:&quot;AAPL&quot;,&quot;price&quot;:205,&quot;direction&quot;:&quot;above&quot;,&quot;threshold&quot;:200,&quot;channel&quot;:&quot;notification&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.128Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446127&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;FCM notification sent successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertId&quot;:&quot;alert-1&quot;,&quot;symbol&quot;:&quot;AAPL&quot;,&quot;pushToken&quot;:&quot;fcm-token-123&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.128Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446127&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Alert notification sent to all user devices&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertId&quot;:&quot;alert-1&quot;,&quot;symbol&quot;:&quot;AAPL&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;devicesCount&quot;:1,&quot;successCount&quot;:1,&quot;failCount&quot;:0}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.128Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446127&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Alert cron job completed successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertsProcessed&quot;:1,&quot;notificationsSent&quot;:1}

            </system-out>
        </testcase>
        <testcase classname="test/cron/alerts-cron.spec.ts" name="Alert Cron Job &gt; runAlertCron &gt; should handle fetch price failures gracefully" time="0.033">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.163Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446163&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Starting alert evaluation cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.163Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446163&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Processing 1 active alerts&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.163Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;cron-1766233446163&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Fetching prices for 1 unique symbols&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbols&quot;:[&quot;AAPL&quot;]}

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.164Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;cron-1766233446163&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Failed to fetch quote for alert&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbol&quot;:&quot;AAPL&quot;,&quot;error&quot;:{&quot;name&quot;:&quot;Error&quot;,&quot;message&quot;:&quot;Network error&quot;,&quot;stack&quot;:&quot;Error: Network error\n    at /home/sngvahmed/workspace/stockly/api/test/cron/alerts-cron.spec.ts:199:49\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (&lt;anonymous&gt;)\n    at runWithTimeout (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)&quot;}}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.167Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;cron-1766233446163&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;No prices available for alerts run&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbols&quot;:[&quot;AAPL&quot;]}

            </system-err>
        </testcase>
        <testcase classname="test/cron/alerts-cron.spec.ts" name="Alert Cron Job &gt; runAlertCron &gt; should skip alert with old Expo token" time="0.146">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.201Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446201&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Starting alert evaluation cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.201Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446201&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Processing 1 active alerts&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.201Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;cron-1766233446201&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Fetching prices for 1 unique symbols&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbols&quot;:[&quot;AAPL&quot;]}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.201Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446201&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Successfully fetched prices for 1 symbols&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.201Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446201&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Evaluated 1 alerts, 1 triggered&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.201Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446201&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Alert triggered&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertId&quot;:&quot;alert-1&quot;,&quot;symbol&quot;:&quot;AAPL&quot;,&quot;price&quot;:205,&quot;direction&quot;:&quot;above&quot;,&quot;threshold&quot;:200,&quot;channel&quot;:&quot;notification&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.202Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446201&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Alert notification sent to all user devices&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertId&quot;:&quot;alert-1&quot;,&quot;symbol&quot;:&quot;AAPL&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;devicesCount&quot;:1,&quot;successCount&quot;:0,&quot;failCount&quot;:1}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.202Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446201&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Alert cron job completed successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertsProcessed&quot;:1,&quot;notificationsSent&quot;:1}

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.202Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;cron-1766233446201&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Skipping alert with old Expo token - FCM migration required&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertId&quot;:&quot;alert-1&quot;,&quot;symbol&quot;:&quot;AAPL&quot;,&quot;pushToken&quot;:&quot;ExponentPushToken[123]&quot;}

            </system-err>
        </testcase>
        <testcase classname="test/cron/alerts-cron.spec.ts" name="Alert Cron Job &gt; runAlertCron &gt; should log failed FCM notifications" time="0.13">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.403Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446403&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Starting alert evaluation cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.403Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446403&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Processing 1 active alerts&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.403Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;cron-1766233446403&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Fetching prices for 1 unique symbols&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbols&quot;:[&quot;AAPL&quot;]}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.404Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446403&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Successfully fetched prices for 1 symbols&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.404Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446403&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Evaluated 1 alerts, 1 triggered&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.404Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446403&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Alert triggered&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertId&quot;:&quot;alert-1&quot;,&quot;symbol&quot;:&quot;AAPL&quot;,&quot;price&quot;:205,&quot;direction&quot;:&quot;above&quot;,&quot;threshold&quot;:200,&quot;channel&quot;:&quot;notification&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.405Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446403&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Alert notification sent to all user devices&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertId&quot;:&quot;alert-1&quot;,&quot;symbol&quot;:&quot;AAPL&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;devicesCount&quot;:1,&quot;successCount&quot;:0,&quot;failCount&quot;:1}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.405Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446403&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Alert cron job completed successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertsProcessed&quot;:1,&quot;notificationsSent&quot;:1}

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.404Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;cron-1766233446403&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Failed to send FCM notification&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertId&quot;:&quot;alert-1&quot;,&quot;symbol&quot;:&quot;AAPL&quot;,&quot;pushToken&quot;:&quot;fcm-token-123&quot;,&quot;error&quot;:{&quot;name&quot;:&quot;Error&quot;,&quot;message&quot;:&quot;FCM send returned false&quot;,&quot;stack&quot;:&quot;Error: FCM send returned false\n    at Module.runAlertCron (/home/sngvahmed/workspace/stockly/api/src/cron/alerts-cron.ts:204:63)\n    at /home/sngvahmed/workspace/stockly/api/test/cron/alerts-cron.spec.ts:309:7\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20&quot;}}

            </system-err>
        </testcase>
        <testcase classname="test/cron/alerts-cron.spec.ts" name="Alert Cron Job &gt; runAlertCron &gt; should handle FCM notification errors" time="0.032">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.474Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446474&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Starting alert evaluation cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.474Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446474&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Processing 1 active alerts&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.474Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;cron-1766233446474&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Fetching prices for 1 unique symbols&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbols&quot;:[&quot;AAPL&quot;]}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.474Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446474&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Successfully fetched prices for 1 symbols&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.474Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446474&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Evaluated 1 alerts, 1 triggered&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.474Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446474&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Alert triggered&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertId&quot;:&quot;alert-1&quot;,&quot;symbol&quot;:&quot;AAPL&quot;,&quot;price&quot;:205,&quot;direction&quot;:&quot;above&quot;,&quot;threshold&quot;:200,&quot;channel&quot;:&quot;notification&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.474Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446474&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Alert notification sent to all user devices&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertId&quot;:&quot;alert-1&quot;,&quot;symbol&quot;:&quot;AAPL&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;devicesCount&quot;:1,&quot;successCount&quot;:0,&quot;failCount&quot;:1}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.474Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446474&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Alert cron job completed successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertsProcessed&quot;:1,&quot;notificationsSent&quot;:1}

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.474Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;cron-1766233446474&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Error sending FCM notification&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertId&quot;:&quot;alert-1&quot;,&quot;symbol&quot;:&quot;AAPL&quot;,&quot;pushToken&quot;:&quot;fcm-token-123&quot;,&quot;error&quot;:{&quot;name&quot;:&quot;Error&quot;,&quot;message&quot;:&quot;FCM send failed&quot;,&quot;stack&quot;:&quot;Error: FCM send failed\n    at /home/sngvahmed/workspace/stockly/api/test/cron/alerts-cron.spec.ts:343:9\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (&lt;anonymous&gt;)\n    at runWithTimeout (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)&quot;}}

            </system-err>
        </testcase>
        <testcase classname="test/cron/alerts-cron.spec.ts" name="Alert Cron Job &gt; runAlertCron &gt; should handle multiple alerts" time="0.116">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.507Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446507&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Starting alert evaluation cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.507Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446507&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Processing 2 active alerts&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.507Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;cron-1766233446507&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Fetching prices for 2 unique symbols&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbols&quot;:[&quot;AAPL&quot;,&quot;MSFT&quot;]}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.507Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446507&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Successfully fetched prices for 2 symbols&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.507Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446507&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Evaluated 2 alerts, 2 triggered&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.507Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446507&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Alert triggered&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertId&quot;:&quot;alert-1&quot;,&quot;symbol&quot;:&quot;AAPL&quot;,&quot;price&quot;:205,&quot;direction&quot;:&quot;above&quot;,&quot;threshold&quot;:200,&quot;channel&quot;:&quot;notification&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.508Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446507&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;FCM notification sent successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertId&quot;:&quot;alert-1&quot;,&quot;symbol&quot;:&quot;AAPL&quot;,&quot;pushToken&quot;:&quot;fcm-token-123&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.508Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446507&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Alert notification sent to all user devices&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertId&quot;:&quot;alert-1&quot;,&quot;symbol&quot;:&quot;AAPL&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;devicesCount&quot;:1,&quot;successCount&quot;:1,&quot;failCount&quot;:0}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.508Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446507&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Alert triggered&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertId&quot;:&quot;alert-2&quot;,&quot;symbol&quot;:&quot;MSFT&quot;,&quot;price&quot;:310,&quot;direction&quot;:&quot;above&quot;,&quot;threshold&quot;:300,&quot;channel&quot;:&quot;notification&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.508Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446507&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;FCM notification sent successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertId&quot;:&quot;alert-2&quot;,&quot;symbol&quot;:&quot;MSFT&quot;,&quot;pushToken&quot;:&quot;fcm-token-123&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.508Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446507&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Alert notification sent to all user devices&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertId&quot;:&quot;alert-2&quot;,&quot;symbol&quot;:&quot;MSFT&quot;,&quot;username&quot;:&quot;testuser&quot;,&quot;devicesCount&quot;:1,&quot;successCount&quot;:1,&quot;failCount&quot;:0}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.508Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446507&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Alert cron job completed successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertsProcessed&quot;:2,&quot;notificationsSent&quot;:2}

            </system-out>
        </testcase>
        <testcase classname="test/cron/alerts-cron.spec.ts" name="Alert Cron Job &gt; runAlertCron &gt; should skip when no prices available" time="0.093">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.682Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446682&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Starting alert evaluation cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.682Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446682&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Processing 1 active alerts&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.682Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;cron-1766233446682&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Fetching prices for 1 unique symbols&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbols&quot;:[&quot;AAPL&quot;]}

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.682Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;cron-1766233446682&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;No prices available for alerts run&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbols&quot;:[&quot;AAPL&quot;]}

            </system-err>
        </testcase>
        <testcase classname="test/cron/alerts-cron.spec.ts" name="Alert Cron Job &gt; runAlertCron &gt; should flush pending KV writes" time="0.049">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.715Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446715&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Starting alert evaluation cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.715Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446715&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Processing 1 active alerts&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.715Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;cron-1766233446715&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Fetching prices for 1 unique symbols&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbols&quot;:[&quot;AAPL&quot;]}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.715Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446715&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Successfully fetched prices for 1 symbols&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.715Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446715&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Evaluated 1 alerts, 0 triggered&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.715Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446715&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Alert cron job completed successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertsProcessed&quot;:1,&quot;notificationsSent&quot;:0}

            </system-out>
        </testcase>
        <testcase classname="test/cron/alerts-cron.spec.ts" name="Alert Cron Job &gt; runAlertCron &gt; should send logs to Loki if configured" time="0.033">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.763Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446763&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Starting alert evaluation cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.763Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446763&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Processing 1 active alerts&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.763Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;cron-1766233446763&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Fetching prices for 1 unique symbols&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbols&quot;:[&quot;AAPL&quot;]}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.763Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446763&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Successfully fetched prices for 1 symbols&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.763Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446763&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Evaluated 1 alerts, 0 triggered&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.763Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446763&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Alert cron job completed successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertsProcessed&quot;:1,&quot;notificationsSent&quot;:0}

            </system-out>
        </testcase>
        <testcase classname="test/cron/alerts-cron.spec.ts" name="Alert Cron Job &gt; runAlertCron &gt; should not send logs to Loki if not configured" time="0.027">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.794Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446794&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Starting alert evaluation cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.794Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446794&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Processing 1 active alerts&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.794Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;cron-1766233446794&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Fetching prices for 1 unique symbols&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbols&quot;:[&quot;AAPL&quot;]}

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.795Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;cron-1766233446794&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;No prices available for alerts run&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbols&quot;:[&quot;AAPL&quot;]}

            </system-err>
        </testcase>
        <testcase classname="test/cron/alerts-cron.spec.ts" name="Alert Cron Job &gt; runAlertCron &gt; should handle fatal errors and re-throw" time="0.035">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.832Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446832&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Starting alert evaluation cron job&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.832Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;cron-1766233446832&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Fatal error in alert cron job&quot;,&quot;type&quot;:&quot;general&quot;,&quot;error&quot;:{&quot;name&quot;:&quot;Error&quot;,&quot;message&quot;:&quot;Fatal error&quot;,&quot;stack&quot;:&quot;Error: Fatal error\n    at /home/sngvahmed/workspace/stockly/api/test/cron/alerts-cron.spec.ts:530:21\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (&lt;anonymous&gt;)\n    at runWithTimeout (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)&quot;}}

            </system-err>
        </testcase>
        <testcase classname="test/cron/alerts-cron.spec.ts" name="Alert Cron Job &gt; runAlertCron &gt; should use default KV write interval if not in config" time="0.028">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.856Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446856&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Starting alert evaluation cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.856Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446856&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Processing 1 active alerts&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.856Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;cron-1766233446856&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Fetching prices for 1 unique symbols&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbols&quot;:[&quot;AAPL&quot;]}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.857Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446856&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Successfully fetched prices for 1 symbols&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.857Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446856&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Evaluated 1 alerts, 0 triggered&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.857Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446856&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Alert cron job completed successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertsProcessed&quot;:1,&quot;notificationsSent&quot;:0}

            </system-out>
        </testcase>
        <testcase classname="test/cron/alerts-cron.spec.ts" name="Alert Cron Job &gt; runAlertCron &gt; should handle array response from quote API" time="0.026">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.883Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446883&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Starting alert evaluation cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.884Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446883&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Processing 1 active alerts&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.884Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;cron-1766233446883&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Fetching prices for 1 unique symbols&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbols&quot;:[&quot;AAPL&quot;]}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.884Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446883&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Successfully fetched prices for 1 symbols&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.884Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446883&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Evaluated 1 alerts, 0 triggered&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.884Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-1766233446883&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/alerts&quot;,&quot;message&quot;:&quot;Alert cron job completed successfully&quot;,&quot;type&quot;:&quot;general&quot;,&quot;alertsProcessed&quot;:1,&quot;notificationsSent&quot;:0}

            </system-out>
        </testcase>
    </testsuite>
    <testsuite name="test/cron/news-alert-cron.spec.ts" timestamp="2025-12-20T12:24:18.260Z" hostname="sngvahmed" tests="18" failures="0" errors="0" skipped="0" time="1.639">
        <testcase classname="test/cron/news-alert-cron.spec.ts" name="News Alert Cron Job &gt; User Symbol Collection &gt; should collect unique symbols from all users" time="0.045">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.532Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445532&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Starting news alert cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.533Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445532&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Checking news for 4 unique symbols: LXEO, AMZN, AAPL, BABA&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.533Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445532&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Fetching news for all symbols published today (2025-12-20)&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.534Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445532&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Fetched 0 news articles published today&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.534Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445532&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Found news for 0 symbols: &quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.534Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445532&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;News alert cron job completed&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/cron/news-alert-cron.spec.ts" name="News Alert Cron Job &gt; User Symbol Collection &gt; should normalize symbols to uppercase" time="0.127">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.659Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445659&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Starting news alert cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.659Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445659&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Checking news for 2 unique symbols: LXEO, AMZN&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.659Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445659&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Fetching news for all symbols published today (2025-12-20)&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.659Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445659&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Fetched 0 news articles published today&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.659Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445659&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Found news for 0 symbols: &quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.659Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445659&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;News alert cron job completed&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/cron/news-alert-cron.spec.ts" name="News Alert Cron Job &gt; User Symbol Collection &gt; should skip users with no favorite symbols" time="0.108">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.768Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445768&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Starting news alert cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.769Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445768&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Checking news for 1 unique symbols: LXEO&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.769Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445768&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Fetching news for all symbols published today (2025-12-20)&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.769Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445768&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Fetched 0 news articles published today&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.769Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445768&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Found news for 0 symbols: &quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.769Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445768&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;News alert cron job completed&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/cron/news-alert-cron.spec.ts" name="News Alert Cron Job &gt; News Fetching and Filtering &gt; should fetch news for all symbols in one batch call" time="0.06">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.950Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445950&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Starting news alert cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.950Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445950&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Checking news for 3 unique symbols: LXEO, AMZN, AAPL&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.950Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445950&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Fetching news for all symbols published today (2025-12-20)&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.950Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445950&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Fetched 2 news articles published today&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.950Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445950&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Found news for 2 symbols: LXEO, AMZN&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.951Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445950&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;New article found (published today)&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbol&quot;:&quot;LXEO&quot;,&quot;title&quot;:&quot;LXEO News Today&quot;,&quot;publishedDate&quot;:&quot;2025-12-20T10:00:00Z&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.951Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445950&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Found 1 users with LXEO in favorites: user1&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.951Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445950&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Sent 2 notifications for LXEO news to 1 users&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.951Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445950&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;New article found (published today)&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbol&quot;:&quot;AMZN&quot;,&quot;title&quot;:&quot;AMZN News Today&quot;,&quot;publishedDate&quot;:&quot;2025-12-20T11:00:00Z&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.951Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445950&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Found 1 users with AMZN in favorites: user1&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.951Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445950&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Sent 2 notifications for AMZN news to 1 users&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.951Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445950&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;News alert cron job completed&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/cron/news-alert-cron.spec.ts" name="News Alert Cron Job &gt; News Fetching and Filtering &gt; should only process news published today" time="0.032">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.977Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445977&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Starting news alert cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.977Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445977&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Checking news for 1 unique symbols: LXEO&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.978Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445977&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Fetching news for all symbols published today (2025-12-20)&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.978Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445977&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Fetched 2 news articles published today&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.978Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445977&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Found news for 1 symbols: LXEO&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.978Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445977&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;New article found (published today)&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbol&quot;:&quot;LXEO&quot;,&quot;title&quot;:&quot;LXEO News Today&quot;,&quot;publishedDate&quot;:&quot;2025-12-20T10:00:00Z&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.978Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445977&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Found 1 users with LXEO in favorites: user1&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.978Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445977&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Sent 1 notifications for LXEO news to 1 users&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.978Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445977&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Skipping article not published today: LXEO News Yesterday (2025-12-19T10:00:00Z)&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.978Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233445977&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;News alert cron job completed&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/cron/news-alert-cron.spec.ts" name="News Alert Cron Job &gt; News Fetching and Filtering &gt; should handle empty news response" time="0.035">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.011Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446011&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Starting news alert cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.011Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446011&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Checking news for 1 unique symbols: LXEO&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.011Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446011&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Fetching news for all symbols published today (2025-12-20)&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.012Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446011&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Fetched 0 news articles published today&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.012Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446011&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Found news for 0 symbols: &quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.012Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446011&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;News alert cron job completed&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/cron/news-alert-cron.spec.ts" name="News Alert Cron Job &gt; Deduplication &gt; should not send duplicate notifications for the same article" time="0.075">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.318Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446318&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Starting news alert cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.318Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446318&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Checking news for 1 unique symbols: LXEO&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.318Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446318&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Fetching news for all symbols published today (2025-12-20)&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.318Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446318&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Fetched 1 news articles published today&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.318Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446318&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Found news for 1 symbols: LXEO&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.319Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446318&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;New article found (published today)&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbol&quot;:&quot;LXEO&quot;,&quot;title&quot;:&quot;LXEO News Today&quot;,&quot;publishedDate&quot;:&quot;2025-12-20T10:00:00Z&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.319Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446318&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Found 1 users with LXEO in favorites: user1&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.319Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446318&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Sent 1 notifications for LXEO news to 1 users&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.319Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446318&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;News alert cron job completed&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.319Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446319&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Starting news alert cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.320Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446319&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;No favorite symbols found to check for news&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.319Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446319&quot;,&quot;userId&quot;:&quot;user1&quot;,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Failed to parse news_favorite_symbols&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-err>
        </testcase>
        <testcase classname="test/cron/news-alert-cron.spec.ts" name="News Alert Cron Job &gt; Deduplication &gt; should mark articles as seen in KV after sending notification" time="0.034">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.363Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446363&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Starting news alert cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.364Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446363&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Checking news for 1 unique symbols: LXEO&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.364Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446363&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Fetching news for all symbols published today (2025-12-20)&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.364Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446363&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Fetched 1 news articles published today&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.364Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446363&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Found news for 1 symbols: LXEO&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.364Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446363&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;New article found (published today)&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbol&quot;:&quot;LXEO&quot;,&quot;title&quot;:&quot;LXEO News Today&quot;,&quot;publishedDate&quot;:&quot;2025-12-20T10:00:00Z&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.364Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446363&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Found 1 users with LXEO in favorites: user1&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.364Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446363&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Sent 1 notifications for LXEO news to 1 users&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.364Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446363&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;News alert cron job completed&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/cron/news-alert-cron.spec.ts" name="News Alert Cron Job &gt; Notification Sending &gt; should send notifications to all users who have the symbol in favorites" time="0.041">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.588Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446588&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Starting news alert cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.589Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446588&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Checking news for 4 unique symbols: LXEO, AMZN, AAPL, BABA&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.589Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446588&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Fetching news for all symbols published today (2025-12-20)&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.589Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446588&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Fetched 1 news articles published today&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.589Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446588&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Found news for 1 symbols: LXEO&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.589Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446588&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;New article found (published today)&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbol&quot;:&quot;LXEO&quot;,&quot;title&quot;:&quot;LXEO News Today&quot;,&quot;publishedDate&quot;:&quot;2025-12-20T10:00:00Z&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.589Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446588&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Found 2 users with LXEO in favorites: user1, user3&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.589Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446588&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Sent 2 notifications for LXEO news to 2 users&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.589Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446588&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;News alert cron job completed&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/cron/news-alert-cron.spec.ts" name="News Alert Cron Job &gt; Notification Sending &gt; should send separate notifications for different symbols" time="0.08">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.677Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446677&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Starting news alert cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.677Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446677&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Checking news for 2 unique symbols: LXEO, AMZN&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.677Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446677&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Fetching news for all symbols published today (2025-12-20)&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.677Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446677&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Fetched 2 news articles published today&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.677Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446677&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Found news for 2 symbols: LXEO, AMZN&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.677Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446677&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;New article found (published today)&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbol&quot;:&quot;LXEO&quot;,&quot;title&quot;:&quot;LXEO News Today&quot;,&quot;publishedDate&quot;:&quot;2025-12-20T10:00:00Z&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.677Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446677&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Found 1 users with LXEO in favorites: user1&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.677Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446677&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Sent 2 notifications for LXEO news to 1 users&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.677Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446677&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;New article found (published today)&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbol&quot;:&quot;AMZN&quot;,&quot;title&quot;:&quot;AMZN News Today&quot;,&quot;publishedDate&quot;:&quot;2025-12-20T11:00:00Z&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.678Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446677&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Found 2 users with AMZN in favorites: user1, user2&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.678Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446677&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Sent 2 notifications for AMZN news to 2 users&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.678Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446677&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;News alert cron job completed&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/cron/news-alert-cron.spec.ts" name="News Alert Cron Job &gt; Notification Sending &gt; should not send notifications if user has no push token" time="0.04">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.710Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446710&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Starting news alert cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.710Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446710&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Checking news for 1 unique symbols: LXEO&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.710Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446710&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Fetching news for all symbols published today (2025-12-20)&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.710Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446710&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Fetched 1 news articles published today&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.710Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446710&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Found news for 1 symbols: LXEO&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.710Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446710&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;New article found (published today)&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbol&quot;:&quot;LXEO&quot;,&quot;title&quot;:&quot;LXEO News Today&quot;,&quot;publishedDate&quot;:&quot;2025-12-20T10:00:00Z&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.710Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446710&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Found 1 users with LXEO in favorites: user1&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.710Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446710&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Sent 0 notifications for LXEO news to 1 users&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.710Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446710&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;News alert cron job completed&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/cron/news-alert-cron.spec.ts" name="News Alert Cron Job &gt; Error Handling &gt; should handle API fetch errors gracefully" time="0.028">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.827Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446827&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Starting news alert cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.827Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446827&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Checking news for 1 unique symbols: LXEO&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.828Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446827&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Fetching news for all symbols published today (2025-12-20)&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.828Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446827&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Failed to fetch news for symbols&quot;,&quot;type&quot;:&quot;general&quot;,&quot;status&quot;:500,&quot;symbols&quot;:&quot;LXEO&quot;}

            </system-err>
        </testcase>
        <testcase classname="test/cron/news-alert-cron.spec.ts" name="News Alert Cron Job &gt; Error Handling &gt; should handle network errors gracefully" time="0.037">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.860Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446860&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Starting news alert cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.860Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446860&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Checking news for 1 unique symbols: LXEO&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.860Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446860&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Fetching news for all symbols published today (2025-12-20)&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.863Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446860&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;News alert cron job completed&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.860Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446860&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Failed to fetch news from FMP API&quot;,&quot;type&quot;:&quot;general&quot;,&quot;error&quot;:{&quot;name&quot;:&quot;Error&quot;,&quot;message&quot;:&quot;Network error&quot;,&quot;stack&quot;:&quot;Error: Network error\n    at /home/sngvahmed/workspace/stockly/api/test/cron/news-alert-cron.spec.ts:641:47\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (&lt;anonymous&gt;)\n    at runWithTimeout (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)&quot;}}

            </system-err>
        </testcase>
        <testcase classname="test/cron/news-alert-cron.spec.ts" name="News Alert Cron Job &gt; Error Handling &gt; should skip users with invalid favorite symbols JSON" time="0.027">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.890Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446890&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Starting news alert cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.891Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446890&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Checking news for 1 unique symbols: LXEO&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.891Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446890&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Fetching news for all symbols published today (2025-12-20)&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.891Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446890&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Fetched 0 news articles published today&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.891Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446890&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Found news for 0 symbols: &quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.891Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446890&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;News alert cron job completed&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.891Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446890&quot;,&quot;userId&quot;:&quot;user2&quot;,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Failed to parse news_favorite_symbols&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-err>
        </testcase>
        <testcase classname="test/cron/news-alert-cron.spec.ts" name="News Alert Cron Job &gt; Edge Cases &gt; should handle no users with favorite symbols" time="0.024">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.943Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446943&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Starting news alert cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.943Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446943&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;No favorite symbols found to check for news&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/cron/news-alert-cron.spec.ts" name="News Alert Cron Job &gt; Edge Cases &gt; should handle missing alertsKv gracefully" time="0.023">
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.966Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;cron-news-1766233446966&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Alerts KV is not configured; skipping news alert cron&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-err>
        </testcase>
        <testcase classname="test/cron/news-alert-cron.spec.ts" name="News Alert Cron Job &gt; Complete Use Case Flow &gt; should handle the complete use case: 3 PM check with multiple users and symbols" time="0.023">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.010Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233447010&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Starting news alert cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.011Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233447010&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Checking news for 4 unique symbols: LXEO, AMZN, AAPL, BABA&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.011Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233447010&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Fetching news for all symbols published today (2025-12-20)&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.011Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233447010&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Fetched 2 news articles published today&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.011Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233447010&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Found news for 2 symbols: LXEO, AMZN&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.011Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233447010&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;New article found (published today)&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbol&quot;:&quot;LXEO&quot;,&quot;title&quot;:&quot;LXEO News Today&quot;,&quot;publishedDate&quot;:&quot;2025-12-20T10:00:00Z&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.011Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233447010&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Found 2 users with LXEO in favorites: user1, user3&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.012Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233447010&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Sent 3 notifications for LXEO news to 2 users&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.012Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233447010&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;New article found (published today)&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbol&quot;:&quot;AMZN&quot;,&quot;title&quot;:&quot;AMZN News Today&quot;,&quot;publishedDate&quot;:&quot;2025-12-20T11:00:00Z&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.012Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233447010&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Found 2 users with AMZN in favorites: user1, user2&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.012Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233447010&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Sent 3 notifications for AMZN news to 2 users&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.012Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233447010&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;News alert cron job completed&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/cron/news-alert-cron.spec.ts" name="News Alert Cron Job &gt; Complete Use Case Flow &gt; should handle 7 PM check: no duplicate notifications for same articles" time="0.019">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.034Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233447034&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Starting news alert cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.034Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233447034&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Checking news for 1 unique symbols: LXEO&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.034Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233447034&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Fetching news for all symbols published today (2025-12-20)&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.034Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233447034&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Fetched 1 news articles published today&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.034Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233447034&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Found news for 1 symbols: LXEO&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.034Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233447034&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;New article found (published today)&quot;,&quot;type&quot;:&quot;general&quot;,&quot;symbol&quot;:&quot;LXEO&quot;,&quot;title&quot;:&quot;LXEO News Today&quot;,&quot;publishedDate&quot;:&quot;2025-12-20T10:00:00Z&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.034Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233447034&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Found 1 users with LXEO in favorites: user1&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.034Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233447034&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Sent 1 notifications for LXEO news to 1 users&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.034Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233447034&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;News alert cron job completed&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.034Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233447034&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Starting news alert cron job&quot;,&quot;type&quot;:&quot;general&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.034Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;cron-news-1766233447034&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;No favorite symbols found to check for news&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-out>
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.034Z&quot;,&quot;service&quot;:&quot;stockly-api&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;cron-news-1766233447034&quot;,&quot;userId&quot;:&quot;user1&quot;,&quot;path&quot;:&quot;/cron/news-alerts&quot;,&quot;message&quot;:&quot;Failed to parse news_favorite_symbols&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-err>
        </testcase>
    </testsuite>
    <testsuite name="test/integration/alerts-flow.spec.ts" timestamp="2025-12-20T12:24:18.268Z" hostname="sngvahmed" tests="2" failures="0" errors="0" skipped="0" time="0.203">
        <testcase classname="test/integration/alerts-flow.spec.ts" name="Alerts Flow Integration &gt; Alert Creation to Notification Flow &gt; should complete flow: create alert -&gt; evaluate -&gt; send notification" time="0.028">
        </testcase>
        <testcase classname="test/integration/alerts-flow.spec.ts" name="Alerts Flow Integration &gt; Alert State Management &gt; should maintain alert state across evaluations" time="0.059">
        </testcase>
    </testsuite>
    <testsuite name="test/integration/auth-flow.spec.ts" timestamp="2025-12-20T12:24:18.268Z" hostname="sngvahmed" tests="2" failures="0" errors="0" skipped="0" time="0.202">
        <testcase classname="test/integration/auth-flow.spec.ts" name="Authentication Flow Integration &gt; Complete User Onboarding Flow &gt; should complete full flow: Google auth -&gt; username check -&gt; username set -&gt; get user" time="0.025">
        </testcase>
        <testcase classname="test/integration/auth-flow.spec.ts" name="Authentication Flow Integration &gt; Token Refresh Flow &gt; should refresh token and maintain session" time="0.06">
        </testcase>
    </testsuite>
    <testsuite name="test/integration/stock-flow.spec.ts" timestamp="2025-12-20T12:24:18.269Z" hostname="sngvahmed" tests="3" failures="0" errors="0" skipped="0" time="0.205">
        <testcase classname="test/integration/stock-flow.spec.ts" name="Stock Data Flow Integration &gt; Stock Search to Details Flow &gt; should complete flow: search -&gt; get stock -&gt; get details" time="0.035">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.817Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;No cache for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;cacheStatus&quot;:&quot;MISS&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.819Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /quote&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/quote&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;latencyMs&quot;:1}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.819Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FMP API: GET /profile&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/profile&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;latencyMs&quot;:0}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.819Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Profile API response&quot;,&quot;type&quot;:&quot;general&quot;,&quot;endpoint&quot;:&quot;https://financialmodelingprep.com/stable/profile?symbol=AAPL&amp;apikey=z5xjUUlsab7zBKntL5QnMzWyPuq2iWsM&quot;,&quot;responseType&quot;:&quot;object&quot;,&quot;responseLength&quot;:&quot;N/A&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.819Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Profile fetched but no description field&quot;,&quot;type&quot;:&quot;general&quot;,&quot;profileKeys&quot;:[&quot;price&quot;,&quot;symbol&quot;]}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.819Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Final description resolved&quot;,&quot;type&quot;:&quot;general&quot;,&quot;hasDescription&quot;:false,&quot;descriptionLength&quot;:0,&quot;source&quot;:&quot;none&quot;}

[fetchAndSaveHistoricalPrice] Starting fetch for AAPL from FMP API
[fetchAndSaveHistoricalPrice] Fetching from: https://financialmodelingprep.com/stable/historical-chart/30min?symbol=AAPL&amp;apikey=***

[fetchAndSaveHistoricalPrice] Received single record from FMP API
[fetchAndSaveHistoricalPrice] FMP API returned 1 records for AAPL
[fetchAndSaveHistoricalPrice] Sample record structure: {
  date: undefined,
  hasOpen: false,
  hasHigh: false,
  hasLow: false,
  hasClose: false,
  hasPrice: true,
  keys: [ &apos;price&apos;, &apos;symbol&apos; ]
}
Saved 0 daily candles (aggregated from 1 1-hour records) for AAPL with OHLC data

Cache miss for stock details: AAPL, fetching...

            </system-out>
            <system-err>
[fetchAndSaveHistoricalPrice] Failed to parse date from timestamp undefined, skipping record

            </system-err>
        </testcase>
        <testcase classname="test/integration/stock-flow.spec.ts" name="Stock Data Flow Integration &gt; Batch Stock Retrieval Flow &gt; should retrieve multiple stocks efficiently" time="0.028">
        </testcase>
        <testcase classname="test/integration/stock-flow.spec.ts" name="Stock Data Flow Integration &gt; Caching Flow &gt; should cache stock data and serve from cache on subsequent requests" time="0.025">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.937Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Cache hit for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;ageSeconds&quot;:0,&quot;pollingIntervalSec&quot;:30,&quot;cacheStatus&quot;:&quot;HIT&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.937Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Cache hit for AAPL&quot;,&quot;type&quot;:&quot;general&quot;,&quot;ageSeconds&quot;:0,&quot;pollingIntervalSec&quot;:30,&quot;cacheStatus&quot;:&quot;HIT&quot;}

            </system-out>
        </testcase>
    </testsuite>
    <testsuite name="test/logging/d1-wrapper.spec.ts" timestamp="2025-12-20T12:24:18.270Z" hostname="sngvahmed" tests="15" failures="0" errors="0" skipped="0" time="1.338">
        <testcase classname="test/logging/d1-wrapper.spec.ts" name="LoggedD1Database &gt; prepare &gt; should wrap prepared statement" time="0.041">
        </testcase>
        <testcase classname="test/logging/d1-wrapper.spec.ts" name="LoggedD1Database &gt; exec &gt; should log successful exec operation" time="0.079">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.433Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;D1 exec: SELECT * FROM alerts&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;d1&quot;,&quot;query&quot;:&quot;SELECT * FROM alerts&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;N/A&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/d1-wrapper.spec.ts" name="LoggedD1Database &gt; exec &gt; should log failed exec operation" time="0.037">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.471Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;D1 exec failed: SELECT * FROM alerts&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;d1&quot;,&quot;query&quot;:&quot;SELECT * FROM alerts&quot;,&quot;latencyMs&quot;:1,&quot;cacheStatus&quot;:&quot;N/A&quot;,&quot;error&quot;:&quot;Database error&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/d1-wrapper.spec.ts" name="LoggedD1Database &gt; batch &gt; should log successful batch operation" time="0.045">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.582Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;D1 batch: BATCH(2 statements)&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;d1&quot;,&quot;query&quot;:&quot;BATCH(2 statements)&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;N/A&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/d1-wrapper.spec.ts" name="LoggedD1Database &gt; batch &gt; should log failed batch operation" time="0.077">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.663Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;D1 batch failed: BATCH(2 statements)&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;d1&quot;,&quot;query&quot;:&quot;BATCH(2 statements)&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;N/A&quot;,&quot;error&quot;:&quot;Batch failed&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/d1-wrapper.spec.ts" name="LoggedD1Database &gt; LoggedD1PreparedStatement &gt; bind &gt; should chain bind calls" time="0.044">
        </testcase>
        <testcase classname="test/logging/d1-wrapper.spec.ts" name="LoggedD1Database &gt; LoggedD1PreparedStatement &gt; bind &gt; should support multiple bind calls" time="0.073">
        </testcase>
        <testcase classname="test/logging/d1-wrapper.spec.ts" name="LoggedD1Database &gt; LoggedD1PreparedStatement &gt; first &gt; should log successful first operation" time="0.058">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.965Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;D1 first: SELECT * FROM alerts WHERE id = ?&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;d1&quot;,&quot;query&quot;:&quot;SELECT * FROM alerts WHERE id = ?&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;N/A&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/d1-wrapper.spec.ts" name="LoggedD1Database &gt; LoggedD1PreparedStatement &gt; first &gt; should log failed first operation" time="0.035">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.995Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;D1 first failed: SELECT * FROM alerts WHERE id = ?&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;d1&quot;,&quot;query&quot;:&quot;SELECT * FROM alerts WHERE id = ?&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;N/A&quot;,&quot;error&quot;:&quot;Query failed&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/d1-wrapper.spec.ts" name="LoggedD1Database &gt; LoggedD1PreparedStatement &gt; all &gt; should log successful all operation" time="0.047">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.081Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;D1 all: SELECT * FROM alerts WHERE id = ?&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;d1&quot;,&quot;query&quot;:&quot;SELECT * FROM alerts WHERE id = ?&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;N/A&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/d1-wrapper.spec.ts" name="LoggedD1Database &gt; LoggedD1PreparedStatement &gt; all &gt; should log failed all operation" time="0.029">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.107Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;D1 all failed: SELECT * FROM alerts WHERE id = ?&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;d1&quot;,&quot;query&quot;:&quot;SELECT * FROM alerts WHERE id = ?&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;N/A&quot;,&quot;error&quot;:&quot;Query failed&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/d1-wrapper.spec.ts" name="LoggedD1Database &gt; LoggedD1PreparedStatement &gt; run &gt; should log successful run operation" time="0.062">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.201Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;D1 run: SELECT * FROM alerts WHERE id = ?&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;d1&quot;,&quot;query&quot;:&quot;SELECT * FROM alerts WHERE id = ?&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;N/A&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/d1-wrapper.spec.ts" name="LoggedD1Database &gt; LoggedD1PreparedStatement &gt; run &gt; should log failed run operation" time="0.039">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.233Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;D1 run failed: SELECT * FROM alerts WHERE id = ?&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;d1&quot;,&quot;query&quot;:&quot;SELECT * FROM alerts WHERE id = ?&quot;,&quot;latencyMs&quot;:1,&quot;cacheStatus&quot;:&quot;N/A&quot;,&quot;error&quot;:&quot;Update failed&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/d1-wrapper.spec.ts" name="LoggedD1Database &gt; LoggedD1PreparedStatement &gt; latency measurement &gt; should measure latency accurately" time="0.049">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.355Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;D1 first: SELECT * FROM alerts WHERE id = ?&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;d1&quot;,&quot;query&quot;:&quot;SELECT * FROM alerts WHERE id = ?&quot;,&quot;latencyMs&quot;:10,&quot;cacheStatus&quot;:&quot;N/A&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/d1-wrapper.spec.ts" name="LoggedD1Database &gt; LoggedD1PreparedStatement &gt; error propagation &gt; should re-throw errors after logging" time="0.037">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.451Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;D1 first failed: SELECT * FROM alerts WHERE id = ?&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;d1&quot;,&quot;query&quot;:&quot;SELECT * FROM alerts WHERE id = ?&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;N/A&quot;,&quot;error&quot;:&quot;Database error&quot;}

            </system-out>
        </testcase>
    </testsuite>
    <testsuite name="test/logging/kv-wrapper.spec.ts" timestamp="2025-12-20T12:24:18.273Z" hostname="sngvahmed" tests="26" failures="0" errors="0" skipped="0" time="1.625">
        <testcase classname="test/logging/kv-wrapper.spec.ts" name="LoggedKVNamespace &gt; get &gt; should log HIT when value exists (text)" time="0.044">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.377Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;KV get: cache:key&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;kv&quot;,&quot;key&quot;:&quot;cache:key&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;HIT&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/kv-wrapper.spec.ts" name="LoggedKVNamespace &gt; get &gt; should log MISS when value is null (text)" time="0.075">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.459Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;KV get: cache:key&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;kv&quot;,&quot;key&quot;:&quot;cache:key&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;MISS&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/kv-wrapper.spec.ts" name="LoggedKVNamespace &gt; get &gt; should log HIT when value exists (json)" time="0.038">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.493Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;KV get: cache:key&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;kv&quot;,&quot;key&quot;:&quot;cache:key&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;HIT&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/kv-wrapper.spec.ts" name="LoggedKVNamespace &gt; get &gt; should log MISS when value is null (json)" time="0.088">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.577Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;KV get: cache:key&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;kv&quot;,&quot;key&quot;:&quot;cache:key&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;MISS&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/kv-wrapper.spec.ts" name="LoggedKVNamespace &gt; get &gt; should handle arrayBuffer type" time="0.05">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.623Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;KV get: cache:key&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;kv&quot;,&quot;key&quot;:&quot;cache:key&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;HIT&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/kv-wrapper.spec.ts" name="LoggedKVNamespace &gt; get &gt; should handle stream type" time="0.076">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.709Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;KV get: cache:key&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;kv&quot;,&quot;key&quot;:&quot;cache:key&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;HIT&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/kv-wrapper.spec.ts" name="LoggedKVNamespace &gt; get &gt; should log failed get operation" time="0.083">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.787Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;KV get failed: cache:key&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;kv&quot;,&quot;key&quot;:&quot;cache:key&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;N/A&quot;,&quot;error&quot;:&quot;KV error&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/kv-wrapper.spec.ts" name="LoggedKVNamespace &gt; get &gt; should measure latency" time="0.087">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.840Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;KV get: cache:key&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;kv&quot;,&quot;key&quot;:&quot;cache:key&quot;,&quot;latencyMs&quot;:11,&quot;cacheStatus&quot;:&quot;HIT&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/kv-wrapper.spec.ts" name="LoggedKVNamespace &gt; put &gt; should log successful put operation" time="0.062">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.979Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;KV put: cache:key&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;kv&quot;,&quot;key&quot;:&quot;cache:key&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;N/A&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/kv-wrapper.spec.ts" name="LoggedKVNamespace &gt; put &gt; should log put with expiration options" time="0.034">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.011Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;KV put: cache:key&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;kv&quot;,&quot;key&quot;:&quot;cache:key&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;N/A&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/kv-wrapper.spec.ts" name="LoggedKVNamespace &gt; put &gt; should log failed put operation" time="0.043">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.047Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;KV put failed: cache:key&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;kv&quot;,&quot;key&quot;:&quot;cache:key&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;N/A&quot;,&quot;error&quot;:&quot;Put failed&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/kv-wrapper.spec.ts" name="LoggedKVNamespace &gt; put &gt; should handle ArrayBuffer value" time="0.028">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.088Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;KV put: cache:key&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;kv&quot;,&quot;key&quot;:&quot;cache:key&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;N/A&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/kv-wrapper.spec.ts" name="LoggedKVNamespace &gt; delete &gt; should log successful delete operation" time="0.055">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.148Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;KV delete: cache:key&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;kv&quot;,&quot;key&quot;:&quot;cache:key&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;N/A&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/kv-wrapper.spec.ts" name="LoggedKVNamespace &gt; delete &gt; should log failed delete operation" time="0.034">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.206Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;KV delete failed: cache:key&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;kv&quot;,&quot;key&quot;:&quot;cache:key&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;N/A&quot;,&quot;error&quot;:&quot;Delete failed&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/kv-wrapper.spec.ts" name="LoggedKVNamespace &gt; list &gt; should log successful list operation without options" time="0.04">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.291Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;KV list: prefix=all&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;kv&quot;,&quot;key&quot;:&quot;*&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;N/A&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/kv-wrapper.spec.ts" name="LoggedKVNamespace &gt; list &gt; should log successful list operation with prefix" time="0.045">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.336Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;KV list: prefix=cache:&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;kv&quot;,&quot;key&quot;:&quot;cache:&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;N/A&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/kv-wrapper.spec.ts" name="LoggedKVNamespace &gt; list &gt; should log successful list operation with limit" time="0.072">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.403Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;KV list: prefix=all&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;kv&quot;,&quot;key&quot;:&quot;*&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;N/A&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/kv-wrapper.spec.ts" name="LoggedKVNamespace &gt; list &gt; should log successful list operation with cursor" time="0.037">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.450Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;KV list: prefix=all&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;kv&quot;,&quot;key&quot;:&quot;*&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;N/A&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/kv-wrapper.spec.ts" name="LoggedKVNamespace &gt; list &gt; should log failed list operation" time="0.071">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.516Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;KV list failed: prefix=all&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;kv&quot;,&quot;key&quot;:&quot;*&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;N/A&quot;,&quot;error&quot;:&quot;List failed&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/kv-wrapper.spec.ts" name="LoggedKVNamespace &gt; error propagation &gt; should re-throw errors after logging" time="0.063">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.620Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;KV get failed: cache:key&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;kv&quot;,&quot;key&quot;:&quot;cache:key&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;N/A&quot;,&quot;error&quot;:&quot;KV error&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/kv-wrapper.spec.ts" name="LoggedKVNamespace &gt; cache status detection &gt; should detect HIT for non-null text value" time="0.054">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.686Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;KV get: key&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;kv&quot;,&quot;key&quot;:&quot;key&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;HIT&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/kv-wrapper.spec.ts" name="LoggedKVNamespace &gt; cache status detection &gt; should detect HIT for non-null json value" time="0.032">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.744Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;KV get: key&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;kv&quot;,&quot;key&quot;:&quot;key&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;HIT&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/kv-wrapper.spec.ts" name="LoggedKVNamespace &gt; cache status detection &gt; should detect MISS for null value" time="0.029">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.777Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;KV get: key&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;kv&quot;,&quot;key&quot;:&quot;key&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;MISS&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/kv-wrapper.spec.ts" name="LoggedKVNamespace &gt; cache status detection &gt; should use N/A for put operations" time="0.036">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.811Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;KV put: key&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;kv&quot;,&quot;key&quot;:&quot;key&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;N/A&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/kv-wrapper.spec.ts" name="LoggedKVNamespace &gt; cache status detection &gt; should use N/A for delete operations" time="0.024">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.839Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;KV delete: key&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;kv&quot;,&quot;key&quot;:&quot;key&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;N/A&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/kv-wrapper.spec.ts" name="LoggedKVNamespace &gt; cache status detection &gt; should use N/A for list operations" time="0.026">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.863Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;KV list: prefix=all&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;kv&quot;,&quot;key&quot;:&quot;*&quot;,&quot;latencyMs&quot;:0,&quot;cacheStatus&quot;:&quot;N/A&quot;}

            </system-out>
        </testcase>
    </testsuite>
    <testsuite name="test/logging/logger.spec.ts" timestamp="2025-12-20T12:24:18.278Z" hostname="sngvahmed" tests="31" failures="0" errors="0" skipped="0" time="1.939">
        <testcase classname="test/logging/logger.spec.ts" name="Logger &gt; constructor &gt; should initialize with context" time="0.035">
        </testcase>
        <testcase classname="test/logging/logger.spec.ts" name="Logger &gt; constructor &gt; should start with empty log buffer" time="0.078">
        </testcase>
        <testcase classname="test/logging/logger.spec.ts" name="Logger &gt; debug &gt; should create debug log entry" time="0.077">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.426Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-123&quot;,&quot;userId&quot;:&quot;user-456&quot;,&quot;path&quot;:&quot;/v1/api/test&quot;,&quot;message&quot;:&quot;Debug message&quot;,&quot;type&quot;:&quot;general&quot;,&quot;extra&quot;:&quot;data&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/logger.spec.ts" name="Logger &gt; info &gt; should create info log entry" time="0.04">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.537Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-123&quot;,&quot;userId&quot;:&quot;user-456&quot;,&quot;path&quot;:&quot;/v1/api/test&quot;,&quot;message&quot;:&quot;Info message&quot;,&quot;type&quot;:&quot;general&quot;,&quot;action&quot;:&quot;test&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/logger.spec.ts" name="Logger &gt; warn &gt; should create warn log entry" time="0.092">
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.672Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;WARN&quot;,&quot;traceId&quot;:&quot;test-trace-123&quot;,&quot;userId&quot;:&quot;user-456&quot;,&quot;path&quot;:&quot;/v1/api/test&quot;,&quot;message&quot;:&quot;Warning message&quot;,&quot;type&quot;:&quot;general&quot;,&quot;warning&quot;:&quot;test&quot;}

            </system-err>
        </testcase>
        <testcase classname="test/logging/logger.spec.ts" name="Logger &gt; error &gt; should create error log entry with Error object" time="0.039">
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.762Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-123&quot;,&quot;userId&quot;:&quot;user-456&quot;,&quot;path&quot;:&quot;/v1/api/test&quot;,&quot;message&quot;:&quot;Error message&quot;,&quot;type&quot;:&quot;general&quot;,&quot;context&quot;:&quot;test&quot;,&quot;error&quot;:{&quot;name&quot;:&quot;Error&quot;,&quot;message&quot;:&quot;Test error&quot;,&quot;stack&quot;:&quot;Error stack trace&quot;}}

            </system-err>
        </testcase>
        <testcase classname="test/logging/logger.spec.ts" name="Logger &gt; error &gt; should create error log entry with string error" time="0.041">
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.803Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-123&quot;,&quot;userId&quot;:&quot;user-456&quot;,&quot;path&quot;:&quot;/v1/api/test&quot;,&quot;message&quot;:&quot;Error message&quot;,&quot;type&quot;:&quot;general&quot;,&quot;context&quot;:&quot;test&quot;,&quot;error&quot;:&quot;String error&quot;}

            </system-err>
        </testcase>
        <testcase classname="test/logging/logger.spec.ts" name="Logger &gt; error &gt; should create error log entry without error" time="0.08">
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.879Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-123&quot;,&quot;userId&quot;:&quot;user-456&quot;,&quot;path&quot;:&quot;/v1/api/test&quot;,&quot;message&quot;:&quot;Error message&quot;,&quot;type&quot;:&quot;general&quot;,&quot;context&quot;:&quot;test&quot;}

            </system-err>
        </testcase>
        <testcase classname="test/logging/logger.spec.ts" name="Logger &gt; logApiCall &gt; should create API call log entry" time="0.065">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:05.985Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-123&quot;,&quot;userId&quot;:&quot;user-456&quot;,&quot;path&quot;:&quot;/v1/api/test&quot;,&quot;message&quot;:&quot;API call made&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;endpoint&quot;:&quot;/quote&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;statusCode&quot;:200,&quot;latencyMs&quot;:150}

            </system-out>
        </testcase>
        <testcase classname="test/logging/logger.spec.ts" name="Logger &gt; logApiCall &gt; should create API call log entry with partial options" time="0.036">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.018Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-123&quot;,&quot;userId&quot;:&quot;user-456&quot;,&quot;path&quot;:&quot;/v1/api/test&quot;,&quot;message&quot;:&quot;API call&quot;,&quot;type&quot;:&quot;api_call&quot;,&quot;apiProvider&quot;:&quot;FMP&quot;,&quot;latencyMs&quot;:100}

            </system-out>
        </testcase>
        <testcase classname="test/logging/logger.spec.ts" name="Logger &gt; logDataOperation &gt; should create D1 operation log entry" time="0.027">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.098Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-123&quot;,&quot;userId&quot;:&quot;user-456&quot;,&quot;path&quot;:&quot;/v1/api/test&quot;,&quot;message&quot;:&quot;D1 query executed&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;d1&quot;,&quot;query&quot;:&quot;SELECT * FROM alerts&quot;,&quot;latencyMs&quot;:25,&quot;cacheStatus&quot;:&quot;N/A&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/logger.spec.ts" name="Logger &gt; logDataOperation &gt; should create KV operation log entry with HIT" time="0.034">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.126Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-123&quot;,&quot;userId&quot;:&quot;user-456&quot;,&quot;path&quot;:&quot;/v1/api/test&quot;,&quot;message&quot;:&quot;KV get&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;kv&quot;,&quot;key&quot;:&quot;cache:key&quot;,&quot;latencyMs&quot;:5,&quot;cacheStatus&quot;:&quot;HIT&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/logger.spec.ts" name="Logger &gt; logDataOperation &gt; should create KV operation log entry with MISS" time="0.062">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.185Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-123&quot;,&quot;userId&quot;:&quot;user-456&quot;,&quot;path&quot;:&quot;/v1/api/test&quot;,&quot;message&quot;:&quot;KV get&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;kv&quot;,&quot;key&quot;:&quot;cache:key&quot;,&quot;latencyMs&quot;:5,&quot;cacheStatus&quot;:&quot;MISS&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/logger.spec.ts" name="Logger &gt; logDataOperation &gt; should create data operation log entry with error" time="0.034">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.222Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;DEBUG&quot;,&quot;traceId&quot;:&quot;test-trace-123&quot;,&quot;userId&quot;:&quot;user-456&quot;,&quot;path&quot;:&quot;/v1/api/test&quot;,&quot;message&quot;:&quot;D1 query failed&quot;,&quot;type&quot;:&quot;data_operation&quot;,&quot;operation&quot;:&quot;d1&quot;,&quot;query&quot;:&quot;SELECT * FROM alerts&quot;,&quot;latencyMs&quot;:25,&quot;cacheStatus&quot;:&quot;N/A&quot;,&quot;error&quot;:&quot;Database connection failed&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/logger.spec.ts" name="Logger &gt; logFCMError &gt; should create FCM error log entry" time="0.043">
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.297Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-123&quot;,&quot;userId&quot;:&quot;user-456&quot;,&quot;path&quot;:&quot;/v1/api/test&quot;,&quot;message&quot;:&quot;FCM notification failed&quot;,&quot;type&quot;:&quot;fcm_error&quot;,&quot;fcmErrorCode&quot;:&quot;5&quot;,&quot;fcmErrorType&quot;:&quot;NOT_FOUND&quot;,&quot;isPermanent&quot;:true,&quot;shouldCleanupToken&quot;:true,&quot;requestPayload&quot;:{&quot;token&quot;:&quot;fcm-token&quot;,&quot;title&quot;:&quot;Alert&quot;,&quot;body&quot;:&quot;Price alert&quot;},&quot;errorMessage&quot;:&quot;Token not found&quot;}

            </system-err>
        </testcase>
        <testcase classname="test/logging/logger.spec.ts" name="Logger &gt; getLogs &gt; should return copy of log buffer" time="0.072">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.407Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-123&quot;,&quot;userId&quot;:&quot;user-456&quot;,&quot;path&quot;:&quot;/v1/api/test&quot;,&quot;message&quot;:&quot;Message 1&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.407Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-123&quot;,&quot;userId&quot;:&quot;user-456&quot;,&quot;path&quot;:&quot;/v1/api/test&quot;,&quot;message&quot;:&quot;Message 2&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/logger.spec.ts" name="Logger &gt; clearLogs &gt; should clear log buffer" time="0.059">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.504Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-123&quot;,&quot;userId&quot;:&quot;user-456&quot;,&quot;path&quot;:&quot;/v1/api/test&quot;,&quot;message&quot;:&quot;Message 1&quot;,&quot;type&quot;:&quot;general&quot;}
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.504Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-123&quot;,&quot;userId&quot;:&quot;user-456&quot;,&quot;path&quot;:&quot;/v1/api/test&quot;,&quot;message&quot;:&quot;Message 2&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/logger.spec.ts" name="Logger &gt; updateContext &gt; should update context" time="0.059">
        </testcase>
        <testcase classname="test/logging/logger.spec.ts" name="Logger &gt; updateContext &gt; should update multiple context fields" time="0.035">
        </testcase>
        <testcase classname="test/logging/logger.spec.ts" name="Logger &gt; updateContext &gt; should use updated context in new logs" time="0.053">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.678Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-123&quot;,&quot;userId&quot;:&quot;updated-user&quot;,&quot;path&quot;:&quot;/v1/api/test&quot;,&quot;message&quot;:&quot;New message&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/logger.spec.ts" name="Logger &gt; getContext &gt; should return copy of context" time="0.032">
        </testcase>
        <testcase classname="test/logging/logger.spec.ts" name="Logger &gt; log entry structure &gt; should include all required fields" time="0.026">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.820Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-123&quot;,&quot;userId&quot;:&quot;user-456&quot;,&quot;path&quot;:&quot;/v1/api/test&quot;,&quot;message&quot;:&quot;Test message&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/logger.spec.ts" name="Logger &gt; log entry structure &gt; should handle null userId" time="0.024">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.847Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test-trace-123&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/v1/api/test&quot;,&quot;message&quot;:&quot;Test&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/logger.spec.ts" name="Logger &gt; log entry structure &gt; should handle undefined userId" time="0.027">
            <system-out>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.872Z&quot;,&quot;service&quot;:&quot;test&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;traceId&quot;:&quot;test&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;Test&quot;,&quot;type&quot;:&quot;general&quot;}

            </system-out>
        </testcase>
        <testcase classname="test/logging/logger.spec.ts" name="extractUserId &gt; should extract userId from push-token path" time="0.022">
        </testcase>
        <testcase classname="test/logging/logger.spec.ts" name="extractUserId &gt; should extract userId from preferences path" time="0.023">
        </testcase>
        <testcase classname="test/logging/logger.spec.ts" name="extractUserId &gt; should extract userId from settings path" time="0.03">
        </testcase>
        <testcase classname="test/logging/logger.spec.ts" name="extractUserId &gt; should extract userId from devices path" time="0.017">
        </testcase>
        <testcase classname="test/logging/logger.spec.ts" name="extractUserId &gt; should return null when userId not in path" time="0.018">
        </testcase>
        <testcase classname="test/logging/logger.spec.ts" name="extractUserId &gt; should return null for paths without userId pattern" time="0.019">
        </testcase>
        <testcase classname="test/logging/logger.spec.ts" name="extractUserId &gt; should extract userId from path with query params" time="0.019">
        </testcase>
    </testsuite>
    <testsuite name="test/logging/loki-shipper.spec.ts" timestamp="2025-12-20T12:24:18.283Z" hostname="sngvahmed" tests="12" failures="0" errors="0" skipped="0" time="0.822">
        <testcase classname="test/logging/loki-shipper.spec.ts" name="Loki Shipper &gt; sendLogsToLoki &gt; should ship logs successfully" time="0.042">
            <system-out>
[Loki Shipper] Successfully shipped 2 log entries

            </system-out>
        </testcase>
        <testcase classname="test/logging/loki-shipper.spec.ts" name="Loki Shipper &gt; sendLogsToLoki &gt; should format timestamps as nanoseconds" time="0.082">
            <system-out>
[Loki Shipper] Successfully shipped 2 log entries

            </system-out>
        </testcase>
        <testcase classname="test/logging/loki-shipper.spec.ts" name="Loki Shipper &gt; sendLogsToLoki &gt; should handle URL with trailing slash" time="0.034">
            <system-out>
[Loki Shipper] Successfully shipped 2 log entries

            </system-out>
        </testcase>
        <testcase classname="test/logging/loki-shipper.spec.ts" name="Loki Shipper &gt; sendLogsToLoki &gt; should include Basic Auth when credentials provided" time="0.07">
            <system-out>
[Loki Shipper] Successfully shipped 2 log entries

            </system-out>
        </testcase>
        <testcase classname="test/logging/loki-shipper.spec.ts" name="Loki Shipper &gt; sendLogsToLoki &gt; should not include Auth when credentials not provided" time="0.04">
            <system-out>
[Loki Shipper] Successfully shipped 2 log entries

            </system-out>
        </testcase>
        <testcase classname="test/logging/loki-shipper.spec.ts" name="Loki Shipper &gt; sendLogsToLoki &gt; should include custom labels" time="0.076">
            <system-out>
[Loki Shipper] Successfully shipped 2 log entries

            </system-out>
        </testcase>
        <testcase classname="test/logging/loki-shipper.spec.ts" name="Loki Shipper &gt; sendLogsToLoki &gt; should return early if no logs" time="0.048">
        </testcase>
        <testcase classname="test/logging/loki-shipper.spec.ts" name="Loki Shipper &gt; sendLogsToLoki &gt; should return early if URL not configured" time="0.069">
        </testcase>
        <testcase classname="test/logging/loki-shipper.spec.ts" name="Loki Shipper &gt; sendLogsToLoki &gt; should handle non-200 response" time="0.075">
        </testcase>
        <testcase classname="test/logging/loki-shipper.spec.ts" name="Loki Shipper &gt; sendLogsToLoki &gt; should handle network errors gracefully" time="0.04">
        </testcase>
        <testcase classname="test/logging/loki-shipper.spec.ts" name="Loki Shipper &gt; sendLogsToLoki &gt; should handle fetch text() error" time="0.08">
        </testcase>
        <testcase classname="test/logging/loki-shipper.spec.ts" name="Loki Shipper &gt; sendLogsToLoki &gt; should format logs correctly with all log types" time="0.026">
            <system-out>
[Loki Shipper] Successfully shipped 3 log entries

            </system-out>
        </testcase>
    </testsuite>
    <testsuite name="test/notifications/expo-sender.spec.ts" timestamp="2025-12-20T12:24:18.285Z" hostname="sngvahmed" tests="17" failures="0" errors="0" skipped="0" time="4.056">
        <testcase classname="test/notifications/expo-sender.spec.ts" name="Expo Sender &gt; sendExpoPush &gt; should return false for invalid token" time="0.035">
        </testcase>
        <testcase classname="test/notifications/expo-sender.spec.ts" name="Expo Sender &gt; sendExpoPush &gt; should return true on successful send" time="0.079">
            <system-out>
✅ Expo Push notification sent successfully (attempt 1/3): ticket-id

            </system-out>
        </testcase>
        <testcase classname="test/notifications/expo-sender.spec.ts" name="Expo Sender &gt; sendExpoPush &gt; should retry on temporary error" time="0.239">
            <system-out>
⏳ Retrying in 200ms...

✅ Expo Push notification sent successfully (attempt 2/3): ticket-id

            </system-out>
            <system-err>
❌ Expo Push notification failed (attempt 1/3): HTTP 503: Service Unavailable

            </system-err>
        </testcase>
        <testcase classname="test/notifications/expo-sender.spec.ts" name="Expo Sender &gt; sendExpoPush &gt; should return false if all retries fail" time="0.789">
            <system-out>
⏳ Retrying in 200ms...

⏳ Retrying in 500ms...

            </system-out>
            <system-err>
❌ Expo Push notification failed (attempt 1/3): HTTP 500: Internal Server Error

❌ Expo Push notification failed (attempt 2/3): HTTP 500: Internal Server Error

❌ Expo Push notification failed (attempt 3/3): HTTP 500: Internal Server Error
🚫 Expo Push notification failed after 3 attempts. Giving up.

            </system-err>
        </testcase>
        <testcase classname="test/notifications/expo-sender.spec.ts" name="Expo Sender &gt; should handle network exception and retry" time="0.239">
            <system-out>
⏳ Retrying in 200ms...

✅ Expo Push notification sent successfully (attempt 2/3): ticket-id

            </system-out>
            <system-err>
❌ Expo Push notification failed (attempt 1/3): Network error

            </system-err>
        </testcase>
        <testcase classname="test/notifications/expo-sender.spec.ts" name="Expo Sender &gt; should handle malformed JSON response and retry" time="0.243">
            <system-out>
⏳ Retrying in 200ms...

✅ Expo Push notification sent successfully (attempt 2/3): ticket-id

            </system-out>
            <system-err>
❌ Expo Push notification failed (attempt 1/3): Invalid JSON

            </system-err>
        </testcase>
        <testcase classname="test/notifications/expo-sender.spec.ts" name="Expo Sender &gt; should retry on 429 Too Many Requests" time="0.228">
            <system-out>
⏳ Retrying in 200ms...

✅ Expo Push notification sent successfully (attempt 2/3): ticket-id

            </system-out>
            <system-err>
❌ Expo Push notification failed (attempt 1/3): HTTP 429: Too Many Requests

            </system-err>
        </testcase>
        <testcase classname="test/notifications/expo-sender.spec.ts" name="Expo Sender &gt; sendExpoPushWithLogs &gt; should return Detailed logs on success" time="0.016">
        </testcase>
        <testcase classname="test/notifications/expo-sender.spec.ts" name="Expo Sender &gt; sendExpoPushWithLogs &gt; should return error info on permanent error (DeviceNotRegistered)" time="0.014">
        </testcase>
        <testcase classname="test/notifications/expo-sender.spec.ts" name="Expo Sender &gt; sendExpoPushWithLogs &gt; should handle &quot;Message Too Big&quot; error" time="0.009">
        </testcase>
        <testcase classname="test/notifications/expo-sender.spec.ts" name="Expo Sender &gt; sendExpoPushWithLogs &gt; should handle &quot;Invalid Token&quot; error" time="0.006">
        </testcase>
        <testcase classname="test/notifications/expo-sender.spec.ts" name="Expo Sender &gt; sendExpoPushWithLogs &gt; should handle &quot;Rate Limit&quot; error from body" time="0.204">
        </testcase>
        <testcase classname="test/notifications/expo-sender.spec.ts" name="Expo Sender &gt; sendExpoPushWithLogs &gt; should handle HTTP error response parsing" time="0.205">
        </testcase>
        <testcase classname="test/notifications/expo-sender.spec.ts" name="Expo Sender &gt; sendExpoPushWithLogs &gt; should handle permanent HTTP error (401/403 implicit?) actually logic only checks message for permanent" time="0.705">
        </testcase>
        <testcase classname="test/notifications/expo-sender.spec.ts" name="Expo Sender &gt; sendExpoPushWithLogs &gt; should handle JSON parsing error" time="0.205">
        </testcase>
        <testcase classname="test/notifications/expo-sender.spec.ts" name="Expo Sender &gt; sendExpoPushWithLogs &gt; should handle missing ticket in response" time="0.706">
        </testcase>
        <testcase classname="test/notifications/expo-sender.spec.ts" name="Expo Sender &gt; sendExpoPushBatch &gt; should send multiple messages and assume optimistic success counting based on mock" time="0.004">
            <system-out>
✅ Expo Push notification sent successfully (attempt 1/3): ticket-id
✅ Expo Push notification sent successfully (attempt 1/3): ticket-id

            </system-out>
        </testcase>
    </testsuite>
    <testsuite name="test/notifications/fcm-sender.spec.ts" timestamp="2025-12-20T12:24:18.288Z" hostname="sngvahmed" tests="16" failures="0" errors="0" skipped="0" time="2.169">
        <testcase classname="test/notifications/fcm-sender.spec.ts" name="FCM Sender &gt; sendFCMNotificationWithLogs &gt; should reject invalid token format" time="0.034">
        </testcase>
        <testcase classname="test/notifications/fcm-sender.spec.ts" name="FCM Sender &gt; sendFCMNotificationWithLogs &gt; should reject null token" time="0.029">
        </testcase>
        <testcase classname="test/notifications/fcm-sender.spec.ts" name="FCM Sender &gt; sendFCMNotificationWithLogs &gt; should handle missing FCM_SERVICE_ACCOUNT" time="0.063">
        </testcase>
        <testcase classname="test/notifications/fcm-sender.spec.ts" name="FCM Sender &gt; sendFCMNotificationWithLogs &gt; should handle invalid service account JSON" time="0.039">
        </testcase>
        <testcase classname="test/notifications/fcm-sender.spec.ts" name="FCM Sender &gt; sendFCMNotificationWithLogs &gt; should handle JWT generation failure" time="0.078">
            <system-err>
Failed to get Google access token: Error: JWT generation failed
    at /home/sngvahmed/workspace/stockly/api/test/notifications/fcm-sender.spec.ts:116:54
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20
    at new Promise (&lt;anonymous&gt;)
    at runWithTimeout (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)
    at runTest (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)

            </system-err>
        </testcase>
        <testcase classname="test/notifications/fcm-sender.spec.ts" name="FCM Sender &gt; sendFCMNotificationWithLogs &gt; should handle access token exchange failure" time="0.036">
            <system-err>
Failed to get Google access token: Error: Token exchange failed
    at /home/sngvahmed/workspace/stockly/api/test/notifications/fcm-sender.spec.ts:133:9
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26
    at home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20
    at new Promise (&lt;anonymous&gt;)
    at runWithTimeout (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)
    at runTest (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (home/sngvahmed/workspace/stockly/api/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)

            </system-err>
        </testcase>
        <testcase classname="test/notifications/fcm-sender.spec.ts" name="FCM Sender &gt; sendFCMNotificationWithLogs &gt; should send notification successfully" time="0.058">
        </testcase>
        <testcase classname="test/notifications/fcm-sender.spec.ts" name="FCM Sender &gt; sendFCMNotificationWithLogs &gt; should retry on temporary errors" time="0.237">
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.452Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FCM push notification failed&quot;,&quot;type&quot;:&quot;fcm_error&quot;,&quot;fcmErrorCode&quot;:&quot;14&quot;,&quot;fcmErrorType&quot;:&quot;UNAVAILABLE&quot;,&quot;isPermanent&quot;:false,&quot;shouldCleanupToken&quot;:false,&quot;requestPayload&quot;:{&quot;token&quot;:&quot;dXXXXXXXXXXXXXXXXXXXXXXXXXXXXX...&quot;,&quot;title&quot;:&quot;Test Title&quot;,&quot;body&quot;:&quot;Test Body&quot;,&quot;dataKeys&quot;:[&quot;alertId&quot;]},&quot;errorMessage&quot;:&quot;Service unavailable&quot;}

            </system-err>
        </testcase>
        <testcase classname="test/notifications/fcm-sender.spec.ts" name="FCM Sender &gt; sendFCMNotificationWithLogs &gt; should not retry on permanent errors" time="0.055">
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.704Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FCM push notification failed&quot;,&quot;type&quot;:&quot;fcm_error&quot;,&quot;fcmErrorCode&quot;:&quot;5&quot;,&quot;fcmErrorType&quot;:&quot;NOT_FOUND&quot;,&quot;isPermanent&quot;:true,&quot;shouldCleanupToken&quot;:true,&quot;requestPayload&quot;:{&quot;token&quot;:&quot;dXXXXXXXXXXXXXXXXXXXXXXXXXXXXX...&quot;,&quot;title&quot;:&quot;Test Title&quot;,&quot;body&quot;:&quot;Test Body&quot;,&quot;dataKeys&quot;:[&quot;alertId&quot;]},&quot;errorMessage&quot;:&quot;Token not found&quot;}

            </system-err>
        </testcase>
        <testcase classname="test/notifications/fcm-sender.spec.ts" name="FCM Sender &gt; sendFCMNotificationWithLogs &gt; should log FCM errors" time="0.032">
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.744Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FCM push notification failed&quot;,&quot;type&quot;:&quot;fcm_error&quot;,&quot;fcmErrorCode&quot;:&quot;3&quot;,&quot;fcmErrorType&quot;:&quot;INVALID_ARGUMENT&quot;,&quot;isPermanent&quot;:true,&quot;shouldCleanupToken&quot;:true,&quot;requestPayload&quot;:{&quot;token&quot;:&quot;dXXXXXXXXXXXXXXXXXXXXXXXXXXXXX...&quot;,&quot;title&quot;:&quot;Test Title&quot;,&quot;body&quot;:&quot;Test Body&quot;,&quot;dataKeys&quot;:[&quot;alertId&quot;]},&quot;errorMessage&quot;:&quot;Invalid token&quot;}

            </system-err>
        </testcase>
        <testcase classname="test/notifications/fcm-sender.spec.ts" name="FCM Sender &gt; sendFCMNotificationWithLogs &gt; should handle &quot;Permission Denied&quot; error" time="0.031">
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.777Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FCM push notification failed&quot;,&quot;type&quot;:&quot;fcm_error&quot;,&quot;fcmErrorCode&quot;:&quot;7&quot;,&quot;fcmErrorType&quot;:&quot;PERMISSION_DENIED&quot;,&quot;isPermanent&quot;:true,&quot;shouldCleanupToken&quot;:false,&quot;requestPayload&quot;:{&quot;token&quot;:&quot;dXXXXXXXXXXXXXXXXXXXXXXXXXXXXX...&quot;,&quot;title&quot;:&quot;Test Title&quot;,&quot;body&quot;:&quot;Test Body&quot;,&quot;dataKeys&quot;:[&quot;alertId&quot;]},&quot;errorMessage&quot;:&quot;Permission denied&quot;}

            </system-err>
        </testcase>
        <testcase classname="test/notifications/fcm-sender.spec.ts" name="FCM Sender &gt; sendFCMNotificationWithLogs &gt; should handle &quot;Resource Exhausted&quot; error" time="0.71">
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:06.804Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FCM push notification failed&quot;,&quot;type&quot;:&quot;fcm_error&quot;,&quot;fcmErrorCode&quot;:&quot;8&quot;,&quot;fcmErrorType&quot;:&quot;RESOURCE_EXHAUSTED&quot;,&quot;isPermanent&quot;:false,&quot;shouldCleanupToken&quot;:false,&quot;requestPayload&quot;:{&quot;token&quot;:&quot;dXXXXXXXXXXXXXXXXXXXXXXXXXXXXX...&quot;,&quot;title&quot;:&quot;Test Title&quot;,&quot;body&quot;:&quot;Test Body&quot;,&quot;dataKeys&quot;:[&quot;alertId&quot;]},&quot;errorMessage&quot;:&quot;Quota exceeded&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.004Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FCM push notification failed&quot;,&quot;type&quot;:&quot;fcm_error&quot;,&quot;fcmErrorCode&quot;:&quot;8&quot;,&quot;fcmErrorType&quot;:&quot;RESOURCE_EXHAUSTED&quot;,&quot;isPermanent&quot;:false,&quot;shouldCleanupToken&quot;:false,&quot;requestPayload&quot;:{&quot;token&quot;:&quot;dXXXXXXXXXXXXXXXXXXXXXXXXXXXXX...&quot;,&quot;title&quot;:&quot;Test Title&quot;,&quot;body&quot;:&quot;Test Body&quot;,&quot;dataKeys&quot;:[&quot;alertId&quot;]},&quot;errorMessage&quot;:&quot;Quota exceeded&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.504Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FCM push notification failed&quot;,&quot;type&quot;:&quot;fcm_error&quot;,&quot;fcmErrorCode&quot;:&quot;8&quot;,&quot;fcmErrorType&quot;:&quot;RESOURCE_EXHAUSTED&quot;,&quot;isPermanent&quot;:false,&quot;shouldCleanupToken&quot;:false,&quot;requestPayload&quot;:{&quot;token&quot;:&quot;dXXXXXXXXXXXXXXXXXXXXXXXXXXXXX...&quot;,&quot;title&quot;:&quot;Test Title&quot;,&quot;body&quot;:&quot;Test Body&quot;,&quot;dataKeys&quot;:[&quot;alertId&quot;]},&quot;errorMessage&quot;:&quot;Quota exceeded&quot;}

            </system-err>
        </testcase>
        <testcase classname="test/notifications/fcm-sender.spec.ts" name="FCM Sender &gt; sendFCMNotificationWithLogs &gt; should handle invalid JSON response from FCM" time="0.707">
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.509Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FCM push notification failed&quot;,&quot;type&quot;:&quot;fcm_error&quot;,&quot;fcmErrorCode&quot;:&quot;500&quot;,&quot;fcmErrorType&quot;:&quot;UNKNOWN_ERROR&quot;,&quot;isPermanent&quot;:false,&quot;shouldCleanupToken&quot;:false,&quot;requestPayload&quot;:{&quot;token&quot;:&quot;dXXXXXXXXXXXXXXXXXXXXXXXXXXXXX...&quot;,&quot;title&quot;:&quot;Test Title&quot;,&quot;body&quot;:&quot;Test Body&quot;,&quot;dataKeys&quot;:[&quot;alertId&quot;]},&quot;errorMessage&quot;:&quot;Internal Server Error&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:07.710Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FCM push notification failed&quot;,&quot;type&quot;:&quot;fcm_error&quot;,&quot;fcmErrorCode&quot;:&quot;500&quot;,&quot;fcmErrorType&quot;:&quot;UNKNOWN_ERROR&quot;,&quot;isPermanent&quot;:false,&quot;shouldCleanupToken&quot;:false,&quot;requestPayload&quot;:{&quot;token&quot;:&quot;dXXXXXXXXXXXXXXXXXXXXXXXXXXXXX...&quot;,&quot;title&quot;:&quot;Test Title&quot;,&quot;body&quot;:&quot;Test Body&quot;,&quot;dataKeys&quot;:[&quot;alertId&quot;]},&quot;errorMessage&quot;:&quot;Internal Server Error&quot;}

{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.210Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FCM push notification failed&quot;,&quot;type&quot;:&quot;fcm_error&quot;,&quot;fcmErrorCode&quot;:&quot;500&quot;,&quot;fcmErrorType&quot;:&quot;UNKNOWN_ERROR&quot;,&quot;isPermanent&quot;:false,&quot;shouldCleanupToken&quot;:false,&quot;requestPayload&quot;:{&quot;token&quot;:&quot;dXXXXXXXXXXXXXXXXXXXXXXXXXXXXX...&quot;,&quot;title&quot;:&quot;Test Title&quot;,&quot;body&quot;:&quot;Test Body&quot;,&quot;dataKeys&quot;:[&quot;alertId&quot;]},&quot;errorMessage&quot;:&quot;Internal Server Error&quot;}

            </system-err>
        </testcase>
        <testcase classname="test/notifications/fcm-sender.spec.ts" name="FCM Sender &gt; sendFCMNotificationWithLogs &gt; should convert data values to strings" time="0.003">
        </testcase>
        <testcase classname="test/notifications/fcm-sender.spec.ts" name="FCM Sender &gt; sendFCMNotification &gt; should return true on success" time="0.003">
        </testcase>
        <testcase classname="test/notifications/fcm-sender.spec.ts" name="FCM Sender &gt; sendFCMNotification &gt; should return false on failure" time="0.004">
            <system-err>
{&quot;timestamp&quot;:&quot;2025-12-20T12:24:08.226Z&quot;,&quot;service&quot;:&quot;stockly-api-test&quot;,&quot;level&quot;:&quot;ERROR&quot;,&quot;traceId&quot;:&quot;test-trace-id&quot;,&quot;userId&quot;:null,&quot;path&quot;:&quot;/test&quot;,&quot;message&quot;:&quot;FCM push notification failed&quot;,&quot;type&quot;:&quot;fcm_error&quot;,&quot;fcmErrorCode&quot;:&quot;3&quot;,&quot;fcmErrorType&quot;:&quot;INVALID_ARGUMENT&quot;,&quot;isPermanent&quot;:true,&quot;shouldCleanupToken&quot;:true,&quot;requestPayload&quot;:{&quot;token&quot;:&quot;dXXXXXXXXXXXXXXXXXXXXXXXXXXXXX...&quot;,&quot;title&quot;:&quot;Title&quot;,&quot;body&quot;:&quot;Body&quot;,&quot;dataKeys&quot;:[]},&quot;errorMessage&quot;:&quot;Invalid token&quot;}

            </system-err>
        </testcase>
    </testsuite>
    <testsuite name="test/notifications/jwt-helper.spec.ts" timestamp="2025-12-20T12:24:18.291Z" hostname="sngvahmed" tests="10" failures="0" errors="0" skipped="0" time="0.757">
        <testcase classname="test/notifications/jwt-helper.spec.ts" name="JWT Helper &gt; generateGoogleJWT &gt; should generate JWT with correct structure" time="0.048">
        </testcase>
        <testcase classname="test/notifications/jwt-helper.spec.ts" name="JWT Helper &gt; generateGoogleJWT &gt; should include correct header" time="0.08">
        </testcase>
        <testcase classname="test/notifications/jwt-helper.spec.ts" name="JWT Helper &gt; generateGoogleJWT &gt; should include correct payload" time="0.037">
        </testcase>
        <testcase classname="test/notifications/jwt-helper.spec.ts" name="JWT Helper &gt; generateGoogleJWT &gt; should use custom scope" time="0.078">
        </testcase>
        <testcase classname="test/notifications/jwt-helper.spec.ts" name="JWT Helper &gt; generateGoogleJWT &gt; should handle PEM key parsing" time="0.041">
        </testcase>
        <testcase classname="test/notifications/jwt-helper.spec.ts" name="JWT Helper &gt; generateGoogleJWT &gt; should sign with RSASSA-PKCS1-v1_5" time="0.066">
        </testcase>
        <testcase classname="test/notifications/jwt-helper.spec.ts" name="JWT Helper &gt; getGoogleAccessTokenFromJWT &gt; should exchange JWT for access token" time="0.032">
        </testcase>
        <testcase classname="test/notifications/jwt-helper.spec.ts" name="JWT Helper &gt; getGoogleAccessTokenFromJWT &gt; should handle non-ok response" time="0.042">
        </testcase>
        <testcase classname="test/notifications/jwt-helper.spec.ts" name="JWT Helper &gt; getGoogleAccessTokenFromJWT &gt; should handle missing access_token in response" time="0.073">
        </testcase>
        <testcase classname="test/notifications/jwt-helper.spec.ts" name="JWT Helper &gt; getGoogleAccessTokenFromJWT &gt; should handle network errors" time="0.044">
        </testcase>
    </testsuite>
</testsuites>
